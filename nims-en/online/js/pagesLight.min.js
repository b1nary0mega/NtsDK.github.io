/*Copyright 2015 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
    limitations under the License. */

/*global
 Utils, DBMS
 */


'use strict';

((exports) => {
    const root = '.enter-tab ';

    exports.init = () => {
        $(document.forms['login-form']).on('submit', submit);
        exports.content = queryEl(root);
    };

    exports.refresh = () => {

    };

    function submit() {
        const form = $(this);

        $('.error', form).html('');
        //        $(":submit", form).button("loading");

        const request = $.ajax({
            url: '/login',
            method: 'POST',
            data: form.serialize(),
            complete() {
                $(':submit', form).button('reset');
            },
            //             statusCode : {
            //                 200 : function() {
            //                 },
            //                 403 : function(jqXHR) {
            //                     var error = JSON.parse(jqXHR.responseText);
            //                     $('.error', form).html(error.message);
            //                 }
            //             }
        });
        request.done((data) => {
            //             //window.location.href = "/chat";
            //             window.location.href = "/nims.html";
            window.location.href = '/page.html';
        });

        request.fail((errorInfo, textStatus, errorThrown) => {
            let msg;
            try {
                msg = Utils.handleErrorMsg(JSON.parse(errorInfo.responseText));
            } catch (err) {
                msg = Utils.handleErrorMsg(errorInfo.responseText || textStatus || 'error');
            }
            //             var error = JSON.parse(jqXHR.responseText);
            //             $('.error', form).html(error.message);
            //            $('.error', form).html(textStatus);
            $('.error', form).html(msg);
        });

        return false;
    }
})(this.Enter = {});

/*Copyright 2017 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
    limitations under the License. */

/*global
 Utils, DBMS
 */

'use strict';

((exports) => {
    const root = '.player-tab ';
    const characterProfileDiv = `${root}.character-profile-div`;
    const playerProfileDiv = `${root}.player-profile-div`;
    const playerHeader = `${root}.player-profile-header`;
    const characterHeader = `${root}.character-profile-header`;

    let profileEditorCore;

    exports.init = () => {
        profileEditorCore = ProfileEditorCore.makeProfileEditorCore();
        exports.content = queryEl(root);
    };

    exports.refresh = () => {
        DBMS.getWelcomeText((err, text) => {
            if (err) { Utils.handleError(err); return; }
            DBMS.getPlayerProfileInfo((err2, profileInfo) => {
                if (err2) { Utils.handleError(err2); return; }
                DBMS.getPlayersOptions((err3, playersOptions) => {
                    if (err3) { Utils.handleError(err3); return; }
                    buildInterface(text, profileInfo, playersOptions);
                });
            });
        });
    };

    function isEditable(profileName, profileStructure) {
        return R.find(R.propEq('name', profileName), profileStructure).playerAccess === 'write';
    }

    function buildInterface(text, profileInfo, playersOptions) {
        profileEditorCore.initProfileStructure(playerProfileDiv, 'player', profileInfo.player.profileStructure);
        profileEditorCore.fillProfileInformation(playerProfileDiv, 'player', profileInfo.player.profile, isEditable);
        addEl(clearEl(queryEl(playerHeader)), makeText(strFormat(getL10n('briefings-player-profile'), [profileInfo.player.profile.name])));

        if (profileInfo.character === undefined) {
            addEl(clearEl(queryEl(characterHeader)), makeText(strFormat(getL10n('briefings-character-profile'), [''])));
            const el = clearEl(queryEl(characterProfileDiv));
            if (playersOptions.allowCharacterCreation) {
                const label = addEl(makeEl('div'), makeText(getL10n('profiles-player-has-no-character-and-can-create-it')));
                addClass(label, 'margin-bottom-8');
                const input = setAttr(makeEl('input'), 'placeholder', getL10n('profiles-character-name'));
                addClass(input, 'form-control margin-bottom-8');
                const button = addEl(makeEl('button'), makeText(getL10n('common-create')));
                addClass(button, 'btn btn-default');
                listen(button, 'click', () => {
                    DBMS.createCharacterByPlayer(input.value.trim(), Utils.processError(exports.refresh));
                });
                addEls(el, [label, input, button]);
            } else {
                addEl(el, addEl(makeEl('span'), makeText(getL10n('profiles-player-has-no-character-and-cant-create-it'))));
            }
        } else {
            profileEditorCore.initProfileStructure(characterProfileDiv, 'character', profileInfo.character.profileStructure);
            profileEditorCore.fillProfileInformation(characterProfileDiv, 'character', profileInfo.character.profile, isEditable);
            addEl(clearEl(queryEl(characterHeader)), makeText(strFormat(getL10n('briefings-character-profile'), [profileInfo.character.profile.name])));
        }

        queryEl(`${root}.welcome-text-area`).value = text;
    }
})(this.Player = {});

/*Copyright 2015 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
    limitations under the License. */

/*global
 Utils, DBMS
 */


'use strict';

((exports) => {
    const root = '.sign-up-tab ';

    exports.init = () => {
        $(document.forms['sign-up-form']).on('submit', submit);
        exports.content = queryEl(root);
    };

    exports.refresh = () => {
    };

    function submit() {
        const form = $(this);

        $('.error', form).html('');
        $(':submit', form).button('loading');

        const request = $.ajax({
            url: '/signUp',
            method: 'POST',
            data: form.serialize(),
            complete() {
                $(':submit', form).button('reset');
            },
        });
        request.done((data) => {
            form.html(getL10n('entrance-sign-up-success')).addClass('alert-success');
        });

        request.fail((errorInfo, textStatus, errorThrown) => {
            let msg;
            try {
                msg = Utils.handleErrorMsg(JSON.parse(errorInfo.responseText));
            } catch (err) {
                msg = Utils.handleErrorMsg(errorInfo.responseText || textStatus || 'error');
            }
            $('.error', form).html(msg);
        });

        return false;
    }
})(this.SignUp = {});

/*Copyright 2016 Timofey Rechkalov <ntsdk@yandex.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
    limitations under the License. */

/*global
 Utils, DBMS
 */

'use strict';

((exports) => {
    exports.init = () => {
        exports.content = getEl('aboutDiv');
    };

    exports.refresh = () => {
    };
})(this.About = {});

/*Copyright 2017 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
    limitations under the License. */

/*global
 Utils, DBMS
 */

/* eslint-disable func-names */

'use strict';

((exports) => {
    exports.makeProfileEditorCore = () => {
        const innerExports = {};

        const root = '.profile-editor-core-tmpl';

        const state = {
            character: {},
            player: {}
        };

        innerExports.initProfileStructure = (profileDiv, type, profileStructure, callback) => {
            const container = qte(`${root} .profile-editor-container-tmpl`);
            addEl(clearEl(queryEl(profileDiv)), container);
            state[type].inputItems = {};
            state[type].profileStructure = profileStructure;

            if(profileStructure.length === 0){
                const alert = qmte('.alert-block-tmpl');
                addEl(alert, makeText(L10n.get('advices', `empty-${type}-profile-structure`)));
                addEl(queryEl(profileDiv), alert);
                if (callback) callback();
                return;
            }
            try {
                addEls(qee(queryEl(profileDiv), '.insertion-point'), profileStructure.map(appendInput(type)));
            } catch (err) {
                Utils.handleError(err); return;
            }

            if (callback) callback();
        };

        // eslint-disable-next-line no-var,vars-on-top
        var appendInput = R.curry((type, profileItemConfig) => {
            const itemInput = new ProfileItemInput(type, profileItemConfig);
            state[type].inputItems[profileItemConfig.name] = itemInput;
            const row = qte(`${root} .profile-editor-row-tmpl`);
            addEl(qee(row, '.profile-item-name'), makeText(profileItemConfig.name));
            addEl(qee(row, '.profile-item-input'), itemInput.dom);
            return row;
        });

        innerExports.fillProfileInformation = (profileDiv, type, profile, isEditable) => {
            removeClass(queryEl(profileDiv), 'hidden');
            R.values(state[type].inputItems).forEach((itemInput) => {
                if (itemInput.type === 'multiEnum') {
                    itemInput.multiEnumSelect.prop('disabled', !isEditable(itemInput.name, state[type].profileStructure));
                } else {
                    Utils.enableEl(itemInput.dom, isEditable(itemInput.name, state[type].profileStructure));
                }
            });

            state[type].name = profile.name;
            Object.values(state[type].inputItems).forEach((item) => {
                item.showFieldValue(profile);
            });
        };

        function ProfileItemInput(profileType, profileItemConfig) {
            let input, sel;
            switch (profileItemConfig.type) {
            case 'text':
                input = makeEl('textarea');
                addClass(input, 'profileTextInput');
                break;
            case 'string':
                input = makeEl('input');
                addClass(input, 'profileStringInput');
                break;
            case 'enum':
                input = makeEl('select');
                addClass(input, 'profileSelectInput');
                const toNameObj = R.compose(R.zipObj(['name']), R.append(R.__, []));
                fillSelector(input, R.sort(CommonUtils.charOrdA, profileItemConfig.value.split(',')).map(toNameObj));
                break;
            case 'number':
                input = makeEl('input');
                input.type = 'number';
                break;
            case 'checkbox':
                input = makeEl('input');
                input.type = 'checkbox';
                break;
            case 'multiEnum':
                this.multiEnumSelect = $('<select></select>');
                setAttr(this.multiEnumSelect[0], 'style', 'width: 100%;');
                addClass(this.multiEnumSelect[0], 'common-select');
                addClass(this.multiEnumSelect[0], 'profileStringInput');
                [input] = $('<span></span>').append(this.multiEnumSelect);
                setAttr(this.multiEnumSelect[0], 'multiple', 'multiple');

                sel = this.multiEnumSelect.select2(arr2Select2(R.sort(CommonUtils.charOrdA, profileItemConfig.value.split(','))));
                sel.on('change', this.updateFieldValue.bind(this));
                break;
            default:
                throw new Errors.InternalError('errors-unexpected-switch-argument', [profileItemConfig.type]);
            }

            if (profileItemConfig.type !== 'multiEnum') {
                listen(input, 'change', this.updateFieldValue.bind(this));
                addClass(input, 'form-control');
            }

            this.dom = input;
            this.type = profileItemConfig.type;
            this.profileType = profileType;
            this.name = profileItemConfig.name;
        }

        ProfileItemInput.prototype.showFieldValue = function (profile) {
            if (this.type === 'checkbox') {
                this.dom.checked = profile[this.name];
            } else if (this.type === 'multiEnum') {
                this.multiEnumSelect.val(profile[this.name] === '' ? null : profile[this.name].split(',')).trigger('change');
            } else {
                this.dom.value = profile[this.name];
            }
            this.oldValue = profile[this.name];
        };

        ProfileItemInput.prototype.updateFieldValue = function (event) {
            const fieldName = this.name;
            const profileName = state[this.profileType].name;
            if (this.multiEnumSelect && this.multiEnumSelect.prop('disabled')) {
                return; // we need to trigger change event on multiEnumSelect to update selection.
                // It may be disabled so it has false positive call.
            }

            let value, val;
            switch (this.type) {
            case 'text':
            case 'string':
            case 'enum':
                val = this.dom.value;
                value = val;
                break;
            case 'number':
                if (Number.isNaN(this.dom.value)) {
                    Utils.alert(getL10n('profiles-not-a-number'));
                    this.dom.value = this.oldValue;
                    return;
                }
                value = Number(this.dom.value);
                break;
            case 'checkbox':
                value = this.dom.checked;
                break;
            case 'multiEnum':
                value = this.multiEnumSelect.val().join(',');
                break;
            default:
                Utils.handleError(new Errors.InternalError('errors-unexpected-switch-argument', [this.type]));
                return;
            }
            DBMS.updateProfileField(this.profileType, profileName, fieldName, this.type, value, Utils.processError());
        };

        return innerExports;
    };
})(this.ProfileEditorCore = {});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3BhZ2VzL3NlcnZlclNwZWNpZmljL2VudGVyLmpzIiwianMvcGFnZXMvc2VydmVyU3BlY2lmaWMvcGxheWVyLmpzIiwianMvcGFnZXMvc2VydmVyU3BlY2lmaWMvc2lnbi11cC5qcyIsImpzL3BhZ2VzL2xvZ3MvYWJvdXQuanMiLCJqcy9wYWdlcy9wcm9maWxlcy9wcm9maWxlRWRpdG9yQ29yZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InBhZ2VzTGlnaHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypDb3B5cmlnaHQgMjAxNSBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PiwgTWFyaWEgU2lkZWtobWVub3ZhIDxtYXRpbGRhX0BsaXN0LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4gKi9cclxuXHJcbi8qZ2xvYmFsXHJcbiBVdGlscywgREJNU1xyXG4gKi9cclxuXHJcblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4oKGV4cG9ydHMpID0+IHtcclxuICAgIGNvbnN0IHJvb3QgPSAnLmVudGVyLXRhYiAnO1xyXG5cclxuICAgIGV4cG9ydHMuaW5pdCA9ICgpID0+IHtcclxuICAgICAgICAkKGRvY3VtZW50LmZvcm1zWydsb2dpbi1mb3JtJ10pLm9uKCdzdWJtaXQnLCBzdWJtaXQpO1xyXG4gICAgICAgIGV4cG9ydHMuY29udGVudCA9IHF1ZXJ5RWwocm9vdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMucmVmcmVzaCA9ICgpID0+IHtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIHN1Ym1pdCgpIHtcclxuICAgICAgICBjb25zdCBmb3JtID0gJCh0aGlzKTtcclxuXHJcbiAgICAgICAgJCgnLmVycm9yJywgZm9ybSkuaHRtbCgnJyk7XHJcbiAgICAgICAgLy8gICAgICAgICQoXCI6c3VibWl0XCIsIGZvcm0pLmJ1dHRvbihcImxvYWRpbmdcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgZGF0YTogZm9ybS5zZXJpYWxpemUoKSxcclxuICAgICAgICAgICAgY29tcGxldGUoKSB7XHJcbiAgICAgICAgICAgICAgICAkKCc6c3VibWl0JywgZm9ybSkuYnV0dG9uKCdyZXNldCcpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICBzdGF0dXNDb2RlIDoge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgMjAwIDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgNDAzIDogZnVuY3Rpb24oanFYSFIpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBKU09OLnBhcnNlKGpxWEhSLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgJCgnLmVycm9yJywgZm9ybSkuaHRtbChlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJlcXVlc3QuZG9uZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAvL3dpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvY2hhdFwiO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL25pbXMuaHRtbFwiO1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcGFnZS5odG1sJztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5mYWlsKChlcnJvckluZm8sIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBtc2c7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBtc2cgPSBVdGlscy5oYW5kbGVFcnJvck1zZyhKU09OLnBhcnNlKGVycm9ySW5mby5yZXNwb25zZVRleHQpKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBtc2cgPSBVdGlscy5oYW5kbGVFcnJvck1zZyhlcnJvckluZm8ucmVzcG9uc2VUZXh0IHx8IHRleHRTdGF0dXMgfHwgJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgdmFyIGVycm9yID0gSlNPTi5wYXJzZShqcVhIUi5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAkKCcuZXJyb3InLCBmb3JtKS5odG1sKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICQoJy5lcnJvcicsIGZvcm0pLmh0bWwodGV4dFN0YXR1cyk7XHJcbiAgICAgICAgICAgICQoJy5lcnJvcicsIGZvcm0pLmh0bWwobXNnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59KSh0aGlzLkVudGVyID0ge30pO1xyXG4iLCIvKkNvcHlyaWdodCAyMDE3IFRpbW9mZXkgUmVjaGthbG92IDxudHNka0B5YW5kZXgucnU+LCBNYXJpYSBTaWRla2htZW5vdmEgPG1hdGlsZGFfQGxpc3QucnU+XHJcblxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG5cclxuaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuLypnbG9iYWxcclxuIFV0aWxzLCBEQk1TXHJcbiAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuKChleHBvcnRzKSA9PiB7XHJcbiAgICBjb25zdCByb290ID0gJy5wbGF5ZXItdGFiICc7XHJcbiAgICBjb25zdCBjaGFyYWN0ZXJQcm9maWxlRGl2ID0gYCR7cm9vdH0uY2hhcmFjdGVyLXByb2ZpbGUtZGl2YDtcclxuICAgIGNvbnN0IHBsYXllclByb2ZpbGVEaXYgPSBgJHtyb290fS5wbGF5ZXItcHJvZmlsZS1kaXZgO1xyXG4gICAgY29uc3QgcGxheWVySGVhZGVyID0gYCR7cm9vdH0ucGxheWVyLXByb2ZpbGUtaGVhZGVyYDtcclxuICAgIGNvbnN0IGNoYXJhY3RlckhlYWRlciA9IGAke3Jvb3R9LmNoYXJhY3Rlci1wcm9maWxlLWhlYWRlcmA7XHJcblxyXG4gICAgbGV0IHByb2ZpbGVFZGl0b3JDb3JlO1xyXG5cclxuICAgIGV4cG9ydHMuaW5pdCA9ICgpID0+IHtcclxuICAgICAgICBwcm9maWxlRWRpdG9yQ29yZSA9IFByb2ZpbGVFZGl0b3JDb3JlLm1ha2VQcm9maWxlRWRpdG9yQ29yZSgpO1xyXG4gICAgICAgIGV4cG9ydHMuY29udGVudCA9IHF1ZXJ5RWwocm9vdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMucmVmcmVzaCA9ICgpID0+IHtcclxuICAgICAgICBEQk1TLmdldFdlbGNvbWVUZXh0KChlcnIsIHRleHQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycikgeyBVdGlscy5oYW5kbGVFcnJvcihlcnIpOyByZXR1cm47IH1cclxuICAgICAgICAgICAgREJNUy5nZXRQbGF5ZXJQcm9maWxlSW5mbygoZXJyMiwgcHJvZmlsZUluZm8pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnIyKSB7IFV0aWxzLmhhbmRsZUVycm9yKGVycjIpOyByZXR1cm47IH1cclxuICAgICAgICAgICAgICAgIERCTVMuZ2V0UGxheWVyc09wdGlvbnMoKGVycjMsIHBsYXllcnNPcHRpb25zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycjMpIHsgVXRpbHMuaGFuZGxlRXJyb3IoZXJyMyk7IHJldHVybjsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkSW50ZXJmYWNlKHRleHQsIHByb2ZpbGVJbmZvLCBwbGF5ZXJzT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGlzRWRpdGFibGUocHJvZmlsZU5hbWUsIHByb2ZpbGVTdHJ1Y3R1cmUpIHtcclxuICAgICAgICByZXR1cm4gUi5maW5kKFIucHJvcEVxKCduYW1lJywgcHJvZmlsZU5hbWUpLCBwcm9maWxlU3RydWN0dXJlKS5wbGF5ZXJBY2Nlc3MgPT09ICd3cml0ZSc7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYnVpbGRJbnRlcmZhY2UodGV4dCwgcHJvZmlsZUluZm8sIHBsYXllcnNPcHRpb25zKSB7XHJcbiAgICAgICAgcHJvZmlsZUVkaXRvckNvcmUuaW5pdFByb2ZpbGVTdHJ1Y3R1cmUocGxheWVyUHJvZmlsZURpdiwgJ3BsYXllcicsIHByb2ZpbGVJbmZvLnBsYXllci5wcm9maWxlU3RydWN0dXJlKTtcclxuICAgICAgICBwcm9maWxlRWRpdG9yQ29yZS5maWxsUHJvZmlsZUluZm9ybWF0aW9uKHBsYXllclByb2ZpbGVEaXYsICdwbGF5ZXInLCBwcm9maWxlSW5mby5wbGF5ZXIucHJvZmlsZSwgaXNFZGl0YWJsZSk7XHJcbiAgICAgICAgYWRkRWwoY2xlYXJFbChxdWVyeUVsKHBsYXllckhlYWRlcikpLCBtYWtlVGV4dChzdHJGb3JtYXQoZ2V0TDEwbignYnJpZWZpbmdzLXBsYXllci1wcm9maWxlJyksIFtwcm9maWxlSW5mby5wbGF5ZXIucHJvZmlsZS5uYW1lXSkpKTtcclxuXHJcbiAgICAgICAgaWYgKHByb2ZpbGVJbmZvLmNoYXJhY3RlciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGFkZEVsKGNsZWFyRWwocXVlcnlFbChjaGFyYWN0ZXJIZWFkZXIpKSwgbWFrZVRleHQoc3RyRm9ybWF0KGdldEwxMG4oJ2JyaWVmaW5ncy1jaGFyYWN0ZXItcHJvZmlsZScpLCBbJyddKSkpO1xyXG4gICAgICAgICAgICBjb25zdCBlbCA9IGNsZWFyRWwocXVlcnlFbChjaGFyYWN0ZXJQcm9maWxlRGl2KSk7XHJcbiAgICAgICAgICAgIGlmIChwbGF5ZXJzT3B0aW9ucy5hbGxvd0NoYXJhY3RlckNyZWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IGFkZEVsKG1ha2VFbCgnZGl2JyksIG1ha2VUZXh0KGdldEwxMG4oJ3Byb2ZpbGVzLXBsYXllci1oYXMtbm8tY2hhcmFjdGVyLWFuZC1jYW4tY3JlYXRlLWl0JykpKTtcclxuICAgICAgICAgICAgICAgIGFkZENsYXNzKGxhYmVsLCAnbWFyZ2luLWJvdHRvbS04Jyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IHNldEF0dHIobWFrZUVsKCdpbnB1dCcpLCAncGxhY2Vob2xkZXInLCBnZXRMMTBuKCdwcm9maWxlcy1jaGFyYWN0ZXItbmFtZScpKTtcclxuICAgICAgICAgICAgICAgIGFkZENsYXNzKGlucHV0LCAnZm9ybS1jb250cm9sIG1hcmdpbi1ib3R0b20tOCcpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gYWRkRWwobWFrZUVsKCdidXR0b24nKSwgbWFrZVRleHQoZ2V0TDEwbignY29tbW9uLWNyZWF0ZScpKSk7XHJcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhidXR0b24sICdidG4gYnRuLWRlZmF1bHQnKTtcclxuICAgICAgICAgICAgICAgIGxpc3RlbihidXR0b24sICdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBEQk1TLmNyZWF0ZUNoYXJhY3RlckJ5UGxheWVyKGlucHV0LnZhbHVlLnRyaW0oKSwgVXRpbHMucHJvY2Vzc0Vycm9yKGV4cG9ydHMucmVmcmVzaCkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBhZGRFbHMoZWwsIFtsYWJlbCwgaW5wdXQsIGJ1dHRvbl0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYWRkRWwoZWwsIGFkZEVsKG1ha2VFbCgnc3BhbicpLCBtYWtlVGV4dChnZXRMMTBuKCdwcm9maWxlcy1wbGF5ZXItaGFzLW5vLWNoYXJhY3Rlci1hbmQtY2FudC1jcmVhdGUtaXQnKSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHByb2ZpbGVFZGl0b3JDb3JlLmluaXRQcm9maWxlU3RydWN0dXJlKGNoYXJhY3RlclByb2ZpbGVEaXYsICdjaGFyYWN0ZXInLCBwcm9maWxlSW5mby5jaGFyYWN0ZXIucHJvZmlsZVN0cnVjdHVyZSk7XHJcbiAgICAgICAgICAgIHByb2ZpbGVFZGl0b3JDb3JlLmZpbGxQcm9maWxlSW5mb3JtYXRpb24oY2hhcmFjdGVyUHJvZmlsZURpdiwgJ2NoYXJhY3RlcicsIHByb2ZpbGVJbmZvLmNoYXJhY3Rlci5wcm9maWxlLCBpc0VkaXRhYmxlKTtcclxuICAgICAgICAgICAgYWRkRWwoY2xlYXJFbChxdWVyeUVsKGNoYXJhY3RlckhlYWRlcikpLCBtYWtlVGV4dChzdHJGb3JtYXQoZ2V0TDEwbignYnJpZWZpbmdzLWNoYXJhY3Rlci1wcm9maWxlJyksIFtwcm9maWxlSW5mby5jaGFyYWN0ZXIucHJvZmlsZS5uYW1lXSkpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHF1ZXJ5RWwoYCR7cm9vdH0ud2VsY29tZS10ZXh0LWFyZWFgKS52YWx1ZSA9IHRleHQ7XHJcbiAgICB9XHJcbn0pKHRoaXMuUGxheWVyID0ge30pO1xyXG4iLCIvKkNvcHlyaWdodCAyMDE1IFRpbW9mZXkgUmVjaGthbG92IDxudHNka0B5YW5kZXgucnU+LCBNYXJpYSBTaWRla2htZW5vdmEgPG1hdGlsZGFfQGxpc3QucnU+XHJcblxyXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG5cclxuaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLiAqL1xyXG5cclxuLypnbG9iYWxcclxuIFV0aWxzLCBEQk1TXHJcbiAqL1xyXG5cclxuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbigoZXhwb3J0cykgPT4ge1xyXG4gICAgY29uc3Qgcm9vdCA9ICcuc2lnbi11cC10YWIgJztcclxuXHJcbiAgICBleHBvcnRzLmluaXQgPSAoKSA9PiB7XHJcbiAgICAgICAgJChkb2N1bWVudC5mb3Jtc1snc2lnbi11cC1mb3JtJ10pLm9uKCdzdWJtaXQnLCBzdWJtaXQpO1xyXG4gICAgICAgIGV4cG9ydHMuY29udGVudCA9IHF1ZXJ5RWwocm9vdCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydHMucmVmcmVzaCA9ICgpID0+IHtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gc3VibWl0KCkge1xyXG4gICAgICAgIGNvbnN0IGZvcm0gPSAkKHRoaXMpO1xyXG5cclxuICAgICAgICAkKCcuZXJyb3InLCBmb3JtKS5odG1sKCcnKTtcclxuICAgICAgICAkKCc6c3VibWl0JywgZm9ybSkuYnV0dG9uKCdsb2FkaW5nJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvc2lnblVwJyxcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGRhdGE6IGZvcm0uc2VyaWFsaXplKCksXHJcbiAgICAgICAgICAgIGNvbXBsZXRlKCkge1xyXG4gICAgICAgICAgICAgICAgJCgnOnN1Ym1pdCcsIGZvcm0pLmJ1dHRvbigncmVzZXQnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXF1ZXN0LmRvbmUoKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgZm9ybS5odG1sKGdldEwxMG4oJ2VudHJhbmNlLXNpZ24tdXAtc3VjY2VzcycpKS5hZGRDbGFzcygnYWxlcnQtc3VjY2VzcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXF1ZXN0LmZhaWwoKGVycm9ySW5mbywgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pID0+IHtcclxuICAgICAgICAgICAgbGV0IG1zZztcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIG1zZyA9IFV0aWxzLmhhbmRsZUVycm9yTXNnKEpTT04ucGFyc2UoZXJyb3JJbmZvLnJlc3BvbnNlVGV4dCkpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIG1zZyA9IFV0aWxzLmhhbmRsZUVycm9yTXNnKGVycm9ySW5mby5yZXNwb25zZVRleHQgfHwgdGV4dFN0YXR1cyB8fCAnZXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKCcuZXJyb3InLCBmb3JtKS5odG1sKG1zZyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufSkodGhpcy5TaWduVXAgPSB7fSk7XHJcbiIsIi8qQ29weXJpZ2h0IDIwMTYgVGltb2ZleSBSZWNoa2Fsb3YgPG50c2RrQHlhbmRleC5ydT5cclxuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcblxyXG5odHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuXHJcblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gICAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuICovXHJcblxyXG4vKmdsb2JhbFxyXG4gVXRpbHMsIERCTVNcclxuICovXHJcblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4oKGV4cG9ydHMpID0+IHtcclxuICAgIGV4cG9ydHMuaW5pdCA9ICgpID0+IHtcclxuICAgICAgICBleHBvcnRzLmNvbnRlbnQgPSBnZXRFbCgnYWJvdXREaXYnKTtcclxuICAgIH07XHJcblxyXG4gICAgZXhwb3J0cy5yZWZyZXNoID0gKCkgPT4ge1xyXG4gICAgfTtcclxufSkodGhpcy5BYm91dCA9IHt9KTtcclxuIiwiLypDb3B5cmlnaHQgMjAxNyBUaW1vZmV5IFJlY2hrYWxvdiA8bnRzZGtAeWFuZGV4LnJ1PiwgTWFyaWEgU2lkZWtobWVub3ZhIDxtYXRpbGRhX0BsaXN0LnJ1PlxyXG5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuXHJcbmh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAgICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4gKi9cclxuXHJcbi8qZ2xvYmFsXHJcbiBVdGlscywgREJNU1xyXG4gKi9cclxuXHJcbi8qIGVzbGludC1kaXNhYmxlIGZ1bmMtbmFtZXMgKi9cclxuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbigoZXhwb3J0cykgPT4ge1xyXG4gICAgZXhwb3J0cy5tYWtlUHJvZmlsZUVkaXRvckNvcmUgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5uZXJFeHBvcnRzID0ge307XHJcblxyXG4gICAgICAgIGNvbnN0IHJvb3QgPSAnLnByb2ZpbGUtZWRpdG9yLWNvcmUtdG1wbCc7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0YXRlID0ge1xyXG4gICAgICAgICAgICBjaGFyYWN0ZXI6IHt9LFxyXG4gICAgICAgICAgICBwbGF5ZXI6IHt9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW5uZXJFeHBvcnRzLmluaXRQcm9maWxlU3RydWN0dXJlID0gKHByb2ZpbGVEaXYsIHR5cGUsIHByb2ZpbGVTdHJ1Y3R1cmUsIGNhbGxiYWNrKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHF0ZShgJHtyb290fSAucHJvZmlsZS1lZGl0b3ItY29udGFpbmVyLXRtcGxgKTtcclxuICAgICAgICAgICAgYWRkRWwoY2xlYXJFbChxdWVyeUVsKHByb2ZpbGVEaXYpKSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgc3RhdGVbdHlwZV0uaW5wdXRJdGVtcyA9IHt9O1xyXG4gICAgICAgICAgICBzdGF0ZVt0eXBlXS5wcm9maWxlU3RydWN0dXJlID0gcHJvZmlsZVN0cnVjdHVyZTtcclxuXHJcbiAgICAgICAgICAgIGlmKHByb2ZpbGVTdHJ1Y3R1cmUubGVuZ3RoID09PSAwKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFsZXJ0ID0gcW10ZSgnLmFsZXJ0LWJsb2NrLXRtcGwnKTtcclxuICAgICAgICAgICAgICAgIGFkZEVsKGFsZXJ0LCBtYWtlVGV4dChMMTBuLmdldCgnYWR2aWNlcycsIGBlbXB0eS0ke3R5cGV9LXByb2ZpbGUtc3RydWN0dXJlYCkpKTtcclxuICAgICAgICAgICAgICAgIGFkZEVsKHF1ZXJ5RWwocHJvZmlsZURpdiksIGFsZXJ0KTtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgYWRkRWxzKHFlZShxdWVyeUVsKHByb2ZpbGVEaXYpLCAnLmluc2VydGlvbi1wb2ludCcpLCBwcm9maWxlU3RydWN0dXJlLm1hcChhcHBlbmRJbnB1dCh0eXBlKSkpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmhhbmRsZUVycm9yKGVycik7IHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12YXIsdmFycy1vbi10b3BcclxuICAgICAgICB2YXIgYXBwZW5kSW5wdXQgPSBSLmN1cnJ5KCh0eXBlLCBwcm9maWxlSXRlbUNvbmZpZykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtSW5wdXQgPSBuZXcgUHJvZmlsZUl0ZW1JbnB1dCh0eXBlLCBwcm9maWxlSXRlbUNvbmZpZyk7XHJcbiAgICAgICAgICAgIHN0YXRlW3R5cGVdLmlucHV0SXRlbXNbcHJvZmlsZUl0ZW1Db25maWcubmFtZV0gPSBpdGVtSW5wdXQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHF0ZShgJHtyb290fSAucHJvZmlsZS1lZGl0b3Itcm93LXRtcGxgKTtcclxuICAgICAgICAgICAgYWRkRWwocWVlKHJvdywgJy5wcm9maWxlLWl0ZW0tbmFtZScpLCBtYWtlVGV4dChwcm9maWxlSXRlbUNvbmZpZy5uYW1lKSk7XHJcbiAgICAgICAgICAgIGFkZEVsKHFlZShyb3csICcucHJvZmlsZS1pdGVtLWlucHV0JyksIGl0ZW1JbnB1dC5kb20pO1xyXG4gICAgICAgICAgICByZXR1cm4gcm93O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpbm5lckV4cG9ydHMuZmlsbFByb2ZpbGVJbmZvcm1hdGlvbiA9IChwcm9maWxlRGl2LCB0eXBlLCBwcm9maWxlLCBpc0VkaXRhYmxlKSA9PiB7XHJcbiAgICAgICAgICAgIHJlbW92ZUNsYXNzKHF1ZXJ5RWwocHJvZmlsZURpdiksICdoaWRkZW4nKTtcclxuICAgICAgICAgICAgUi52YWx1ZXMoc3RhdGVbdHlwZV0uaW5wdXRJdGVtcykuZm9yRWFjaCgoaXRlbUlucHV0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUlucHV0LnR5cGUgPT09ICdtdWx0aUVudW0nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbUlucHV0Lm11bHRpRW51bVNlbGVjdC5wcm9wKCdkaXNhYmxlZCcsICFpc0VkaXRhYmxlKGl0ZW1JbnB1dC5uYW1lLCBzdGF0ZVt0eXBlXS5wcm9maWxlU3RydWN0dXJlKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLmVuYWJsZUVsKGl0ZW1JbnB1dC5kb20sIGlzRWRpdGFibGUoaXRlbUlucHV0Lm5hbWUsIHN0YXRlW3R5cGVdLnByb2ZpbGVTdHJ1Y3R1cmUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzdGF0ZVt0eXBlXS5uYW1lID0gcHJvZmlsZS5uYW1lO1xyXG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKHN0YXRlW3R5cGVdLmlucHV0SXRlbXMpLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uc2hvd0ZpZWxkVmFsdWUocHJvZmlsZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIFByb2ZpbGVJdGVtSW5wdXQocHJvZmlsZVR5cGUsIHByb2ZpbGVJdGVtQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIGxldCBpbnB1dCwgc2VsO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHByb2ZpbGVJdGVtQ29uZmlnLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICAgICAgICBpbnB1dCA9IG1ha2VFbCgndGV4dGFyZWEnKTtcclxuICAgICAgICAgICAgICAgIGFkZENsYXNzKGlucHV0LCAncHJvZmlsZVRleHRJbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICAgICAgICBpbnB1dCA9IG1ha2VFbCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgIGFkZENsYXNzKGlucHV0LCAncHJvZmlsZVN0cmluZ0lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZW51bSc6XHJcbiAgICAgICAgICAgICAgICBpbnB1dCA9IG1ha2VFbCgnc2VsZWN0Jyk7XHJcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhpbnB1dCwgJ3Byb2ZpbGVTZWxlY3RJbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG9OYW1lT2JqID0gUi5jb21wb3NlKFIuemlwT2JqKFsnbmFtZSddKSwgUi5hcHBlbmQoUi5fXywgW10pKTtcclxuICAgICAgICAgICAgICAgIGZpbGxTZWxlY3RvcihpbnB1dCwgUi5zb3J0KENvbW1vblV0aWxzLmNoYXJPcmRBLCBwcm9maWxlSXRlbUNvbmZpZy52YWx1ZS5zcGxpdCgnLCcpKS5tYXAodG9OYW1lT2JqKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICAgICAgICAgIGlucHV0ID0gbWFrZUVsKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQudHlwZSA9ICdudW1iZXInO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcclxuICAgICAgICAgICAgICAgIGlucHV0ID0gbWFrZUVsKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQudHlwZSA9ICdjaGVja2JveCc7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbXVsdGlFbnVtJzpcclxuICAgICAgICAgICAgICAgIHRoaXMubXVsdGlFbnVtU2VsZWN0ID0gJCgnPHNlbGVjdD48L3NlbGVjdD4nKTtcclxuICAgICAgICAgICAgICAgIHNldEF0dHIodGhpcy5tdWx0aUVudW1TZWxlY3RbMF0sICdzdHlsZScsICd3aWR0aDogMTAwJTsnKTtcclxuICAgICAgICAgICAgICAgIGFkZENsYXNzKHRoaXMubXVsdGlFbnVtU2VsZWN0WzBdLCAnY29tbW9uLXNlbGVjdCcpO1xyXG4gICAgICAgICAgICAgICAgYWRkQ2xhc3ModGhpcy5tdWx0aUVudW1TZWxlY3RbMF0sICdwcm9maWxlU3RyaW5nSW5wdXQnKTtcclxuICAgICAgICAgICAgICAgIFtpbnB1dF0gPSAkKCc8c3Bhbj48L3NwYW4+JykuYXBwZW5kKHRoaXMubXVsdGlFbnVtU2VsZWN0KTtcclxuICAgICAgICAgICAgICAgIHNldEF0dHIodGhpcy5tdWx0aUVudW1TZWxlY3RbMF0sICdtdWx0aXBsZScsICdtdWx0aXBsZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbCA9IHRoaXMubXVsdGlFbnVtU2VsZWN0LnNlbGVjdDIoYXJyMlNlbGVjdDIoUi5zb3J0KENvbW1vblV0aWxzLmNoYXJPcmRBLCBwcm9maWxlSXRlbUNvbmZpZy52YWx1ZS5zcGxpdCgnLCcpKSkpO1xyXG4gICAgICAgICAgICAgICAgc2VsLm9uKCdjaGFuZ2UnLCB0aGlzLnVwZGF0ZUZpZWxkVmFsdWUuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcnMuSW50ZXJuYWxFcnJvcignZXJyb3JzLXVuZXhwZWN0ZWQtc3dpdGNoLWFyZ3VtZW50JywgW3Byb2ZpbGVJdGVtQ29uZmlnLnR5cGVdKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHByb2ZpbGVJdGVtQ29uZmlnLnR5cGUgIT09ICdtdWx0aUVudW0nKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0ZW4oaW5wdXQsICdjaGFuZ2UnLCB0aGlzLnVwZGF0ZUZpZWxkVmFsdWUuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICBhZGRDbGFzcyhpbnB1dCwgJ2Zvcm0tY29udHJvbCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRvbSA9IGlucHV0O1xyXG4gICAgICAgICAgICB0aGlzLnR5cGUgPSBwcm9maWxlSXRlbUNvbmZpZy50eXBlO1xyXG4gICAgICAgICAgICB0aGlzLnByb2ZpbGVUeXBlID0gcHJvZmlsZVR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IHByb2ZpbGVJdGVtQ29uZmlnLm5hbWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBQcm9maWxlSXRlbUlucHV0LnByb3RvdHlwZS5zaG93RmllbGRWYWx1ZSA9IGZ1bmN0aW9uIChwcm9maWxlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdjaGVja2JveCcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZG9tLmNoZWNrZWQgPSBwcm9maWxlW3RoaXMubmFtZV07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy50eXBlID09PSAnbXVsdGlFbnVtJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tdWx0aUVudW1TZWxlY3QudmFsKHByb2ZpbGVbdGhpcy5uYW1lXSA9PT0gJycgPyBudWxsIDogcHJvZmlsZVt0aGlzLm5hbWVdLnNwbGl0KCcsJykpLnRyaWdnZXIoJ2NoYW5nZScpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kb20udmFsdWUgPSBwcm9maWxlW3RoaXMubmFtZV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IHByb2ZpbGVbdGhpcy5uYW1lXTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBQcm9maWxlSXRlbUlucHV0LnByb3RvdHlwZS51cGRhdGVGaWVsZFZhbHVlID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IHRoaXMubmFtZTtcclxuICAgICAgICAgICAgY29uc3QgcHJvZmlsZU5hbWUgPSBzdGF0ZVt0aGlzLnByb2ZpbGVUeXBlXS5uYW1lO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5tdWx0aUVudW1TZWxlY3QgJiYgdGhpcy5tdWx0aUVudW1TZWxlY3QucHJvcCgnZGlzYWJsZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuOyAvLyB3ZSBuZWVkIHRvIHRyaWdnZXIgY2hhbmdlIGV2ZW50IG9uIG11bHRpRW51bVNlbGVjdCB0byB1cGRhdGUgc2VsZWN0aW9uLlxyXG4gICAgICAgICAgICAgICAgLy8gSXQgbWF5IGJlIGRpc2FibGVkIHNvIGl0IGhhcyBmYWxzZSBwb3NpdGl2ZSBjYWxsLlxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgdmFsdWUsIHZhbDtcclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2VudW0nOlxyXG4gICAgICAgICAgICAgICAgdmFsID0gdGhpcy5kb20udmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxyXG4gICAgICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTih0aGlzLmRvbS52YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlscy5hbGVydChnZXRMMTBuKCdwcm9maWxlcy1ub3QtYS1udW1iZXInKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb20udmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhbHVlID0gTnVtYmVyKHRoaXMuZG9tLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuZG9tLmNoZWNrZWQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbXVsdGlFbnVtJzpcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5tdWx0aUVudW1TZWxlY3QudmFsKCkuam9pbignLCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBVdGlscy5oYW5kbGVFcnJvcihuZXcgRXJyb3JzLkludGVybmFsRXJyb3IoJ2Vycm9ycy11bmV4cGVjdGVkLXN3aXRjaC1hcmd1bWVudCcsIFt0aGlzLnR5cGVdKSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgREJNUy51cGRhdGVQcm9maWxlRmllbGQodGhpcy5wcm9maWxlVHlwZSwgcHJvZmlsZU5hbWUsIGZpZWxkTmFtZSwgdGhpcy50eXBlLCB2YWx1ZSwgVXRpbHMucHJvY2Vzc0Vycm9yKCkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBpbm5lckV4cG9ydHM7XHJcbiAgICB9O1xyXG59KSh0aGlzLlByb2ZpbGVFZGl0b3JDb3JlID0ge30pO1xyXG4iXX0=
