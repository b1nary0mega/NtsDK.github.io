"use strict";!function(e){e.profileFieldTypes={text:{name:"text",value:""},string:{name:"string",value:""},"enum":{name:"enum",value:"_"},number:{name:"number",value:0},checkbox:{name:"checkbox",value:!1}},e.objectSubsets=["allObjects","selectedCharacters","selectedStories"],e.networks=["socialRelations","characterPresenceInStory","characterActivityInStory"],e.noGroup="noGroup",e.characterActivityTypes=["active","follower","defensive","passive"],e.numberFilter=["ignore","greater","equal","lesser"],e.finishedText="finishedText",e.finishedSuffix="finishedSuffix",e.emptySuffix="emptySuffix",e[!0]="yes",e[!1]="no",e.yesNo=[e[!0],e[!1]],e.briefingNumber=[1,5,10,20],e.colorPalette=[{color:{border:"#FA0A10",background:"#FB7E81",highlight:{border:"#FA0A10",background:"#FFAFB1"},hover:{border:"#FA0A10",background:"#FFAFB1"}}},{color:{border:"#41A906",background:"#7BE141",highlight:{border:"#41A906",background:"#A1EC76"},hover:{border:"#41A906",background:"#A1EC76"}}},{color:{border:"#E129F0",background:"#EB7DF4",highlight:{border:"#E129F0",background:"#F0B3F5"},hover:{border:"#E129F0",background:"#F0B3F5"}}},{color:{border:"#7C29F0",background:"#AD85E4",highlight:{border:"#7C29F0",background:"#D3BDF0"},hover:{border:"#7C29F0",background:"#D3BDF0"}}},{color:{border:"#C37F00",background:"#FFA807",highlight:{border:"#C37F00",background:"#FFCA66"},hover:{border:"#C37F00",background:"#FFCA66"}}},{color:{border:"#4220FB",background:"#6E6EFD",highlight:{border:"#4220FB",background:"#9B9BFD"},hover:{border:"#4220FB",background:"#9B9BFD"}}},{color:{border:"#FD5A77",background:"#FFC0CB",highlight:{border:"#FD5A77",background:"#FFD1D9"},hover:{border:"#FD5A77",background:"#FFD1D9"}}},{color:{border:"#4AD63A",background:"#C2FABC",highlight:{border:"#4AD63A",background:"#E6FFE3"},hover:{border:"#4AD63A",background:"#E6FFE3"}}},{color:{border:"#990000",background:"#EE0000",highlight:{border:"#BB0000",background:"#FF3333"},hover:{border:"#BB0000",background:"#FF3333"}}},{color:{border:"#FF6000",background:"#FF6000",highlight:{border:"#FF6000",background:"#FF6000"},hover:{border:"#FF6000",background:"#FF6000"}}},{color:{border:"#97C2FC",background:"#2B7CE9",highlight:{border:"#D2E5FF",background:"#2B7CE9"},hover:{border:"#D2E5FF",background:"#2B7CE9"}}},{color:{border:"#399605",background:"#255C03",highlight:{border:"#399605",background:"#255C03"},hover:{border:"#399605",background:"#255C03"}}},{color:{border:"#B70054",background:"#FF007E",highlight:{border:"#B70054",background:"#FF007E"},hover:{border:"#B70054",background:"#FF007E"}}},{color:{border:"#AD85E4",background:"#7C29F0",highlight:{border:"#D3BDF0",background:"#7C29F0"},hover:{border:"#D3BDF0",background:"#7C29F0"}}},{color:{border:"#4557FA",background:"#000EA1",highlight:{border:"#6E6EFD",background:"#000EA1"},hover:{border:"#6E6EFD",background:"#000EA1"}}},{color:{border:"#FFC0CB",background:"#FD5A77",highlight:{border:"#FFD1D9",background:"#FD5A77"},hover:{border:"#FFD1D9",background:"#FD5A77"}}},{color:{border:"#C2FABC",background:"#74D66A",highlight:{border:"#E6FFE3",background:"#74D66A"},hover:{border:"#E6FFE3",background:"#74D66A"}}},{color:{border:"#EE0000",background:"#990000",highlight:{border:"#FF3333",background:"#BB0000"},hover:{border:"#FF3333",background:"#BB0000"}}}],e.CHAR_NAME="char-name",e.CHAR_OWNER="char-owner",e.summaryStats=[["summary-active","constant-active"],["summary-follower","constant-follower"],["summary-defensive","constant-defensive"],["summary-passive","constant-passive"],["summary-completeness","character-filter-completeness"],["summary-totalStories","character-filter-totalStories"]],e.socialNetworkOpts={nodes:{shape:"dot",scaling:{min:10,max:30,label:{min:8,max:30,drawThreshold:5,maxVisible:30}},font:{size:20,face:"Tahoma"}},edges:{width:.15,color:{inherit:"from"},smooth:{type:"dynamic"}},physics:{barnesHut:{gravitationalConstant:-3e4,springConstant:.1},stabilization:{iterations:50}},layout:{randomSeed:1200},interaction:{tooltipDelay:200}},e.groupSchemaOpts={nodes:{scaling:{min:10,max:30,label:{min:8,max:30,drawThreshold:5,maxVisible:30}},font:{size:20,face:"Tahoma"}},manipulation:!1,height:"90%",layout:{hierarchical:{enabled:!0,levelSeparation:200}},physics:{hierarchicalRepulsion:{nodeDistance:140}}},e.investigationBoardOpts={edges:{arrows:"to",width:.7,color:"black",smooth:{type:"dynamic"},font:{background:"#33cccc",strokeWidth:0}},groups:{groups:{color:{background:"#ffcc00",border:"#a78912"},borderWidth:1,shape:"box"},resources:{color:{background:"#99cc00",border:"#839159"},borderWidth:1,shape:"ellipse"}},physics:{barnesHut:{gravitationalConstant:-2e3,avoidOverlap:.4,springLength:120,centralGravity:.8},stabilization:{iterations:50},timestep:.3}},e.visLocales={ru:{edit:"Редактировать",del:"Удалить выбранное",back:"Назад",addNode:"Добавить узел",addEdge:"Добавить ребро",editNode:"Редактировать узел",editEdge:"Редактировать ребро",addDescription:"Кликните в свободное место, чтобы добавить новый узел.",edgeDescription:"Кликните на узел и протяните ребро к другому узлу, чтобы соединить их.",editEdgeDescription:"Кликните на контрольные точки и перетащите их к другому узлу, чтобы соединить узлы.",createEdgeError:"Невозможно соединить ребра в кластер.",deleteClusterError:"Кластеры не могут быть удалены",editClusterError:"Кластеры недоступны для редактирования."},en:{edit:"Edit",del:"Delete selected",back:"Back",addNode:"Add Node",addEdge:"Add Edge",editNode:"Edit Node",editEdge:"Edit Edge",addDescription:"Click in an empty space to place a new node.",edgeDescription:"Click on a node and drag the edge to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",createEdgeError:"Cannot link edges to a cluster.",deleteClusterError:"Clusters cannot be deleted.",editClusterError:"Clusters cannot be edited."}},e.visLocales.en_EN=e.visLocales.en,e.visLocales.en_US=e.visLocales.en,e.visLocales.ru_RU=e.visLocales.ru,e.httpTimeout=5e3}("undefined"==typeof exports?this.Constants={}:exports),function(e){function t(e,t,r){e.startsWith=function(e,t){return e.substring(0,t.length)===t},e.removeFromArrayByIndex=function(e,t,r){var a=e.slice((r||t)+1||e.length);return e.length=0>t?e.length+t:t,e.push.apply(e,a)},e.charOrdAFactoryBase=t.curry(function(e,t){return function(r,a){return r=t(r),a=t(a),r>a?"asc"===e?1:-1:a>r?"asc"===e?-1:1:0}}),e.charOrdAFactory=e.charOrdAFactoryBase("asc"),e.charOrdA=e.charOrdAFactory(function(e){return e.toLowerCase()}),e.eventsByTime=e.charOrdAFactory(function(e){return new Date(e.time)}),e.strFormat=function(e,t){return e.replace(/\{\{|\}\}|\{(\d+)\}/g,function(e,r){return"{{"==e?"{":"}}"==e?"}":t[r]})},e.consoleLog=function(e){console.log(e)},e.clone=function(t){if(!t||"object"!=typeof t)return t;var r,a,n="function"==typeof t.pop?[]:{};for(r in t)t.hasOwnProperty(r)&&(a=t[r],a&&"object"==typeof a?n[r]=e.clone(a):n[r]=a);return n};var a=function(e,t){return(e+"").replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(t||"")+"-]","g"),"\\$&")};e.globStringToRegex=function(e){return new RegExp(a(e).replace(/\\\*/g,".*").replace(/\\\?/g,"."),"g")},e.escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},e.arr2map=function(e,t){return e.reduce(function(e,r){return e[r[t]]=r,e},{})},e.acceptDataRow=t.curry(function(t,r){var a,n=!0,i=e.arr2map(r,"itemName");return t.forEach(function(e){if(n)switch(a=i[e.name].value,e.type){case"enum":case"checkbox":e.selectedOptions[a]||(n=!1);break;case"number":switch(e.condition){case"greater":n=a>e.num;break;case"equal":n=a===e.num;break;case"lesser":n=a<e.num}break;case"text":case"string":n=-1!=a.toLowerCase().indexOf(e.regexString.toLowerCase())}}),n}),e.makeFilterInfo=function(e,t,r,a,n){var i={};i.profiles=r,i.charactersSummary=a,i.characterOwners=t,i.profileSettings=e;var o=[];return o.push({name:n.CHAR_NAME,type:"string",displayName:"character-filter-character"}),o.push({name:n.CHAR_OWNER,type:"string",displayName:"character-filter-character-owner"}),o=o.concat(e.map(function(e){return{name:"profile-"+e.name,type:e.type,displayName:e.name,value:e.value}})),o=o.concat(n.summaryStats.map(function(e){return{name:e[0],type:"number",displayName:e[1]}})),i.innerProfileSettings=o,i},e.getCharacterInfoValue=function(t,a,n){return n==r.CHAR_NAME?a:n==r.CHAR_OWNER?t.characterOwners[a]:e.startsWith(n,"summary-")?t.charactersSummary[a][n.substring("summary-".length)]:t.profiles[a][n.substring("profile-".length)]},e.getDataArray=t.curry(function(t,r){return t.innerProfileSettings.map(function(a){var n=e.getCharacterInfoValue(t,r,a.name);return{value:n,type:a.type,itemName:a.name}})}),e.getDataArrays=function(t,r){return Object.keys(t.profiles).map(e.getDataArray(t)).filter(e.acceptDataRow(r))},e.isFilterModelCompatibleWithProfiles=function(e,r){var a=r.filter(t.compose(t.test(/^profile-/),t.prop("name"))),n=t.indexBy(t.prop("name"),e),i=[];return a.forEach(function(e){var r=e.name.substring("profile-".length),a=n[r];if(!a||a.type!==e.type)return void i.push(r);if("enum"===a.type){var o=a.value.split(","),s=Object.keys(e.selectedOptions);if(0!=t.difference(s,o).length)return void i.push(r)}}),i}}e(t)}(function(e){"undefined"==typeof exports?e(this.CommonUtils={},R,Constants):module.exports=e}.bind(this)),function(e){var t=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,n=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(i,o,s){var c=t;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(i)||/\d/.test(i)||(o=i,i=void 0),i=i?new Date(i):new Date,isNaN(i))throw SyntaxError("invalid date");o=String(c.masks[o]||o||c.masks["default"]),"UTC:"==o.slice(0,4)&&(o=o.slice(4),s=!0);var u=s?"getUTC":"get",d=i[u+"Date"](),l=i[u+"Day"](),m=i[u+"Month"](),p=i[u+"FullYear"](),f=i[u+"Hours"](),h=i[u+"Minutes"](),g=i[u+"Seconds"](),y=i[u+"Milliseconds"](),v=s?0:i.getTimezoneOffset(),b={d:d,dd:n(d),ddd:c.i18n.dayNames[l],dddd:c.i18n.dayNames[l+7],m:m+1,mm:n(m+1),mmm:c.i18n.monthNames[m],mmmm:c.i18n.monthNames[m+12],yy:String(p).slice(2),yyyy:p,h:f%12||12,hh:n(f%12||12),H:f,HH:n(f),M:h,MM:n(h),s:g,ss:n(g),l:n(y,3),L:n(y>99?Math.round(y/10):y),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:s?"UTC":(String(i).match(r)||[""]).pop().replace(a,""),o:(v>0?"-":"+")+n(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return o.replace(e,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();t.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},t.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e(t)}(function(e){"undefined"==typeof exports?this.dateFormat=e:module.exports=e}.bind(this)),function(e){e.data={Meta:{name:"",date:"",preGameDate:"",description:""},Characters:{},ProfileSettings:[],Stories:{},Settings:{BriefingPreview:{},Stories:{},CharacterProfile:{}},Version:"0.4.1"}}("undefined"==typeof exports?this.EmptyBase={}:exports),function(e){function t(e,r){Error.call(this,arguments),this.name="ValidationError",this.messageId=e,this.parameters=r,Error.captureStackTrace?Error.captureStackTrace(this,t):this.stack=(new Error).stack}t.prototype=Object.create(Error.prototype),e.ValidationError=t}("undefined"==typeof exports?this.Errors={}:exports),function(){function e(){}function t(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var a=e.prototype,n=this,i=n.EventEmitter;a.getListeners=function(e){var t,r,a=this._getEvents();if(e instanceof RegExp){t={};for(r in a)a.hasOwnProperty(r)&&e.test(r)&&(t[r]=a[r])}else t=a[e]||(a[e]=[]);return t},a.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},a.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&(t={},t[e]=r),t||r},a.addListener=function(e,r){var a,n=this.getListenersAsObject(e),i="object"==typeof r;for(a in n)n.hasOwnProperty(a)&&-1===t(n[a],r)&&n[a].push(i?r:{listener:r,once:!1});return this},a.on=r("addListener"),a.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},a.once=r("addOnceListener"),a.defineEvent=function(e){return this.getListeners(e),this},a.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},a.removeListener=function(e,r){var a,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&(a=t(i[n],r),-1!==a&&i[n].splice(a,1));return this},a.off=r("removeListener"),a.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},a.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},a.manipulateListeners=function(e,t,r){var a,n,i=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(a=r.length;a--;)i.call(this,t,r[a]);else for(a in t)t.hasOwnProperty(a)&&(n=t[a])&&("function"==typeof n?i.call(this,a,n):o.call(this,a,n));return this},a.removeEvent=function(e){var t,r=typeof e,a=this._getEvents();if("string"===r)delete a[e];else if(e instanceof RegExp)for(t in a)a.hasOwnProperty(t)&&e.test(t)&&delete a[t];else delete this._events;return this},a.removeAllListeners=r("removeEvent"),a.emitEvent=function(e,t){var r,a,n,i,o,s=this.getListenersAsObject(e);for(i in s)if(s.hasOwnProperty(i))for(r=s[i].slice(0),n=0;n<r.length;n++)a=r[n],a.once===!0&&this.removeListener(e,a.listener),o=a.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,a.listener);return this},a.trigger=r("emitEvent"),a.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},a.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},a._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},a._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return n.EventEmitter=i,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:n.EventEmitter=e}.call(this),function(e){e.attachLogCalls=function(e,t,r,a){var n={getDatabase:{rewrite:!0},setDatabase:{ignoreParams:!0},setMetaInfo:{filter:function(e){return"description"!==e[0]}},createCharacter:{},renameCharacter:{},removeCharacter:{},createProfileItem:{},renameProfileItem:{},moveProfileItem:{},removeProfileItem:{},updateDefaultValue:{},changeProfileItemType:{},createStory:{},renameStory:{},removeStory:{},addStoryCharacter:{},switchStoryCharacters:{},removeStoryCharacter:{},updateCharacterInventory:{},onChangeCharacterActivity:{},addCharacterToEvent:{},removeCharacterFromEvent:{},createEvent:{},moveEvent:{},cloneEvent:{},mergeEvents:{},removeEvent:{},updateEventProperty:{filter:function(e){return"text"!==e[2]}},createGroup:{},renameGroup:{},removeGroup:{},saveFilterToGroup:{},changeAdaptationReadyStatus:{},getBriefingData:{},addBoardGroup:{},switchGroups:{},setGroupNotes:{},removeBoardGroup:{},createResource:{},renameResource:{},removeResource:{},addEdge:{},setEdgeLabel:{},removeEdge:{}};a&&(n=t.merge(n,a)),Object.keys(e.prototype).filter(t.prop(t.__,n)).forEach(function(t){var a=e.prototype[t];e.prototype[t]=function(){for(var e=[],i=0;i<arguments.length-1;i++)e.push(arguments[i]);var o=!0;if(n[t].filter&&(o=n[t].filter(e)),o){var s="user";r&&(s=arguments[arguments.length-1].name),this.log(s,t,n[t].rewrite,n[t].ignoreParams?[]:e)}return a.apply(this,arguments)}})}}("undefined"==typeof exports?this.Logger={}:exports),function(e){var t=function(e,t,r){console.log(t+"."+r+": "+(void 0!==e[r]?"OK":"undefined"))};e.migrate=function(e){if(t(e,"base","Stories"),!e.Version){e.Settings={};var r,a;Object.keys(e.Stories).forEach(function(t){r=e.Stories[t],a=Object.keys(r.characters),a.forEach(function(e){r.characters[e].activity={}})}),e.Version="0.0.4"}if("0.0.4"===e.Version&&(e.Version="0.4.1"),"0.4.1"===e.Version&&(delete e.Settings.Events,e.Version="0.4.3"),"0.4.3"===e.Version&&(e.Log=[],e.Version="0.4.4",e.Meta.saveTime=new Date),"0.4.4"===e.Version){var n,r;Object.keys(e.Characters).forEach(function(t){n=e.Characters[t],delete n.displayName}),Object.keys(e.Stories).forEach(function(t){r=e.Stories[t],delete r.displayName}),e.Version="0.4.4u1"}if("0.4.4u1"===e.Version){e.ProfileSettings.forEach(function(e){e.doExport=!0}),e.Meta.saveTime=(new Date).toString();for(var i in e.Stories){var r=e.Stories[i];r.events.forEach(function(e){delete e.index,delete e.storyName})}for(var i in e.Stories){var r=e.Stories[i];r.events.forEach(function(e){for(var t in e.characters)delete e.characters[t].name,e.characters[t].time=""})}e.Version="0.4.4u2"}if("0.4.4u2"===e.Version){for(var i in e.Stories){var r=e.Stories[i];r.events.forEach(function(e){for(var t in e.characters)delete e.characters[t].name})}e.Version="0.4.4u3"}if("0.4.4u3"===e.Version){if(e.Groups={},e.ManagementInfo)for(var o in e.ManagementInfo.UsersInfo)e.ManagementInfo.UsersInfo[o].groups=[];e.Version="0.5.0"}return"0.5.0"===e.Version&&(e.InvestigationBoard={groups:{},resources:{},relations:{}},e.Version="0.5.1"),"0.5.1"===e.Version&&(e.Relations={},e.Version="0.5.2"),t(e,"base","Characters"),t(e,"base","ProfileSettings"),t(e,"base","Meta"),t(e,"base","Log"),t(e.Meta,"base.Meta","name"),t(e.Meta,"base.Meta","date"),t(e.Meta,"base.Meta","preGameDate"),t(e.Meta,"base.Meta","description"),t(e.Meta,"base.Meta","saveTime"),e}}("undefined"==typeof exports?this.Migrator={}:exports),function(e){function t(e,t,r){function a(){return{title:"Meta",description:"Contains meta data for game: name, description, dates and saving time.",type:"object",properties:{name:{type:"string",description:"Game name"},date:{type:"string",description:"Time of starting game in game universe."},preGameDate:{type:"string",description:"Time of starting pregame events in game universe."},description:{type:"string",description:"Description text for game."},saveTime:{type:"string",description:"Stringified date of last database saving."}},required:["name","date","preGameDate","description","saveTime"],additionalProperties:!1}}function n(){return{title:"ProfileSettings",description:"Describes character profile settings.",type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string","enum":["string","number","text","checkbox","enum"]},value:{type:["string","number","boolean"]},doExport:{type:"boolean"}},required:["name","type","value","doExport"],additionalProperties:!1}}}function i(){return{type:"array",items:{type:"array",items:{type:"string"},minItems:4,maxItems:4}}}function o(e,t){var r=Object.keys(t.groups),a=r.map(function(e){return"group-"+e}),n=Object.keys(t.resources),i=n.map(function(e){return"resource-"+e}),o={type:"object",properties:{},additionalProperties:!1};a.forEach(function(e){o.properties[e]={type:"string"}}),i.forEach(function(e){o.properties[e]={type:"string"}});var s={type:"object",properties:{},additionalProperties:!1};0!=a.length&&(s.required=a),a.forEach(function(e){s.properties[e]=o});var c={type:"object",properties:{},additionalProperties:!1};n.forEach(function(e){c.properties[e]={type:"object",properties:{name:{type:"string","enum":[e]}},required:["name"],additionalProperties:!1}});var u={type:"object",properties:{},additionalProperties:!1},d=Object.keys(e);d.forEach(function(e){u.properties[e]={type:"object",properties:{name:{type:"string","enum":[e]},notes:{type:"string"}},required:["name","notes"],additionalProperties:!1}});var l={type:"object",properties:{groups:u,resources:c,relations:s},required:["groups","resources","relations"],additionalProperties:!1};return l}function s(e){var t=[];t.push({type:"object",properties:{name:{type:"string","enum":["char-name"]},type:{type:"string","enum":["string"]},regexString:{type:"string",minLength:1}},required:["name","type","regexString"],additionalProperties:!1}),t.push({type:"object",properties:{name:{type:"string","enum":["char-owner"]},type:{type:"string","enum":["string"]},regexString:{type:"string",minLength:1}},required:["name","type","regexString"],additionalProperties:!1}),t=t.concat(e.map(function(e){var t={type:"object",properties:{name:{type:"string","enum":["profile-"+e.name]},type:{type:"string","enum":[e.type]}},required:["name","type"],additionalProperties:!1};switch(e.type){case"text":case"string":t.properties.regexString={type:"string",minLength:1},t.required.push("regexString");break;case"number":t.properties.num={type:"number"},t.properties.condition={type:"string","enum":["greater","lesser","equal"]},t.required.push("num"),t.required.push("condition");break;case"checkbox":t.properties.selectedOptions={type:"object",properties:{"false":{},"true":{}},additionalProperties:!1},t.required.push("selectedOptions");break;case"enum":var r=e.value.split(",").reduce(function(e,t){return e[t]={},e},{});t.properties.selectedOptions={type:"object",properties:r,additionalProperties:!1},t.required.push("selectedOptions")}return t}));var r=["active","follower","defensive","passive","completeness","totalStories"];r.forEach(function(e){t.push({type:"object",properties:{name:{type:"string","enum":["summary-"+e]},type:{type:"string","enum":["number"]},num:{type:"number"},condition:{type:"string","enum":["greater","lesser","equal"]}},required:["name","type","num","condition"],additionalProperties:!1})});var a={name:{type:"string"},masterDescription:{type:"string"},characterDescription:{type:"string"},filterModel:{type:"array",items:{oneOf:t}},doExport:{type:"boolean"}},n={type:"object",additionalProperties:{type:"object",properties:a,required:Object.keys(a),additionalProperties:!1}};return n}function c(e){var t,r={name:{type:"string"}};e.forEach(function(e){switch(e.type){case"text":case"string":t={type:"string"};break;case"checkbox":t={type:"boolean"};break;case"number":t={type:"number"};break;case"enum":t={type:"string","enum":e.value.split(",").map(function(e){return e.trim()})}}r[e.name]=t});var a={type:"object",additionalProperties:{type:"object",properties:r,required:Object.keys(r),additionalProperties:!1}};return a}function u(e){var t=Object.keys(e),r={type:"object",properties:{text:{type:"string"},time:{type:"string"},ready:{type:"boolean"}},required:["text","time"],additionalProperties:!1},a={type:"object",properties:{name:{type:"string"},text:{type:"string"},time:{type:"string"},characters:{type:"object",properties:t.reduce(function(e,t){return e[t]=r,e},{}),additionalProperties:!1}},required:["name","text","time","characters"],additionalProperties:!1},n={type:"object",properties:{name:{type:"string","enum":t},inventory:{type:"string"},activity:{type:"object",properties:{active:{type:"boolean"},follower:{type:"boolean"},defensive:{type:"boolean"},passive:{type:"boolean"}},additionalProperties:!1}},required:["name","inventory","activity"],additionalProperties:!1},i={type:"object",properties:{name:{type:"string"},story:{type:"string"},characters:{type:"object",properties:t.reduce(function(e,t){return e[t]=n,e},{}),additionalProperties:!1},events:{type:"array",items:a}},required:["name","story","characters","events"],additionalProperties:!1},o={type:"object",additionalProperties:i};return o}function d(e,t,r,a){var n=Object.keys(t),i=Object.keys(r),o=Object.keys(a),s=Object.keys(e.UsersInfo);0==i.length&&(i=["123"]),0==n.length&&(n=["123"]),0==o.length&&(o=["123"]);var c={type:"object",properties:{name:{type:"string"},stories:{type:"array",items:{type:"string","enum":i},minItems:0},characters:{type:"array",items:{type:"string","enum":n}},groups:{type:"array",items:{type:"string","enum":o}},salt:{type:"string"},hashedPassword:{type:"string"}},required:["name","stories","characters","groups","salt","hashedPassword"],additionalProperties:!1},u={type:"object",properties:{UsersInfo:{type:"object",additionalProperties:c},admin:{type:"string","enum":s},editor:{type:["string","null"],"enum":s.concat(null)},adaptationRights:{type:"string","enum":["ByStory","ByCharacter"]}},required:["UsersInfo","admin","editor","adaptationRights"],additionalProperties:!1};return u}function l(e,a){var n="^("+t.keys(e).map(r.escapeRegExp).join("|")+")$",i={type:"object",additionalProperties:!1,patternProperties:{}};return i.patternProperties[n]={type:"object",additionalProperties:!1,patternProperties:{}},i.patternProperties[n].patternProperties[n]={type:"string",minLength:1},i}e.getSchema=function(e){var t={$schema:"http://json-schema.org/draft-04/schema#",title:"SMTK NIMS base",description:"SMTK NIMS base schema.",type:"object",definitions:{}},r=a(),m=n(),p=i(),f=c(e.ProfileSettings),h=u(e.Characters),g=s(e.ProfileSettings),y=o(e.Groups,e.InvestigationBoard),v=l(e.Characters,t.definitions),b={};return e.ManagementInfo&&(b=d(e.ManagementInfo,e.Characters,e.Stories,e.Groups)),t.properties={Meta:r,ProfileSettings:m,Characters:f,Stories:h,Version:{type:"string"},Log:p,Groups:g,InvestigationBoard:y,Settings:{},Relations:v,ManagementInfo:b},t.required=["Meta","ProfileSettings","Version","Characters","Stories","Log","Groups","InvestigationBoard","Relations"],t.additionalProperties=!1,t}}e(t)}(function(e){"undefined"==typeof exports?e(this.Schema={},R,CommonUtils):module.exports=e}.bind(this)),function(e){function t(e,t,r){e.prototype.getManagementInfo=function(e){var a=this.database.ManagementInfo,n=t.clone(r.keys(a.UsersInfo).reduce(function(e,t){return e[t]=r.pick(["characters","groups","stories"],a.UsersInfo[t]),e},{}));e(null,{usersInfo:n,admin:a.admin,editor:a.editor,adaptationRights:a.adaptationRights})},e.prototype.assignAdmin=function(e,t){this.database.ManagementInfo.admin=e,this.publishPermissionsUpdate(),t()},e.prototype.assignEditor=function(e,t){this.database.ManagementInfo.editor=e,this.publishPermissionsUpdate(),t()},e.prototype.removeEditor=function(e){this.database.ManagementInfo.editor=null,this.publishPermissionsUpdate(),e()},e.prototype.changeAdaptationRightsMode=function(e,t){this.database.ManagementInfo.adaptationRights=e,this.publishPermissionsUpdate(),t()},e.prototype.isUserNameUsed=function(e,t){t(null,void 0!==this.database.ManagementInfo.UsersInfo[e])},e.prototype.createUser=function(e,t,r){this.database.ManagementInfo.UsersInfo[e]={name:e,stories:[],characters:[],groups:[]},r()},e.prototype.changePassword=function(e,t,r){Utils.alert(strFormat(getL10n("function-must-be-overriden-on-server"),["changePassword"])),r()},e.prototype.removeUser=function(e,t){delete this.database.ManagementInfo.UsersInfo[e],this.publishPermissionsUpdate(),t()},e.prototype.removePermission=function(e,t,r){var a=this.database.ManagementInfo;for(var n in t)0!=t[n].length&&(a.UsersInfo[e][n]=a.UsersInfo[e][n].filter(function(e){return-1===t[n].indexOf(e)}));this.publishPermissionsUpdate(),r()},e.prototype.assignPermission=function(e,t,r){var a=this.database.ManagementInfo;for(var n in t)0!=t[n].length&&(t[n].forEach(function(t){-1===a.UsersInfo[e][n].indexOf(t)&&a.UsersInfo[e][n].push(t)}),Object.keys(a.UsersInfo).forEach(function(r){r!==e&&(a.UsersInfo[r][n]=a.UsersInfo[r][n].filter(function(e){return-1===t[n].indexOf(e)}))}));this.publishPermissionsUpdate(),r()},e.prototype.publishPermissionsUpdate=function(){Utils.alert(strFormat(getL10n("function-must-be-overriden-on-server"),["publishPermissionsUpdate"]))}}e(t)}(function(e){"undefined"==typeof exports?this.accessManagerAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a){e.prototype._init=function(e){this.ee=new a;var t=this;for(var r in e)e[r].forEach(function(e){t.ee.on(r,e.bind(t))})},e.prototype.getDatabase=function(e){this.database.Meta.saveTime=(new Date).toString(),e(null,r.clone(this.database))},e.prototype.setDatabase=function(e,r){this.database=t.migrate(e),r&&r()},e.prototype.getMetaInfo=function(e){e(null,r.clone(this.database.Meta))},e.prototype.setMetaInfo=function(e,t,r){this.database.Meta[e]=t,r&&r()}}e(t)}(function(e){"undefined"==typeof exports?this.baseAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a){e.prototype.getBriefingData=function(e,t){var a=this;a.getAllCharacterGroupTexts(function(i,o){return i?void t(i):(e=r.isNil(e)?r.keys(a.database.Characters):r.keys(e),void n(a._getKnownCharacters,a.database,e,o,t))})};var n=function(e,a,n,m,p){var f=n.map(function(t){var n={gameName:a.Meta.name,charName:t,inventory:o(a,t),storiesInfo:d(a,t),eventsInfo:l(a,t),profileInfoArray:u(a,t),groupTexts:m[t],relations:i(e(a,t),a,t)};return n=r.merge(n,c("profileInfo-",a,t,!1)),n=r.merge(n,c("profileInfo-splitted-",a,t,!0)),n=r.merge(n,s("profileInfo-notEmpty-",a,t))});f.sort(t.charOrdAFactory(r.prop("charName"))),p(null,{briefings:f,gameName:a.Meta.name})},i=function(e,a,n){var i=a.Relations[n],o=a.Characters;return r.keys(i).map(function(t){return{toCharacter:t,text:i[t],splittedText:f(i[t]),profile:o[t],stories:r.keys(e[t]||{}).join(", ")}}).sort(t.charOrdAFactory(r.prop("toCharacter")))},o=function(e,t){var a=[];return r.values(e.Stories).forEach(function(e){e.characters[t]&&e.characters[t].inventory&&""!==e.characters[t].inventory&&(a=a.concat(e.characters[t].inventory))}),a=a.join(", ")},s=function(e,t,r){var a=t.Characters[r],n={};return t.ProfileSettings.forEach(function(t){n[e+t.name]=0!==String(a[t.name]).length}),n},c=function(e,t,r,a){var n=t.Characters[r],i={};return t.ProfileSettings.forEach(function(t){i[e+t.name]=a?f(String(n[t.name])):n[t.name]}),i},u=function(e,t){var a,n,i=e.Characters[t],o=r.compose(r.equals(!0),r.prop("doExport")),s=e.ProfileSettings.filter(o).map(function(e){return a=i[e.name],n=f(String(a)),{itemName:e.name,value:a,splittedText:n,notEmpty:0!==String(a).length}});return s},d=function(e,a){return r.values(e.Stories).filter(function(e){return e.characters[a]}).map(function(t){return{storyName:t.name,eventsInfo:m(t,a,e.Meta.date)}}).sort(t.charOrdAFactory(function(e){return e.storyName.toLowerCase()}))},l=function(e,a){var n=r.values(e.Stories).filter(function(e){return e.characters[a]}).map(function(t){return m(t,a,e.Meta.date)});return n=n.reduce(function(e,t){return e.concat(t)},[]),n.sort(t.eventsByTime),n},m=function(e,t,r){return e.events.filter(function(e){return e.characters[t]}).map(p(t,e.name,r))},p=r.curry(function(e,t,r,a){var n={};return""!==a.characters[e].text?n.text=a.characters[e].text:n.text=a.text,n.splittedText=f(n.text),n.time=""===a.time?r:a.time,""!==a.characters[e].time?n.displayTime=a.characters[e].time:n.displayTime=n.time,n.eventName=a.name,n.storyName=t,n}),f=function(e){return e.split("\n").map(function(e){return{string:e}})}}e(t)}(function(e){"undefined"==typeof exports?this.briefingExportAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a,n){function i(e,t,r){var a=this;Object.keys(a.database.Characters).forEach(function(t){a.database.Characters[t][e]=r})}function o(e,t){var r=this;Object.keys(this.database.Characters).forEach(function(e){delete r.database.Characters[e][t]})}function s(e,r){var a=this;Object.keys(this.database.Characters).forEach(function(n){a.database.Characters[n][e]=t.profileFieldTypes[r].value})}function c(e,t){var r=this;Object.keys(this.database.Characters).forEach(function(a){var n=r.database.Characters[a][t];delete r.database.Characters[a][t],r.database.Characters[a][e]=n})}function u(e,t,r){var a=this;Object.keys(this.database.Characters).forEach(function(n){var i=a.database.Characters[n][e];
r[i]||(a.database.Characters[n][e]=t)})}e.prototype.getCharacterNamesArray=function(e){e(null,Object.keys(this.database.Characters).sort(r.charOrdA))},e.prototype.getProfile=function(e,t){t(null,r.clone(this.database.Characters[e]))},e.prototype.getAllProfiles=function(e){e(null,r.clone(this.database.Characters))},e.prototype.isCharacterNameUsed=function(e,t){t(null,void 0!==this.database.Characters[e])},e.prototype.createCharacter=function(e,t){if(""===e)return void t(new a.ValidationError("characters-character-name-is-not-specified"));if(this.database.Characters[e])return void t(new a.ValidationError("characters-character-name-already-used",[e]));var r={name:e};this.database.ProfileSettings.forEach(function(e){"enum"===e.type?r[e.name]=e.value.split(",")[0]:r[e.name]=e.value}),this.database.Characters[e]=r,this.ee.trigger("createCharacter",arguments),t&&t()},e.prototype.renameCharacter=function(e,t,r){if(""===t)return void r(new a.ValidationError("characters-new-character-name-is-not-specified"));if(e===t)return void r(new a.ValidationError("characters-names-are-the-same"));if(this.database.Characters[t])return void r(new a.ValidationError("characters-character-name-already-used",[t]));var n=this.database.Characters[e];n.name=t,this.database.Characters[t]=n,delete this.database.Characters[e],this.ee.trigger("renameCharacter",arguments),r&&r()},e.prototype.removeCharacter=function(e,t){delete this.database.Characters[e],this.ee.trigger("removeCharacter",arguments),t&&t()},e.prototype.updateProfileField=function(e,t,r,n,i){var o=this.database.Characters[e];switch(r){case"text":case"string":case"enum":o[t]=n;break;case"number":if(isNaN(n))return void i(new a.ValidationError("characters-not-a-number"));o[t]=Number(n);break;case"checkbox":o[t]=n}i&&i()},n.createProfileItem=n.createProfileItem||[],n.createProfileItem.push(i),n.removeProfileItem=n.removeProfileItem||[],n.removeProfileItem.push(o),n.changeProfileItemType=n.changeProfileItemType||[],n.changeProfileItemType.push(s),n.renameProfileItem=n.renameProfileItem||[],n.renameProfileItem.push(c),n.replaceEnumValue=n.replaceEnumValue||[],n.replaceEnumValue.push(u)}e(t)}(function(e){"undefined"==typeof exports?this.charactersAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a,n){e.prototype.getConsistencyCheckResult=function(e){var t=[],r=function(e){t.push(e)};d(this.database,r),u(this.database,r),c(this.database,r),s(this.database,r),this.database.ManagementInfo&&o(this.database,r);var i=n.getSchema(this.database),l=a({allErrors:!0}),m=l.compile(i),p=m(this.database);p||(t=t.concat(m.errors)),e(null,t)};var i=function(e){return t.curry(t.compose(e,r.strFormat))},o=function(e,r){var a=t.values(e.Stories).map(t.prop("name")),n=t.values(e.Characters).map(t.prop("name")),o=i(r);t.values(e.ManagementInfo.UsersInfo).forEach(function(e){var r=t.difference(e.characters,n);0!=r.length&&o("Object rights inconsistent, user character is not exist: user {0}, character {1}",[e.name,r]),r=t.difference(e.stories,a),0!=r.length&&o("Object rights inconsistent, user story is not exist: user {0}, story {1}",[e.name,r])})},s=function(e,r){var a=i(r);t.values(e.Stories).forEach(function(e){var r=t.values(e.characters).map(t.prop("name"));e.events.forEach(function(n,i){var o=t.keys(n.characters),s=t.difference(o,r);0!=s.length&&a("Event characters inconsistent, some character is not exist: story {0}, character {1}",[e.name+":"+i,s])})})},c=function(e,r){var a=t.values(e.Characters).map(t.prop("name")),n=i(r);t.values(e.Stories).forEach(function(e){var r=t.values(e.characters).map(t.prop("name")),i=t.difference(r,a);0!=i.length&&n("Story characters inconsistent, some character is not exist: story {0}, character {1}",[e.name,i]);var o=t.keys(e.characters),s=t.symmetricDifference(r,o);0!=s.length&&n("Story characters inconsistent, inner and outer character name are inconsistent: story {0}, character {1}",[e.name,s])})},u=function(e,r){var a=e.ProfileSettings,n=i(r)("Profile value inconsistency, item type is inconsistent: char {0}, item {1}, value {2}"),o=function(e,r,a){switch(r){case"text":case"string":return!t.is(String,e);case"enum":if(t.is(String,e)){var n=a.split(",").map(t.trim);return!t.contains(e.trim(),n)}return!0;case"number":return!t.is(Number,e);case"checkbox":return!t.is(Boolean,e)}};t.values(e.Characters).forEach(function(e){a.forEach(function(t){o(e[t.name],t.type,t.value)&&n([e.name,t.name,e[t.name]])})})},d=function(e,r){var a=e.ProfileSettings.map(t.prop("name")),n=i(r);t.values(e.Characters).forEach(function(e){var r=t.keys(e).filter(t.compose(t.not,t.equals("name"))),i=t.symmetricDifference(r,a);if(0!=i.length){var o=n(t.__,[e.name,i]);if(r.length!==a.length)return o("Character profile inconsistent, lengths are different: char {0}, difference [{1}]");if(!t.all(t.contains(t.__,a))(r))return o("Character profile inconsistent, item name inconsistency: char {0}, difference [{1}]")}})}}e(t)}(function(e){"undefined"==typeof exports?this.consistencyCheckAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a,n,i){function o(e,t){var r="profile-"+t,a=this;Object.keys(this.database.Groups).forEach(function(e){var t=a.database.Groups[e];t.filterModel=t.filterModel.filter(function(e){return e.name!==r})})}function s(e,t){o.apply(this,[-1,e])}function c(e,t){var r="profile-"+t,a=this;Object.keys(this.database.Groups).forEach(function(t){var n=a.database.Groups[t];n.filterModel=n.filterModel.map(function(t){return t.name===r&&(t.name="profile-"+e),t})})}function u(e,t,r){var a="profile-"+e,n=this;Object.keys(this.database.Groups).forEach(function(e){var t=n.database.Groups[e];t.filterModel.forEach(function(e){if(e.name===a)for(var t in e.selectedOptions)r[t]||delete e.selectedOptions[t]})}),Object.keys(this.database.Groups).forEach(function(e){var t=n.database.Groups[e];t.filterModel=t.filterModel.filter(function(e){return e.name!==a?!0:0!=Object.keys(e.selectedOptions).length})})}e.prototype.getGroupNamesArray=function(e){e(null,Object.keys(this.database.Groups).sort(a.charOrdA))},e.prototype.getGroup=function(e,t){t(null,a.clone(this.database.Groups[e]))};var d=function(e,r,n){var i=a.getDataArray(r,n),o=t.values(e).filter(function(e){return e.doExport&&a.acceptDataRow(e.filterModel,i)}).map(function(e){return{groupName:e.name,text:e.characterDescription}});return o.sort(a.charOrdAFactory(t.prop("groupName"))),o};e.prototype.getCharacterGroupTexts=function(e,t){var r=this;this.getCharacterFilterInfo(function(a,n){return a?void t(a):void t(null,d(r.database.Groups,n,e))})},e.prototype.getAllCharacterGroupTexts=function(e){var t=this;this.getCharacterFilterInfo(function(r,a){if(r)return void e(r);var n=Object.keys(t.database.Characters).reduce(function(e,r){return e[r]=d(t.database.Groups,a,r),e},{});e(null,n)})},e.prototype.isGroupNameUsed=function(e,t){t(null,void 0!==this.database.Groups[e])},e.prototype.createGroup=function(e,t){if(""===e)return void t(new n.ValidationError("groups-group-name-is-not-specified"));if(this.database.Groups[e])return void t(new n.ValidationError("groups-group-name-already-used",[e]));var r={name:e,masterDescription:"",characterDescription:"",filterModel:[],doExport:!0};this.database.Groups[e]=r,this.ee.trigger("createGroup",arguments),t&&t()},e.prototype.renameGroup=function(e,t,r){if(""===t)return void r(new n.ValidationError("groups-new-group-name-is-not-specified"));if(e===t)return void r(new n.ValidationError("groups-names-are-the-same"));if(this.database.Groups[t])return void r(new n.ValidationError("groups-group-name-already-used",[t]));var a=this.database.Groups[e];a.name=t,this.database.Groups[t]=a,delete this.database.Groups[e],this.ee.trigger("renameGroup",arguments),r&&r()},e.prototype.removeGroup=function(e,t){delete this.database.Groups[e],this.ee.trigger("removeGroup",arguments),t&&t()},e.prototype.saveFilterToGroup=function(e,t,r){var i=a.isFilterModelCompatibleWithProfiles(this.database.ProfileSettings,t);return 0!=i.length?void r(new n.ValidationError("groups-page-filter-is-incompatible-with-base-profiles",[i.join(",")])):(this.database.Groups[e].filterModel=t,void(r&&r()))},e.prototype.updateGroupField=function(e,t,r,a){var n=this.database.Groups[e];n[t]=r,a&&a()},e.prototype.getCharacterFilterInfo=function(e){var n=this;n.getCharacterNamesArray(function(i,o){return i?void e(i):(o=n._getOwnerMap?n._getOwnerMap("Characters"):t.zipObj(o,t.repeat("user",o.length)),void n.getAllProfiles(function(t,i){return t?void e(t):void n.getCharactersSummary(function(t,s){return t?void e(t):void n.getAllProfileSettings(function(t,n){if(t)return void e(t);var c=a.makeFilterInfo(n,o,i,s,r);e(null,c)})})}))})},i.removeProfileItem=i.removeProfileItem||[],i.removeProfileItem.push(o),i.changeProfileItemType=i.changeProfileItemType||[],i.changeProfileItemType.push(s),i.renameProfileItem=i.renameProfileItem||[],i.renameProfileItem.push(c),i.replaceEnumValue=i.replaceEnumValue||[],i.replaceEnumValue.push(u);var l=function(e,r){var a=t.indexBy(t.prop("name"),e),n=t.indexBy(t.prop("name"),r);return t.equals(a,n)},m=function(e,r){return 0==t.symmetricDifference(t.keys(e),t.keys(r)).length},p=function(e,r){return 0==t.difference(t.keys(e),t.keys(r)).length},f=function(e,r){var a=t.indexBy(t.prop("name"),e),n=t.indexBy(t.prop("name"),r),i=t.keys(a),o=t.keys(n);return 0==o.length?!0:0!=t.difference(o,i).length?!1:o.every(function(e){var r=n[e],i=a[e];switch(r.type){case"text":case"string":return-1!==i.regexString.indexOf(r.regexString);case"enum":case"checkbox":return 0==t.difference(t.keys(r.selectedOptions),t.keys(i.selectedOptions)).length;case"number":if("greater"===i.condition&&"lesser"===r.condition)return!1;if("lesser"===i.condition&&"greater"===r.condition)return!1;if("equal"===i.condition)return"equal"!==r.condition?!1:i.num==r.num;if("greater"===i.condition)return i.num<=r.num;if("lesser"===i.condition)return i.num>=r.num}})},h=function(e){t.values(e).forEach(function(r){for(var a=t.keys(r),n=0;n<a.length;++n)for(var i=0;i<a.length;++i)if(n!=i){var o=a[n],s=a[i];e[o][s]&&delete r[s]}})},g=function(e,r,a){function n(e){if(i[e])return i[e];var a=t.keys(r[e]);return 0==a.length?1:a.map(n).reduce(function(e,t){return t>e?t:e},-1)+1}var i={};t.keys(r).forEach(function(e){i[e]||(i[e]=n(e))});var o=t.keys(r).map(function(r){return{id:r,label:[r].concat(e[r]||[]).join(", "),level:i[r],title:t.keys(a[r]).join(", ")}}),s=t.keys(r).reduce(function(e,a){return e.concat(t.keys(r[a]).map(function(e){return{from:a,to:e,arrow:"to"}}))},[]);return{nodes:o,edges:s}},y=function(e,r,a,n,i){for(var o=t.keys(e),s=t.zipObj(o,t.repeat(!0,o.length)),c={},u=0;u<o.length;++u){var d=o[u];if(s[d])for(var l=u+1;l<o.length;++l){var m=o[l];s[m]&&r(n(d),n(m))&&(s[m]=!1,c[d]=c[d]||[],c[d].push(m))}}for(var p=t.toPairs(s).filter(function(e){return e[1]}).map(t.head),f=t.zipObj(p,t.ap([t.clone],t.repeat({},p.length))),u=0;u<p.length;++u)for(var l=0;l<p.length;++l)if(u!=l){var d=p[u],m=p[l];a(n(d),n(m))&&(f[d][m]=!0)}return h(f),g(c,f,i)},v=function(e,r,n){var i=t.keys(e),o=t.zipObj(i,t.ap([t.clone],t.repeat({},i.length)));return r.forEach(function(t){var r=a.getDataArray(n,t);i.forEach(function(n){a.acceptDataRow(e[n].filterModel,r)&&(o[n][t]=!0)})}),o};e.prototype.getGroupSchemas=function(e){var r=this;this.getCharacterFilterInfo(function(a,n){if(a)return void e(a);var i={},o=r.database.Groups,s=v(o,t.keys(r.database.Characters),n);i.theory=y(o,l,f,function(e){return o[e].filterModel},s),i.practice=y(o,m,p,function(e){return s[e]},s),e(null,i)})}}e(t)}(function(e){"undefined"==typeof exports?this.groupsAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a,n,i){function o(e,r){"resources"!==r&&(t.path(p,this.database)[h(e,r)]={})}function s(e,r){var a=h(e,r),n=t.path(p,this.database);delete n[a],t.values(n).forEach(function(e){delete e[a]})}function c(e,r,a){var n=t.path(p,this.database),i=h(r,a),o=h(e,a);"groups"===a&&(n[i]=n[o],delete n[o]),t.values(n).forEach(function(e){void 0!==e[o]&&(e[i]=e[o],delete e[o])})}function u(e,r){var a=t.path(m,this.database),n=a[e];n.name=r,a[r]=n,delete a[e],c.apply(this,[e,r,"groups"])}function d(e){var r=t.path(m,this.database);if(void 0!==r[e]){delete r[e],r=t.path(p,this.database);var a=h(e,"groups");delete r[a],t.values(r).forEach(function(e){void 0!==e[a]&&delete e[a]})}}var l=["InvestigationBoard","resources"],m=["InvestigationBoard","groups"],p=["InvestigationBoard","relations"],f="investigation-board";e.prototype.isResourceNameUsed=function(e,t){t(null,void 0!==this.database.InvestigationBoard.resources[e])},e.prototype.getInvestigationBoardData=function(e){e(null,a.clone(this.database.InvestigationBoard))},e.prototype.addBoardGroup=function(e,t){if(""===e)return void t(new n.ValidationError(f+"-group-name-is-not-specified"));var r=this.database.InvestigationBoard;return r.groups[e]?void t(new n.ValidationError(f+"-group-already-used-on-board")):(r.groups[e]={name:e,notes:""},this.ee.trigger("nodeAdded",[e,"groups"]),void(t&&t()))},e.prototype.switchGroups=function(e,r,a){var n=this._renameEntityPrecondition(e,r,m,f);if(n)a(n);else{var i=t.path(m,this.database),o=i[e];o.name=r,i[r]=o,delete i[e],this.ee.trigger("nodeRenamed",[e,r,"groups"]),a&&a()}},e.prototype.setGroupNotes=function(e,r,a){var n=t.path(m,this.database),i=n[e];i.notes=r,a&&a()},e.prototype.removeBoardGroup=function(e,t){if(""===e)return void t(new n.ValidationError(f+"-group-name-is-not-specified"));var r=this.database.InvestigationBoard;return r.groups[e]?(delete r.groups[e],this.ee.trigger("nodeRemoved",[e,"groups"]),void(t&&t())):void t(new n.ValidationError(f+"-group-is-not-used-on-board"))},e.prototype._createEntityPrecondition=function(e,r,a){return""===e?new n.ValidationError(a+"-new-name-is-not-specified"):void 0!==t.path(r,this.database)[e]?new n.ValidationError(a+"-name-already-used",[e]):void 0},e.prototype._renameEntityPrecondition=function(e,r,a,i){return""===r?new n.ValidationError(i+"-rename-name-is-not-specified"):r===e?new n.ValidationError(i+"-names-are-the-same"):t.path(a,this.database)[r]?new n.ValidationError(i+"-name-already-used",[r]):void 0},e.prototype.createResource=function(e,r){var a=this._createEntityPrecondition(e,l,f);a?r(a):(t.path(l,this.database)[e]={name:e},this.ee.trigger("nodeAdded",[e,"resources"]),r&&r())},e.prototype.renameResource=function(e,r,a){var n=this._renameEntityPrecondition(e,r,l,f);if(n)a(n);else{var i=t.path(l,this.database),o=i[e];o.name=r,i[r]=o,delete i[e],this.ee.trigger("nodeRenamed",[e,r,"resources"]),a&&a()}},e.prototype.removeResource=function(e,r){delete t.path(l,this.database)[e],this.ee.trigger("nodeRemoved",[e,"resources"]),r&&r()},e.prototype._addEdgePrecondition=function(e,r,i,o){return a.startsWith(e,"resource-")?new n.ValidationError(o+"-resource-node-cant-be-first"):void 0!==t.path(p,this.database)[e][r]?new n.ValidationError(o+"-such-relation-already-exists"):void 0},e.prototype.addEdge=function(e,r,a,n){var i=this._addEdgePrecondition(e,r,a,f);i?n(i):(t.path(p,this.database)[e][r]=a,n&&n())},e.prototype._setEdgeLabelPrecondition=function(e,r,i,o){return a.startsWith(e,"resource-")?new n.ValidationError(o+"-resource-node-cant-be-first"):void 0===t.path(p,this.database)[e][r]?new n.ValidationError(o+"-relation-is-not-exist"):void 0},e.prototype.setEdgeLabel=function(e,r,a,n){var i=this._setEdgeLabelPrecondition(e,r,a,f);i?n(i):(t.path(p,this.database)[e][r]=a,n&&n())},e.prototype.removeEdge=function(e,r,a){delete t.path(p,this.database)[e][r],a&&a()};var h=function(e,t){return("groups"===t?"group-":"resource-")+e};i.nodeAdded=i.nodeAdded||[],i.nodeAdded.push(o),i.nodeRemoved=i.nodeRemoved||[],i.nodeRemoved.push(s),i.nodeRenamed=i.nodeRenamed||[],i.nodeRenamed.push(c),i.renameGroup=i.renameGroup||[],i.renameGroup.push(u),i.removeGroup=i.removeGroup||[],i.removeGroup.push(d)}e(t)}(function(e){"undefined"==typeof exports?this.investigationBoardAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r){e.prototype.log=function(e,t,a,n,i){var o=[e,(new Date).toString(),t,JSON.stringify(n)];this.database&&(a&&void 0!=this.database.Log[this.database.Log.length-1]?this.database.Log[this.database.Log.length-1][2]===t&&(this.database.Log[this.database.Log.length-1]=o):(this.database.Log.push(o),this.database.Log.length>2e3&&this.database.Log.splice(0,1e3))),console.log(r.strFormat("{0},{1},{2},{3}",o)),i&&i()},e.prototype.getLog=function(e,t){for(var r=[],a=100*e;100*(e+1)>a;a++)this.database.Log[a]&&r.push([a+1].concat(this.database.Log[a]));t(null,{requestedLog:r,logSize:Math.ceil(this.database.Log.length/100)})}}e(t)}(function(e){"undefined"==typeof exports?this.logAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a){e.prototype.getAllProfileSettings=function(e){e(null,r.clone(this.database.ProfileSettings))},e.prototype.createProfileItem=function(e,t,r,n,i,o){var s=this;this.isProfileItemNameUsed(e,function(c,u){if(c)return void o(c);if(u)return void o(new a.ValidationError("characters-such-name-already-used"));var d={name:e,type:t,value:r,doExport:!0};n?s.database.ProfileSettings.push(d):s.database.ProfileSettings.splice(i,0,d),s.ee.trigger("createProfileItem",[e,t,r]),o()})},e.prototype.moveProfileItem=function(e,t,r){t>e&&t--;var a=this.database.ProfileSettings,n=a[e];a.splice(e,1),a.splice(t,0,n),r()},e.prototype.removeProfileItem=function(e,t,a){r.removeFromArrayByIndex(this.database.ProfileSettings,e),this.ee.trigger("removeProfileItem",arguments),a()},e.prototype.changeProfileItemType=function(e,r,a){var n=this.database.ProfileSettings.filter(function(t){return t.name===e})[0];n.type=r,n.value=t.profileFieldTypes[r].value,this.ee.trigger("changeProfileItemType",arguments),a()},e.prototype.isProfileItemNameUsed=function(e,t){if(""===e)return void t(new a.ValidationError("characters-profile-item-name-is-not-specified"));if("name"===e)return void t(new a.ValidationError("characters-profile-item-name-cant-be-name"));var r=function(t){return e===t.name};t(null,this.database.ProfileSettings.some(r))},e.prototype.renameProfileItem=function(e,t,r){var n=this;this.isProfileItemNameUsed(e,function(i,o){return i?void r(i):o?void r(new a.ValidationError("characters-such-name-already-used")):(n.ee.trigger("renameProfileItem",[e,t]),n.database.ProfileSettings.filter(function(e){return e.name===t})[0].name=e,void r())})},e.prototype.doExportProfileItemChange=function(e,t,r){var a=this.database.ProfileSettings.filter(function(t){return t.name===e})[0];a.doExport=t,r()},e.prototype.updateDefaultValue=function(e,t,r){var n,i,o,s,c=this.database.ProfileSettings.filter(function(t){return t.name===e})[0];switch(c.type){case"text":case"string":case"checkbox":c.value=t;break;case"number":if(isNaN(t))return void r(new a.ValidationError("characters-not-a-number"));c.value=Number(t);break;case"enum":if(""===t)return void r(new a.ValidationError("characters-enum-item-cant-be-empty"));n=c.value.split(","),i=t.split(","),i=i.map(function(e){return e.trim()}),o=[{}].concat(i).reduce(function(e,t){return e[t]=!0,e}),s=n.filter(function(e){return!o[e]}),0!==s.length&&this.ee.trigger("replaceEnumValue",[e,i[0],o]),c.value=i.join(",")}r()}}e(t)}(function(e){"undefined"==typeof exports?this.profileConfigurerAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a,n,i){var o=["Relations"];e.prototype._getKnownCharacters=function(e,r){var a=e.Stories,n={};return t.values(a).forEach(function(e){var a=t.compose(t.not,t.isNil,t.prop(r),t.prop("characters"));e.events.filter(a).forEach(function(r){t.keys(r.characters).forEach(function(t){n[t]=n[t]||{},n[t][e.name]=!0})})}),delete n[r],n},e.prototype.getRelationsSummary=function(e,r){var a=t.path(o,this.database),n={};t.keys(a).forEach(function(t){var r=a[t];r[e]&&(n[t]=r[e])}),r(null,{directRelations:a[e]||{},reverseRelations:n,knownCharacters:this._getKnownCharacters(this.database,e)})};var s=function(e,t,r){return void 0===r.Characters[e]?new n.ValidationError("briefings-character-does-not-exist",[e]):void 0===r.Characters[t]?new n.ValidationError("briefings-character-does-not-exist",[t]):void 0};e.prototype.setCharacterRelation=function(e,r,a,n){var i=s(e,r,this.database),c=t.path(o,this.database);i?n(i):(a=a.trim(),""===a?void 0!==c[e]&&delete c[e][r]:(c[e]=c[e]||{},c[e][r]=a),n&&n())};var c=function(e,r){var a=t.path(o,this.database);void 0!==a[e]&&(a[r]=a[e],delete a[e]),t.values(a).forEach(function(t){void 0!==t[e]&&(t[r]=t[e],delete t[e])})};i.renameCharacter=i.renameCharacter||[],i.renameCharacter.push(c);var u=function(e){var r=t.path(o,this.database);void 0!==r[e]&&delete r[e],t.values(r).forEach(function(t){void 0!==t[e]&&delete t[e]})};i.removeCharacter=i.removeCharacter||[],i.removeCharacter.push(u)}e(t)}(function(e){"undefined"==typeof exports?this.relationsAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r){e.prototype.getStatistics=function(e){var t=this;this.getAllCharacterGroupTexts(function(r,n){return r?void e(r):void a(t.database,n,e)})};var a=function(e,r,a){var n={};n.storyNumber=Object.keys(e.Stories).length,n.characterNumber=Object.keys(e.Characters).length,n.eventsNumber=t.sum(t.values(e.Stories).map(t.compose(t.length,t.prop("events")))),n.userNumber=1,e.ManagementInfo&&e.ManagementInfo.UsersInfo&&(n.userNumber=Object.keys(e.ManagementInfo.UsersInfo).length),n.textCharacterNumber=E(e);var o=x(e);n.firstEvent=o[0]?o[0]:"",n.lastEvent=o[1]?o[1]:"",n.storyEventsHist=S(e,function(e){return e.events.length}),n.storyCharactersHist=S(e,function(e){return Object.keys(e.characters).length}),n.eventCompletenessHist=f(e),n.characterStoriesHist=p(e,u),n.characterSymbolsHist=p(e,d(r)),n.generalCompleteness=v(e),n.storyCompleteness=y(e),n.characterChartData=s(e,"characters","Characters"),n.storyChartData=s(e,"stories","Stories"),n.groupChartData=s(e,"groups","Groups"),n.profileCharts=i(e),a(null,n)},n=function(e){var t=e.reduce(function(e,t){return t>e?t:e},e[0]),r=e.reduce(function(e,t){return e>t?t:e},e[0]),a=Math.ceil((t-r)/20);a=0===a?1:a;for(var n=1;a>10*n;)n=10*n;for(var i=[1,2,5,10,12],o=0;o<i.length-1;o++)if(n*i[o]<a&&a<n*i[o+1]){a=n*i[o];break}return a},i=function(e){var r=e.ProfileSettings.filter(function(e){return"string"!==e.type&&"text"!==e.type}).map(t.pick(["name","type"])),a=t.groupBy(t.__,t.values(e.Characters)),i=function(e){return t.fromPairs(t.toPairs(e).map(function(e){return e[1]=e[1].length,e}))},o=r.map(function(r){if("enum"===r.type||"checkbox"===r.type)return i(a(t.prop(r.name)));var o=t.ap([t.prop(r.name)],t.values(e.Characters)),s=n(o);return{groups:i(a(function(e){return Math.floor(e[r.name]/s)})),step:s}});return t.transpose([r,o]).map(function(e){return t.assoc("data",e[1],e[0])})},o=function(e,t,r){return[e,": ",(t/r*100).toFixed(0),"% (",t,"/",r,")"].join("")},s=function(e,t,r){var a=[],n=Object.keys(e[r]).length,i=0;if(e.ManagementInfo&&e.ManagementInfo.UsersInfo){var s,c;for(var u in e.ManagementInfo.UsersInfo)s=e.ManagementInfo.UsersInfo[u],c=s[t].length,a.push({value:c,label:o(u,c,n)}),i+=c;i!==n&&a.push({value:n-i,label:o("unknown",n-i,n)})}else a.push({value:n,label:o("user",n,n)});return a},c=function(e,t,r,a,n,i){e[r]?(e[r].value=i(e[r].value,t),e[r].tip.push(a)):e[r]={value:n(t),label:r,tip:[a]}},u=function(e,r){t.values(e.Stories).forEach(function(e){t.keys(e.characters).forEach(function(e){r[e]++})})},d=t.curry(function(e,r,a){t.values(r.Stories).forEach(function(e){e.events.forEach(function(e){for(var t in e.characters)0!=e.characters[t].text.length?a[t]+=b(e.characters[t].text):a[t]+=b(e.text)})});for(var n in e)a[n]+=t.sum(e[n].map(t.pipe(t.prop("text"),b)))}),l=function(e,t){return e+" ("+t+")"},m=function(e,t,r){return e*t+"-"+((e+1)*t-1)+": "+r.join(", ")},p=function(e,r){var a=t.keys(e.Characters),i=t.zipObj(a,t.repeat(0,a.length));r(e,i);for(var o=t.values(i),s=n(o),u=t.keys(i).reduce(function(e,r){var a=Math.floor(i[r]/s);return c(e,1,a,l(r,i[r]),t.always(1),t.add),e},[]),d=0;d<t.max(u.length,10);d++)u[d]?u[d].tip=m(d,s,u[d].tip):u[d]=null;return u},f=function(e){var r,a,n=[];for(var i in e.Stories){r=e.Stories[i],a=g(r);var o=Math.floor(10*a),s=r.name+" ("+(100*a).toFixed(0)+"%)";c(n,1,o,s,t.always(1),t.add)}for(var u=0;11>u;u++)n[u]?n[u].tip=n[u].tip.join(", "):n[u]=null;return n},h=function(e){var t=0,r=0;return e.events.forEach(function(e){r+=Object.keys(e.characters).length;for(var a in e.characters)e.characters[a].ready&&t++}),{finishedAdaptations:t,allAdaptations:r}},g=function(e){var t=h(e);return 0!==t.allAdaptations?t.finishedAdaptations/t.allAdaptations:0},y=function(e){var r=0,a=Object.keys(e.Stories).length;return t.values(e.Stories).map(h).forEach(function(e){e.allAdaptations===e.finishedAdaptations&&0!=e.allAdaptations&&r++}),[(r/(0===a?1:a)*100).toFixed(1),r,a]},v=function(e){var r=0,a=0;return t.values(e.Stories).map(h).forEach(function(e){r+=e.finishedAdaptations,a+=e.allAdaptations}),[(r/(0===a?1:a)*100).toFixed(1),r,a]},b=function(e){return e.replace(/\s/g,"").length},E=function(e){var r,a,n,i=0;for(n in e.Stories)r=e.Stories[n],i+=b(r.story),r.events.forEach(function(e){i+=b(e.text);for(a in e.characters)i+=b(e.characters[a].text)});return i+=t.sum(t.values(e.Groups).map(t.compose(b,t.prop("characterDescription"))))},x=function(e){var t,r,a=null,n=null;for(var i in e.Stories)t=e.Stories[i],t.events.forEach(function(e){""!=e.time&&(r=new Date(e.time),(null===a||r>a)&&(a=r),(null===n||n>r)&&(n=r))});return[n,a]},S=function(e,r){var a,n=[];for(var i in e.Stories){a=e.Stories[i];var o=r(a);c(n,1,o,a.name,t.always(1),t.add)}for(var s=0;s<n.length;s++)n[s]?n[s].tip=s+": "+n[s].tip.join(", "):n[s]=null;return n}}e(t)}(function(e){"undefined"==typeof exports?this.statisticsAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t){e.prototype.getFilteredStoryNames=function(e,n){var i=Object.keys(this.database.Stories).sort(t.charOrdA),o=this;i=i.map(function(e){return{storyName:e,isFinished:a(o.database,e),isEmpty:r(o.database,e)}}),e&&(i=i.filter(function(e){return!e.isFinished||e.isEmpty})),n(null,i)};var r=function(e,t){return 0==e.Stories[t].events.length},a=function(e,t){return e.Stories[t].events.every(function(e){var t=!0;for(var r in e.characters)if(e.characters[r]&&!e.characters[r].ready){t=!1;break}return t})};e.prototype.getFilteredCharacterNames=function(e,r,a){var n;n=this.database.Stories[e].characters,n=Object.keys(n).sort(t.charOrdA);var s=this;n=n.map(function(t){return{characterName:t,isFinished:o(s.database,e,t),isEmpty:i(s.database,e,t)}}),r&&(n=n.filter(function(e){return!e.isFinished||e.isEmpty})),a(null,n)},e.prototype.getFilteredEventNames=function(e,t,r){var a=this.database.Stories[e].events.map(function(e,t){return{name:e.name,index:t,isFinished:n(e),isEmpty:0===Object.keys(e.characters).length}});t&&(a=a.filter(function(e){return!e.isFinished||e.isEmpty})),r(null,a)};var n=function(e){for(var t in e.characters)if(!e.characters[t].ready)return!1;return!0},i=function(e,t,r){return e.Stories[t].events.every(function(e){return!e.characters[r]})},o=function(e,t,r){return e.Stories[t].events.every(function(e){return e.characters[r]?e.characters[r].ready:!0})};e.prototype.getEvents=function(e,r,a){var n,i=t.clone(this.database.Stories[e].events).map(function(e,t){return e.index=t,e}).filter(function(e){for(n=0;n<r.length;n++)if(e.characters[r[n]])return!0;return!1});a(null,i)},e.prototype.setEventAdaptationTime=function(e,t,r,a,n){var i=this.database.Stories[e].events[t];i.characters[r].time=a,n()},e.prototype.setOriginEventText=function(e,t,r,a){var n=this.database.Stories[e].events[t];n.text=r,a()},e.prototype.setAdaptationEventText=function(e,t,r,a,n){var i=this.database.Stories[e].events[t];i.characters[r].text=a,n()},e.prototype.changeAdaptationReadyStatus=function(e,t,r,a,n){var i=this.database.Stories[e].events[t];i.characters[r].ready=a,n()}}e(t)}(function(e){"undefined"==typeof exports?this.storyAdaptationsAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a){e.prototype.getStoryNamesArray=function(e){e(null,Object.keys(this.database.Stories).sort(r.charOrdA))},e.prototype.getAllStories=function(e){e(null,r.clone(this.database.Stories))},e.prototype.getMasterStory=function(e,t){t(null,this.database.Stories[e].story)},e.prototype.updateMasterStory=function(e,t,r){this.database.Stories[e].story=t,r()},e.prototype.isStoryExist=function(e,t){t(null,void 0!==this.database.Stories[e])},e.prototype.createStory=function(e,t){return""===e?void t(new a.ValidationError("stories-story-name-is-not-specified")):this.database.Stories[e]?void t(new a.ValidationError("stories-story-name-already-used",[e])):(this.database.Stories[e]={name:e,story:"",characters:{},events:[]},this.ee.trigger("createStory",arguments),void t())},e.prototype.renameStory=function(e,t,r){if(""===t)return void r(new a.ValidationError("stories-story-name-is-not-specified"));if(e===t)return void r(new a.ValidationError("stories-names-are-the-same"));if(this.database.Stories[t])return void r(new a.ValidationError("stories-story-name-already-used",[t]));var n=this.database.Stories[e];n.name=t,this.database.Stories[t]=n,delete this.database.Stories[e],this.ee.trigger("renameStory",arguments),r()},e.prototype.removeStory=function(e,t){delete this.database.Stories[e],this.ee.trigger("removeStory",arguments),t()}}e(t)}(function(e){"undefined"==typeof exports?this.storyBaseAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a,n){e.prototype.getStoryCharacterNamesArray=function(e,t){var a=this.database.Stories[e].characters;t(null,Object.keys(a).sort(r.charOrdA))},e.prototype.getStoryCharacters=function(e,t){t(null,r.clone(this.database.Stories[e].characters))},e.prototype.addStoryCharacter=function(e,t,r){return""===t?void r(new a.ValidationError("stories-character-name-is-not-specified")):(this.database.Stories[e].characters[t]={name:t,inventory:"",activity:{}},void r())},e.prototype.switchStoryCharacters=function(e,t,r,n){if(""===t||""===r)return void n(new a.ValidationError("stories-one-of-switch-characters-is-not-specified"));var i=this.database.Stories[e];i.characters[r]=i.characters[t],i.characters[r].name=r,delete i.characters[t],i.events.forEach(function(e){e.characters[t]&&(e.characters[r]=e.characters[t],delete e.characters[t])}),n()},e.prototype.removeStoryCharacter=function(e,t,r){if(""===t)return void r(new a.ValidationError("stories-character-name-is-not-specified"));var n=this.database.Stories[e];delete n.characters[t],n.events.forEach(function(e){delete e.characters[t]}),r()};var i=function(e,t){var r,a,n,i=function(r){r.characters[e]&&(n=r.characters[e],r.characters[t]=n,delete r.characters[e])};for(r in this.database.Stories)a=this.database.Stories[r],a.characters[e]&&(n=a.characters[e],n.name=t,a.characters[t]=n,delete a.characters[e],a.events.forEach(i))};n.renameCharacter=n.renameCharacter||[],n.renameCharacter.push(i);var o=function(e){var t,r,a=function(t){t.characters[e]&&delete t.characters[e]};for(t in this.database.Stories)r=this.database.Stories[t],r.characters[e]&&(delete r.characters[e],r.events.forEach(a))};n.removeCharacter=n.removeCharacter||[],n.removeCharacter.push(o),e.prototype.updateCharacterInventory=function(e,t,r,a){this.database.Stories[e].characters[t].inventory=r,a()},e.prototype.onChangeCharacterActivity=function(e,t,r,a,n){var i=this.database.Stories[e].characters[t];a?i.activity[r]=!0:delete i.activity[r],n()},e.prototype.addCharacterToEvent=function(e,t,r,a){this.database.Stories[e].events[t].characters[r]={text:"",time:""},a()},e.prototype.removeCharacterFromEvent=function(e,t,r,a){delete this.database.Stories[e].events[t].characters[r],a()}}e(t)}(function(e){"undefined"==typeof exports?this.storyCharactersAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a){e.prototype.getStoryEvents=function(e,t){t(null,r.clone(this.database.Stories[e].events))},e.prototype.createEvent=function(e,t,r,n,i,o){if(""===t)return void o(new a.ValidationError("stories-event-name-is-not-specified"));if(""===r)return void o(new a.ValidationError("stories-event-text-is-empty"));
var s={name:t,text:r,time:"",characters:{}};n?this.database.Stories[e].events.push(s):this.database.Stories[e].events.splice(i,0,s),o()},e.prototype.moveEvent=function(e,t,r,a){r>t&&r--;var n=this.database.Stories[e].events,i=n[t];n.splice(t,1),n.splice(r,0,i),a()},e.prototype.cloneEvent=function(e,t,a){var n=this.database.Stories[e],i=n.events[t],o=r.clone(i);n.events.splice(t,0,o),a()},e.prototype.mergeEvents=function(e,t,n){var i=this.database.Stories[e];if(i.events.length===t+1)return void n(new a.ValidationError("stories-cant-merge-last-event"));var o=i.events[t],s=i.events[t+1];o.name+=s.name,o.text+=s.text;for(var c in s.characters)o.characters[c]?(o.characters[c].text+=s.characters[c].text,o.characters[c].time+=s.characters[c].time,o.characters[c].ready=!1):o.characters[c]=s.characters[c];r.removeFromArrayByIndex(i.events,t+1),n()},e.prototype.removeEvent=function(e,t,a){var n=this.database.Stories[e];r.removeFromArrayByIndex(n.events,t),a()},e.prototype.updateEventProperty=function(e,t,r,n,i){if("name"===r&&""===n.trim())return void i(new a.ValidationError("stories-event-name-is-not-specified"));if("text"===r&&""===n.trim())return void i(new a.ValidationError("stories-event-text-is-empty"));this.database.Stories[e].events[t][r]=n;i()}}e(t)}(function(e){"undefined"==typeof exports?this.storyEventsAPI=e:module.exports=e}.bind(this)),function(e){function t(e,t,r,a){e.prototype.getAllInventoryLists=function(e,t){var r=[];for(var a in this.database.Stories){var n=this.database.Stories[a];n.characters[e]&&n.characters[e].inventory&&""!==n.characters[e].inventory&&r.push({storyName:a,inventory:n.characters[e].inventory})}t(null,r)},e.prototype.getCharacterEventGroupsByStory=function(e,a){var n,i=[],o=this;Object.keys(this.database.Stories).filter(function(t){return o.database.Stories[t].characters[e]}).forEach(function(t){n=[];var a=r.clone(o.database.Stories[t].events);a.map(function(e,r){return e.index=r,e.storyName=t,e.isTimeEmpty=""===e.time,e.time=e.isTimeEmpty?o.database.Meta.date:e.time,e}).filter(function(t){return t.characters[e]}).forEach(function(e){n.push(e)}),i.push({storyName:t,events:n})}),i.sort(r.charOrdAFactory(t.prop("storyName"))),a(null,i)},e.prototype.getCharacterEventsByTime=function(e,t){var a=[],n=this;Object.keys(this.database.Stories).filter(function(t){return n.database.Stories[t].characters[e]}).forEach(function(t){var i=r.clone(n.database.Stories[t].events);a=a.concat(i.map(function(e,r){return e.index=r,e.storyName=t,e.isTimeEmpty=""===e.time,e.time=e.isTimeEmpty?n.database.Meta.date:e.time,e}).filter(function(t){return t.characters[e]}))}),a.sort(r.eventsByTime),t(null,a)},e.prototype.getEventGroupsForStories=function(e,t){var a,n=[],i=this;Object.keys(this.database.Stories).filter(function(t){return-1!==e.indexOf(t)}).forEach(function(e){a=[];var t=r.clone(i.database.Stories[e].events);t.map(function(t,r){return t.index=r,t.storyName=e,t}).forEach(function(e){a.push(e)}),n.push({storyName:e,events:a})}),t(null,n)},e.prototype.getCharactersSummary=function(e){var r=t.keys(this.database.Characters),a={};r.forEach(function(e){a[e]={active:0,follower:0,defensive:0,passive:0,totalAdaptations:0,finishedAdaptations:0,totalStories:0}}),t.values(this.database.Stories).forEach(function(e){t.values(e.characters).forEach(function(e){var r=a[e.name];r.totalStories++,t.toPairs(e.activity).forEach(function(e){e[1]===!0&&r[e[0]]++})}),e.events.forEach(function(e){t.toPairs(e.characters).forEach(function(e){var t=a[e[0]];t.totalAdaptations++,e[1].ready&&t.finishedAdaptations++})})}),t.values(a).forEach(function(e){e.completeness=Math.round(100*e.finishedAdaptations/(0!=e.totalAdaptations?e.totalAdaptations:1))}),e(null,a)}}e(t)}(function(e){"undefined"==typeof exports?this.storyViewAPI=e:module.exports=e}.bind(this)),function(e){e.data={Meta:{name:"Властелин колец",date:"3019/02/27 00:00",preGameDate:"3018/01/01 00:00",description:"События фильма, как основа для ролевой игры. В этой базе изложен первый фильм из трилогии Властелин колец. Хронология событий взята из книги.",saveTime:"Thu Oct 27 2016 19:27:47 GMT+0500 (Pakistan Standard Time)"},Characters:{"Фродо":{name:"Фродо","Пол":"М","Раса":"хоббит","Биография":"Хоббит, волею судеб ставший хранителем Единого Кольца, принадлежащего Тёмному Властелину. ","Оружие":"каштаны","Вес, кг.":64,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Сэм":{name:"Сэм","Пол":"М","Раса":"хоббит","Биография":"Садовник, слуга и верный товарищ Фродо.","Оружие":"каштаны","Вес, кг.":57,"Умеет петь":!0,"Снаряжение":"Кастрюли","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Мерри":{name:"Мерри","Пол":"М","Раса":"хоббит","Биография":"Друг Фродо, взятый в поход за компанию.","Оружие":"каштаны","Вес, кг.":57,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Гендальф":{name:"Гендальф","Пол":"М","Раса":"майар","Биография":"Могущественный волшебник.","Оружие":"посох, магия","Вес, кг.":82,"Умеет петь":!1,"Снаряжение":"кольцо Нарья","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Арагорн":{name:"Арагорн","Пол":"М","Раса":"человек","Биография":"Последний вождь следопытов и первый король Воссоединённого Королевства, прямой потомок северной ветви королевского рода Элендила (по линии Исилдура, её старшей ветви — династии Эмлайта Артэдайнского).\nАрагорн стал величайшим из Людей своей эпохи, возглавлял Людей Запада в войне против сил Саурона, помог уничтожить Кольцо Всевластия (был одним из Девяти его Хранителей), воссоединил королевства Арнора и Гондора. ","Оружие":"меч, лук, нож","Вес, кг.":80,"Умеет петь":!0,"Снаряжение":"","Игрок":"Василий","Статус":"Занята","Картинка ВК":"photo-17502880_426145599","Картинка сайт":"Арагорн","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Леголас":{name:"Леголас","Пол":"М","Раса":"эльф","Биография":"Сын Трандуила, короля эльфов Северного Лихолесья.","Оружие":"лук, эльфийские ножи","Вес, кг.":57,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Гимли":{name:"Гимли","Пол":"М","Раса":"гном","Биография":"Представитель одного из свободных народов Средиземья (гномов), объединившихся для борьбы со Злом. ","Оружие":"топор","Вес, кг.":80,"Умеет петь":!1,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Саурон":{name:"Саурон","Пол":"М","Раса":"другое","Биография":"Низший дух из свиты Вала Аулэ. Саурон был одним из первых Майар, которые приняли сторону Мелькора, став одним из самых лояльных и самых ужасных его сподвижников, но после Войны Гнева и поражения своего господина Саурон возвысился до величайшего врага Свободных народов Средиземья на протяжении Второй и Третьей эпох.","Оружие":"","Вес, кг.":1,"Умеет петь":!1,"Снаряжение":"палантир","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Тёмный","Народ Гондора":!1,"Народ Рохана":!1},"Саруман":{name:"Саруман","Пол":"М","Раса":"майар","Биография":"Могущественнейший маг Ордена Истари, глава Белого совета. ","Оружие":"посох, магия","Вес, кг.":68,"Умеет петь":!1,"Снаряжение":"палантир","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Тёмный","Народ Гондора":!1,"Народ Рохана":!1},"Боромир":{name:"Боромир","Пол":"М","Раса":"человек","Биография":"Старший сын и наследник наместника Гондора Дэнетора II и его жены Финдуилас, брат Фарамира.","Оружие":"меч, лук","Вес, кг.":90,"Умеет петь":!1,"Снаряжение":"Рог Гондора","Игрок":"Петр","Статус":"Занята","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Нейтрал","Народ Гондора":!0,"Народ Рохана":!1},"Элронд":{name:"Элронд","Пол":"М","Раса":"эльф","Биография":"Сын полуэльфа Эарендила (в свою очередь, сына эльфийки Идриль и человека Туора) и полуэльфийки Эльвинг (дочери Диора, полуэльфа, и эльфийки Нимлот), брат Элроса, муж Келебриан — дочери Галадриэли и Келеборна, отец Арвен, Элладана и Элрохира. ","Оружие":"","Вес, кг.":72,"Умеет петь":!1,"Снаряжение":"кольцо Вилью","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Арвен":{name:"Арвен","Пол":"Ж","Раса":"эльф","Биография":"Дочь Элронда, внучка Галадриэль.","Оружие":"","Вес, кг.":55,"Умеет петь":!0,"Снаряжение":"","Игрок":"Ирина","Статус":"Занята","Картинка ВК":"photo-17502880_426145598","Картинка сайт":"Арвен","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Галадриэль":{name:"Галадриэль","Пол":"Ж","Раса":"эльф","Биография":"Могущественнейшая из эльфийских владык, оставшихся в Средиземье после Войны Гнева. Владычица Лориэна.","Оружие":"","Вес, кг.":53,"Умеет петь":!1,"Снаряжение":"кольцо Нэнью","Игрок":"Анна","Статус":"Занята","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Голлум":{name:"Голлум","Пол":"М","Раса":"другое","Биография":"Существо небольшого роста, крайне тощее и с большими светящимися глазами. Упоминается, что в прошлом он жил на поверхности. Голлум ранее был хоббитом, но он не любил солнце и стремился в самую глубь.","Оружие":"","Вес, кг.":34,"Умеет петь":!1,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Тёмный","Народ Гондора":!1,"Народ Рохана":!1},"Бильбо":{name:"Бильбо","Пол":"М","Раса":"хоббит","Биография":"Дядя Фродо Бэггинса.","Оружие":"меч, каштаны","Вес, кг.":73,"Умеет петь":!1,"Снаряжение":"","Игрок":"Михаил","Статус":"На обсуждении","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Назгул":{name:"Назгул","Пол":"М","Раса":"другое","Биография":"Девять владык из расы людей, порабощённых Кольцом Всевластия и ставших слугами Саурона.","Оружие":"","Вес, кг.":0,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Тёмный","Народ Гондора":!1,"Народ Рохана":!1},"Пиппин":{name:"Пиппин","Пол":"М","Раса":"хоббит","Биография":"Друг Фродо, взятый в поход за компанию.","Оружие":"каштаны","Вес, кг.":53,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос","Блок":"Светлый","Народ Гондора":!1,"Народ Рохана":!1},"Народ Гондора":{name:"Народ Гондора","Блок":"Тёмный","Игрок":"","Статус":"Свободна","Раса":"человек","Пол":"не важно","Оружие":"","Снаряжение":"","Вес, кг.":0,"Умеет петь":!1,"Биография":"","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"","Народ Гондора":!0,"Народ Рохана":!1},"Народ Рохана":{name:"Народ Рохана","Блок":"Тёмный","Игрок":"","Статус":"Свободна","Раса":"человек","Пол":"не важно","Оружие":"","Снаряжение":"","Вес, кг.":0,"Умеет петь":!1,"Биография":"","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"","Народ Гондора":!1,"Народ Рохана":!0}},ProfileSettings:[{name:"Блок",type:"enum",value:"Тёмный,Светлый,Нейтрал",doExport:!0},{name:"Игрок",type:"string",value:"",doExport:!0},{name:"Статус",type:"enum",value:"Свободна,Занята,На обсуждении",doExport:!0},{name:"Раса",type:"enum",value:"человек,эльф,гном,орк,хоббит,майар,другое",doExport:!0},{name:"Пол",type:"enum",value:"не важно,М,Ж",doExport:!0},{name:"Оружие",type:"string",value:"",doExport:!0},{name:"Снаряжение",type:"string",value:"",doExport:!0},{name:"Вес, кг.",type:"number",value:0,doExport:!0},{name:"Умеет петь",type:"checkbox",value:!1,doExport:!1},{name:"Биография",type:"text",value:"",doExport:!0},{name:"Картинка ВК",type:"string",value:"photo-17502880_426145597",doExport:!0},{name:"Картинка сайт",type:"string",value:"",doExport:!0},{name:"Народ Гондора",type:"checkbox",value:!1,doExport:!0},{name:"Народ Рохана",type:"checkbox",value:!1,doExport:!0}],Stories:{"Начало пути":{name:"Начало пути",story:"Гендальф активно узнает информацию о кольце.\nГендальф отправляет Фродо в Бри. Фродо бежит от черных всадников (защита).\nВ спутники к Фродо набиваются Сэм, Мерри и Пиппин.\nСаруман активно пленяет Гендальфа. Гендальф активно сбегает.\nАрагорн пассивно ждет хоббитов в Гарцующем пони. Потом он их защищает от назгулов.\nНазгулы активно преследуют Фродо и компанию.\nСаурон пассивно ждет когда Фродо оденет кольцо и таким образом укажет на себя.\nАрвен активно спасает Фродо от назгулов. Элронд пассивно ждет Фродо, чтобы его вылечить.\n\nВ свой очередной день рождения Бильбо устраивает праздник, и таинственно исчезает, оставляя все свои вещи племяннику Фродо. В том числе неизвестное кольцо.\n\nГендальф чувствует черную магию в кольце и отправляется в Минас-Тирит, для получения большей информации.\n\nСаурон узнает от Голлума у кого сейчас находится кольцо и отправляет за ним назгулов.\n\nГендальф возвращается в Шир, чтобы предупредить Фродо об опасности, древние зло пробудилось и за Фродо отправлены черные всадники. Гендальф проверяет кольцо и оно оказывается тем самым кольцом. Гендальф отправляет Фродо в Бри в таверну Гарцующий пони. Этот разговор услышал Сэм и за это его добавили к пати.\n\nГендальф отправляется к Саруману, чтобы выработать план действий, но Саруман уже на темной стороне.\n\nПо пути из Шира Фродо и Сэм встречают Мерри и Пипина, ворующих овощи. Внезапно появляются назгулы, и Мерри с Пиппином присоединяются к пати.\n\nПартия приходит в Бри, и останавливается в Гарцующем пони. Гендальфа там нет. Фродо случайно одевает кольцо, под действием кольца. Это видит Бродяжник. Бродяжник объясняет, что он друг и отводит хоббитов в другой ночлег.\n\nНочью назгулы приходят в гарцующий пони и разносят комнату хоббитов, которых там нет.\n\nНазгулы настигают хоббитов в развалинах Амон Сул. Один из них ранит Фродо. Бродяжник прогоняет назгулов. Появляется Арвен, везет Фродо в Ривенделл, спасаясь от назгулов.\n\nАрвен привозит Фродо в Ривенделл. Назгулы не могут перейти реку на границе Ривенделла.\n\nФродо исцеляют, он встречается с Бильбо, получает у него еще часть наследства - меч и кольчугу и собирается идти домой, считая свою миссию выполненной.",characters:{"Арагорн":{name:"Арагорн",inventory:"",activity:{passive:!0,follower:!0}},"Арвен":{name:"Арвен",inventory:"",activity:{active:!0}},"Бильбо":{name:"Бильбо",inventory:"",activity:{passive:!0}},"Гендальф":{name:"Гендальф",inventory:"",activity:{active:!0}},"Мерри":{name:"Мерри",inventory:"",activity:{follower:!0}},"Фродо":{name:"Фродо",inventory:"кольцо, жало, мифриловая кольчуга",activity:{defensive:!0}},"Сэм":{name:"Сэм",inventory:"",activity:{follower:!0}},"Назгул":{name:"Назгул",inventory:"",activity:{active:!0}},"Саурон":{name:"Саурон",inventory:"",activity:{passive:!0}},"Саруман":{name:"Саруман",inventory:"",activity:{active:!0}},"Элронд":{name:"Элронд",inventory:"",activity:{passive:!0}},"Пиппин":{name:"Пиппин",inventory:"",activity:{follower:!0}}},events:[{name:"День рождения Бильбо",text:"В свой очередной день рождения Бильбо устраивает праздник, и таинственно исчезает, оставляя все свои вещи племяннику Фродо. В том числе неизвестное кольцо.",time:"3001/09/22 21:00",characters:{"Гендальф":{text:"Я всегда знал, что Бильбо не обычный хоббит. Хотя конечно его последняя выходка с исчезновением во время праздника мне не понраву, все же у него хватило духа и сил перебраться к эльфам.",time:"22 сентября 3001",ready:!0},"Мерри":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире, а Торба-на-Круче досталась Фродо.",time:"22 сентября 3001",ready:!0},"Сэм":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире, а Торба-на-Круче досталась Фродо.",time:"22 сентября 3001",ready:!0},"Фродо":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире. Он оставил все свое имущество мне, включая странное кольцо с которым он никогда не расставался.",time:"22 сентября 3001",ready:!0},"Бильбо":{text:"Что ж, я прожил долгую жизнь и мне кажется, что мой век подходит к концу. Поэтому я отправляюсь к эльфам после своего очередного дня рождения. Правда, с изчезновением в конце праздничной речи как-то неловко получилось, кольцо прямо само прыгнула на палец. ",time:"22 сентября 3001",ready:!0},"Пиппин":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире, а Торба-на-Круче досталась Фродо.",time:"22 сентября 3001",ready:!0}}},{name:"Подозрения Гендальфа",text:"Гендальф чувствует черную магию в кольце и отправляется в Минас-Тирит, для получения большей информации.",time:"3001/09/23 12:00",characters:{"Гендальф":{text:"Меня очень беспокоит кольцо Билььо. Вещь содержащая сильную магию, к тому же он так к нему привязался. С трудом я уговорил его оставить кольцо Фродо. Надо попытаться узнать что же это за кольцо.",time:"23 сентября 3001",ready:!0},"Фродо":{text:"Обычно я носил кольцо, доставшееся мне от Бильбо при себе, но надеквал его крайне редко . Вообще жизни пошла обычным чередом, Гэндальф куда-то исчез.",time:"23 сентября 3001",ready:!0},"Бильбо":{text:"Сколько раз я себе говорил - не слушай Гендальфа, старику в очередной раз удалось меня уговорить, поэтому я оставил свое прелестное кольцо Фродо. Эх, как оно без меня?",time:"23 сентября 3001",ready:!0}}},{name:"Назгулы",text:"Саурон узнает от Голлума у кого сейчас находится кольцо и отправляет за ним назгулов.",time:"3018/03/02 15:00",characters:{"Саурон":{text:"От этой твари я узнал нынешнего владельца кольца, это какой-то хоббит из Шира и отправил за ним назгулов. Кстати, кто такие эти хоббиты?",time:"2 марта 3018",ready:!0},"Назгул":{text:"Повелитель отправил нас в Шир. Мы должны разыскать владельца кольца и забрать его.",time:"2 марта 3018",ready:!0}}},{name:"Начало пути Фродо",text:"Гендальф возвращается в Шир, чтобы предупредить Фродо об опасности, древние зло пробудилось и за Фродо отправлены черные всадники. Гендальф проверяет кольцо и оно оказывается тем самым кольцом. Гендальф отправляет Фродо в Бри в таверну Гарцующий пони. Этот разговор услышал Сэм и за это его добавили к пати.",time:"3018/04/13 20:00",characters:{"Фродо":{text:"Вернувшись домой я встретил взволнованного Гендальфа. Он попросил меня достать кольцо Бильбо и бросить его в огонь. К моему удивлению, вынутое из огня кольцо оказалось холодным и на его поверхности проступили странные письмена. Гендальф сказал, что только одно кольцо реагирует так на огонь - кольцо Саурона. Как оказалось Саурон не умер, вновь набирает силу и ищет это кольцо. За мной отправлены черные всадники и мне надо бежать. Наш разговор подслушал Сэм и Гендальф отправил его со мной. Мы идём в Бри, он должен нас встретить там.",time:"4 апреля 3018",ready:!0},"Сэм":{text:"Поздним вечером я подстригал кусты у открытого окна и вдруг услышал разговор хозяина и Гендальфа. Голос Гендальфа был очень напряжен и я не удержался и решить узнать о чем они говорят. Я понял, что кольцо Бильбо действительно существует и что это очень необычное кольцо и что его ищет сам Саурон, который оказывается не умер. Я так заслушался, что забыл о стрижке, а Гендальф заметил, что ножницы не звенят. Он поймал меня, я сознался, что все слышал и он отправил меня вместе с Фродо в Бри.",time:"4 апреля 3018",ready:!0},"Гендальф":{text:"В Минас-Тирит я узнал, что это может быть то самое кольцо Саурона. Обеспокоенный я вернулся в Шир, как бы мне хотелось, чтобы это не было правдой, но Фродо при мне проверил кольцо, бросив его в огонь и на нем проступили письмена. Я слышал о черных всадниках, движущихся в сторону Шира. Я отправил Фродо в Бри, надеюсь я успею вернуться к тому моменту, когда он будет там. Мне срочно надо посоветоваться с Саруманом. Наш разговор подслушал Сэм, а мне ни в коем случае не хотелось отпускать Фродо одного. Что-то должно напоминать Фродо о доме и потмогать  противостоять власти кольца, так что Сэм попал под раздачу. Уверен, он справится.",time:"4 апреля 3018",ready:!0}}},{name:"Гендальфа пленит Саруман",text:"Гендальф отправляется к Саруману, чтобы выработать план действий, но Саруман уже на темной стороне.",time:"3018/07/10 16:00",characters:{"Гендальф":{text:"Я прибыл к Саруману, чтобы обсудить что мы можем предпринять. Но как оказалось, Саруман перешёл на сторону Саурона. Он пленил меня и запер на крыше Ортханка. Чудом меня спас орёл. В назначенное время в Бри я уже не попаду.",time:"10 июля 3018",ready:!0},"Саруман":{text:"Я узрел вечную тьму в палантире и понял, что это мой путь. Визит Гендальфа не был неожиданностью. Повелитель тьмы велел заставить Гендальфа прикмнуть к нам, но он смог сбежать. Тем хуже для него.",time:"10 июля 3018",ready:!0}}},{name:"Мерри и Пипин",text:"По пути из Шира Фродо и Сэм встречают Мерри и Пипина, ворующих овощи. Внезапно появляются назгулы, и Мерри с Пиппином присоединяются к пати.",time:"3018/04/17 13:00",characters:{"Сэм":{text:"Пиппин и Мерри как всегда убегали от разозленного фермера по полю, когда случайно наткнулись на нас. Нам пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Фродо рассказал, что всадников несколько и они преследуют его и что ему позарез нужно в Бри. Мерри и Пиппин присоединились к нам.",time:"17 апреля 3018",ready:!0},"Фродо":{text:"Пиппин и Мерри убегали от разозленного фермера по полю, когда случайно наткнулись на нас. Нам пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Я рассказал, что всадников несколько и они преследуют меня и что мы идем в Бри. Мерри и Пиппин присоединились к нам.",time:"17 апреля 3018",ready:!0},"Мерри":{text:"Я и Пиппин убегали от разозленного фермера по полю, когда случайно наткнулись на Сэма и Фродо. Им пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера, мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Фродо рассказал, что всадников несколько и они преследуют его и что ему позарез нужно в Бри. Мы пошли с Фродо и Сэмом.",time:"17 апреля 3018",ready:!0},"Пиппин":{text:"Я и Мерри убегали от разозленного фермера по полю, когда случайно наткнулись на Сэма и Фродо. Им пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Фродо рассказал, что всадников несколько и они преследуют его и что ему позарез нужно в Бри. Мы пошли с Фродо и Сэмом.",time:"17 апреля 3018",ready:!0}}},{name:"Гарцующий пони",text:"Партия приходит в Бри, и останавливается в Гарцующем пони. Гендальфа там нет. Фродо случайно надевает кольцо, под действием кольца. Это видит Бродяжник. Бродяжник объясняет, что он друг и отводит хоббитов в другой ночлег.",time:"3018/09/30 20:00",characters:{"Арагорн":{text:"В Бри пришла стайка хоббитов. Какие же они все таки нелепые. Я знал, что они должны прийти, но решил выждать. Жаль что я не подошел сразу - Фродо одел кольцо прямо посреди зала. Теперь Саурон, а значит и назгулы точно знают где их искать. \nТак или иначе я представился и увел их на другой ночлег. Можно не сомневаться назгулы придут сегодня ночью.",time:"30 сентября 3018",ready:!0},"Мерри":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг Фродо стало плохо и он исчез точно так же как Бильбо на своем дне рождения. Мы не поняли что произошло, мы искали Фродо и не могли найти. Вдруг мы увидели как человек утаскивает Фродо. Мы пошли за ним, собирались драться. Оказалось, что это Бродяжник, друг Гендальфа, который будет охранять нас. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел нас на другой ночлег.",time:"30 сентября 3018",ready:!0},"Сэм":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг Фродо стало плохо и он исчез точно так же как Бильбо на своем дне рождения. Мы не поняли что произошло, мы искали Фродо и не могли найти. Вдруг мы увидели как человек утаскивает Фродо. Мы пошли за ним, собирались драться. Оказалось, что это Бродяжник, друг Гендальфа, который будет охранять нас. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел нас на другой ночлег.",time:"30 сентября 3018",ready:!0},"Фродо":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг я почуствовал непреодолимое желание одеть кольцо и сделал это. Мир потерял краски, вместо людей были только силуэты и среди всего на меня смотрело огромное огненное око. В ужасе я снял кольцо. Никто на меня не смотрел, поэтому я подумал, что все хорошо, но неожиданное меня схватил человек и утащил в одну из внтуренних комнат. Это оказался Бродяжник, друг Гендальфа, встретивший нас. Он был очень зол на меня, за то что я одел кольцо - у Саурона везде глаза и уши. Мои друзья попытались спасти меня от Бродяжника, но я объяснил им, что он друг. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел на другой ночлег.",time:"30 сентября 3018",ready:!0},"Пиппин":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг Фродо стало плохо и он исчез точно так же как Бильбо на своем дне рождения. Мы не поняли что произошло, мы искали Фродо и не могли найти. Вдруг мы увидели как человек утаскивает Фродо. Мы пошли за ним, собирались драться. Оказалось, что это Бродяжник, друг Гендальфа, который будет охранять нас. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел нас на другой ночлег.",time:"30 сентября 3018",ready:!0}}},{name:"Ночное нападение",text:"Ночью назгулы приходят в гарцующий пони и разносят комнату хоббитов, которых там нет.",time:"3018/09/31 04:00",characters:{"Арагорн":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Что ж, в этот раз назгулы ошиблись. Нужно уходить из Бри.",time:"1 октября 3018",ready:!0},"Мерри":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но я должен идти с Фродо, ему угрожает большая опасность.",time:"1 октября 3018",ready:!0},"Сэм":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но я должен идти с Фродо, ему угрожает большая опасность.",time:"1 октября 3018",ready:!0},"Фродо":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но мы должны идти, кольцо - моя ноша, никто другой с этим не справится.",time:"1 октября 3018",ready:!0},"Назгул":{text:"Ночью мы пришли в таверну где были те, кто нам нужен. Их не было в комнате. Мы бы с радостью вырезали весь город, но где-то здесь скрывается Бродяжник и только он может нам помешать. Время есть, мы подождем, когда хоббит снова оденет кольцо и выдаст себя.",time:"1 октября 3018",ready:!0},"Пиппин":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но я должен идти с Фродо, ему угрожает большая опасность.",time:"1 октября 3018",ready:!0}}},{name:"Амон Сул",text:"Назгулы настигают хоббитов в развалинах Амон Сул. Один из них ранит Фродо. Бродяжник прогоняет назгулов. Появляется Арвен, везет Фродо в Ривенделл, спасаясь от назгулов.",time:"3018/10/04 03:30",characters:{"Арагорн":{text:"Я отправился в дозор и очень зря. Назгулы прокрались мимо меня. С трудом я успел их прогнать, но они ранили Фродо. Я смогу его спасти. Неожиданно появилась Арвен. Она забрала у меня Фродо. Надеюсь черные всадники не смогут догнать их на пути в Ривендел.",time:"4 октября 3018",ready:!0},"Арвен":{text:"Я почуствовала холод и боль в далеке и примчалась в это место. Бродяжник только отбил нападение назгулов, а хранитель кольца был ранен. Вся надежда на моего коня. Успеть бы доскакать",time:"4 октября 3018",ready:!0},"Мерри":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили Фродо и наконец вернулся Бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать рану Фродо, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала Фродо с собой. Надеюсь, что с Фродо все будет хорошо.",time:"4 октября 3018",ready:!0},"Сэм":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили Фродо и наконец вернулся бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать рану Фродо, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала Фродо с собой. Надеюсь, что с Фродо все будет хорошо.",time:"4 октября 3018",ready:!0},"Фродо":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили меня и наконец вернулся бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать мою рану, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала меня с собой. ",time:"4 октября 3018",ready:!0},"Назгул":{text:"Мы окружили хоббитов, мы чувствовали силу кольца, и тут пришел Бродяжник. Он отбил наше нападение. Мы успели ранить хранителя, он долго не продержится. И тут появилась эта эльфийка...",time:"4 октября 3018",ready:!0},"Пиппин":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили Фродо и наконец вернулся бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать рану Фродо, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала Фродо с собой. Надеюсь, что с Фродо все будет хорошо.",time:"4 октября 3018",ready:!0}}},{name:"Ривенделл",text:"Арвен привозит Фродо в Ривенделл. Назгулы не могут перейти реку на границе Ривенделла.",time:"3018/10/20 15:00",characters:{"Арагорн":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится и мы сможем собрать совет кольца.",time:"20 октября 3018",ready:!0},"Бильбо":{text:"Я узнал, что мой племенник и несколько его друзей пришли в Ривендел. Смелые. Надеюсь он навестит меня. Возможно, что ему предстоит дальняя дорога, и пара предметов, которые я взял с собой... Больше мне не пригодяться, я уже дошел до Ривендела. Как же здесь все-таки красиво.",time:"20 октября 3018",ready:!0
},"Мерри":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится.",time:"20 октября 3018",ready:!0},"Сэм":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится.",time:"20 октября 3018",ready:!0},"Фродо":{text:"Я не помню как мы оказались в Ривенделе. Но в себя я пришел уже там. Все мои спутники уже были здесь.",time:"20 октября 3018",ready:!0},"Элронд":{text:"Арвен успела спасти Фродо, я залечу его рану, но на это уйдет время. Черные всадники не могут пройти в Ривендел и мы в этом убедились. Что ж, скоро мы соберем совет и решим что делать с этим кольцом.",time:"20 октября 3018",ready:!0},"Арвен":{text:"Я забрала Фродо с собой и мы с большим трудом успели перейти реку на границе Ривендела. Черные всадники осмелились вступить в воду и река смела их. В ближайшее время они не побеспокоят Фродо. Отец вылечил Фродо, но раны нанесенные призрачным клинком не могут быть вылечены полностью никогда.",time:"20 октября 3018",ready:!0},"Гендальф":{text:"Арвен успела спасти Фродо, Элронд залечит его рану, но на это уйдет время. Черные всадники не могут пройти в Ривендел и мы в этом убедились. Жаль, что Саруман выступил против нас. Теперь Ортханк оплот орков и кто знает, на что способен Саруман в черной магии. Что ж, скоро мы соберем совет и решим что делать с этим кольцом.",time:"20 октября 3018",ready:!0},"Пиппин":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится.",time:"20 октября 3018",ready:!0},"Назгул":{text:"Эльфийка везла Фродо в Ривендел и преуспела. Мы не смогли пересечь его границу, древняя магия все ещё сильна. Тёмный властелин велел возвращаться в Мордор. Там мы узнаем, что нам делать дальше.",time:"20 октября 3018",ready:!0}}},{name:"Кольцо в Ривенделле",text:"Фродо исцеляют, он встречается с Бильбо, получает у него еще часть наследства - меч и кольчугу.",time:"3018/12/24 16:00",characters:{"Фродо":{text:"Я посетил Бильбо в Ривенделе. Он как-то постарел за это небольшое время. Бильбо передал мне свой меч и кольчугу - волшебные вещи. Не хотелось бы, чтобы они пригодились, но лучше с ними чем без них. Бильбо очень хотел посмотреть на своё кольцо и внезапно сильно разозлился, когда я отказал. Он был просто сам не свой и так же быстро он остыл. Теперь я знаю как выглядит печать кольца на хранителе, слишком долго хранившем его.",time:"24 декабря 3018",ready:!0},"Бильбо":{text:"Фродо посетил меня и я отдал последнюю часть моего наследства - меч и кольчугу. Они сослужили мне хорошую службу, пусть теперь помогут ему. Когда я увидел краешек кольца я попросил Фродо дать мне его подержать, но он спрятал его. Я впал в ярость, и очень быстро остыл. Не знаю что меня нашло.",time:"24 декабря 3018",ready:!0}}}]},"Арвен и Арагорн":{name:"Арвен и Арагорн",story:"Любовная линия Арвен и Арагорна. Оба активно вздыхают друг об дружке.",characters:{"Арагорн":{name:"Арагорн",inventory:"брошь Арвен",activity:{active:!0}},"Арвен":{name:"Арвен",inventory:"",activity:{active:!0}}},events:[{name:"Брошь",text:"Арвен и Арагорн. Арвен дает Арагорну свою брошь.",time:"3018/10/25 02:00",characters:{"Арагорн":{text:"",time:""},"Арвен":{text:"",time:""}}}]},"История Сарумана":{name:"История Сарумана",story:"Саурон и Саруман активно работают над своими темными планами. Саруман собирает армию орков и создает урук-хаев.",characters:{"Саруман":{name:"Саруман",inventory:"",activity:{active:!0}},"Саурон":{name:"Саурон",inventory:"",activity:{active:!0}}},events:[{name:"Уничтожение рощи",text:"Саруман начинает культивировать орков и дает приказ уничтожить рощу вокруг Ортханка. Так же он выводит Урук-Хаев.",time:"3018/07/13 18:00",characters:{"Саруман":{text:"",time:""},"Саурон":{text:"",time:""}}}]},"Братство кольца":{name:"Братство кольца",story:"В этой истории активно идет вперед Фродо. Все остальные его сопровождают, за исключением Боромира, который активно думает как получить кольцо в Гондор. Братству активно противостоит Саруман. Элронд знает о том, что братство выдвинулось в сторону роковой горы. Галандриэль же ждет когда братство дойдет до Лориена. ",characters:{"Арагорн":{name:"Арагорн",inventory:"ножны, плащ с брошью",activity:{follower:!0}},"Боромир":{name:"Боромир",inventory:"золотой пояс, плащ с брошью",activity:{follower:!0,active:!0}},"Галадриэль":{name:"Галадриэль",inventory:"",activity:{passive:!0}},"Гендальф":{name:"Гендальф",inventory:"",activity:{follower:!0}},"Гимли":{name:"Гимли",inventory:"прядь волос Галадриэли, плащ с брошью",activity:{follower:!0}},"Леголас":{name:"Леголас",inventory:"лук и колчан стрел, плащ с брошью",activity:{follower:!0}},"Мерри":{name:"Мерри",inventory:"серебряные пояс, плащ с брошью",activity:{follower:!0}},"Пиппин":{name:"Пиппин",inventory:"серебряные пояс, плащ с брошью",activity:{follower:!0}},"Сэм":{name:"Сэм",inventory:"шкатулка благословленной земли, плащ с брошью",activity:{follower:!0}},"Фродо":{name:"Фродо",inventory:"фиал, плащ с брошью",activity:{active:!0}},"Элронд":{name:"Элронд",inventory:"",activity:{passive:!0}},"Саруман":{name:"Саруман",inventory:"",activity:{active:!0}}},events:[{name:"Совет",text:"На совете обозначена проблема уничтожения кольца. Кольцо необходимо бросить в Ородруин, но никто не в силе взять на себя эту ношу. Фродо вызывается сделать это. Проводить его берутся Арагорн, Леголас, Гимли, Боромир, Гендальф и его друзья из Шира. Так появляется братство кольца.",time:"3018/10/25 17:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Элронд":{text:"",time:""}}},{name:"Путь по земле",text:"Первая дорога перекрыта патрулями Саурона.",time:"3019/01/08 13:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Саруман":{text:"",time:""}}},{name:"Путь в горы",text:"Магия Сарумана не дает братству пройти через снежные перевалы в горах.",time:"3019/01/12 16:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Саруман":{text:"",time:""}}},{name:"Путь в Морию",text:"Братство спускается в Морию. При входе они пробуждают кракена, который рушит врата Мории, как только они в нее заходят. Тут же они находят тела гномов и понимают, что Мория захвачена орками.",time:"3019/01/13 18:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Мория",text:"Гендальф показывает Фродо Голлума и говорит, что он давно идет за ними.\nПипин роняет ведро в колодец у могилы Балина, тем самым выдавая себя оркам. Принимают бой. Приходит Балрог.",time:"3019/01/14 21:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Выход из Мории",text:"Гендальф остается защищать мост от Балрога и падает в пропасть вместе с ним. Все остальные выходят из Мории и попадают в Лотлориен к Галадриэли.",time:"3019/01/15 16:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Зеркало Галадриэли",text:"Галадриэль показывает Фродо будущее в своем зеркале.",time:"3019/02/14 21:30",characters:{"Галадриэль":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Покидая Лотлориен",text:"Братству кольца помогают припасами и пропускают через Лотлориен. Нимбос, фиал, накидки.",time:"3019/02/16 12:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Галадриэль":{text:"",time:""}}},{name:"Урук-Хаи",text:"Саруман отправляет отряд Урук-Хаев в погоню за хранителем кольца.",time:"3019/01/10 00:00",characters:{"Саруман":{text:"",time:""}}},{name:"Водопад",text:"Братство останавливается перед водопадом.",time:"3019/02/25 16:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Развилка",text:"Боромир пытается отнять у Фродо кольцо. В этот момент на них нападают Урук-Хаи, убивают Боромира, хватают Мерри и Пипина и убегают к Саруману. Фродо решает идти дальше в одиночку, но Сэм не отстает. Остальные хоронят Боромира и отправляются в погоню за отрядом Урук-Хаев.",time:"3019/02/26 17:20",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}}]}},Settings:{BriefingPreview:{characterName:"Арагорн"},Stories:{storyName:"Братство кольца"},CharacterProfile:{characterName:"Народ Гондора"},Events:{storyName:"Начало пути",characterNames:["Арагорн"],eventIndexes:[],selectedFilter:"adaptationFilterByCharacter"},GroupProfile:{groupName:"Нейтралы"}},Version:"0.5.2",Log:[["user","Thu Oct 13 2016 19:09:25 GMT+0500 (Pakistan Standard Time)","createProfileItem",'["Блок","enum","_",true,11]'],["user","Thu Oct 13 2016 19:09:55 GMT+0500 (Pakistan Standard Time)","updateDefaultValue",'["Блок","Тёмный,Светлый,Нейтрал"]'],["user","Thu Oct 13 2016 19:10:09 GMT+0500 (Pakistan Standard Time)","moveProfileItem","[11,0]"],["user","Thu Oct 13 2016 19:12:30 GMT+0500 (Pakistan Standard Time)","createGroup",'["Светлый блок"]'],["user","Thu Oct 13 2016 19:12:37 GMT+0500 (Pakistan Standard Time)","createGroup",'["Темный блок"]'],["user","Thu Oct 13 2016 19:12:47 GMT+0500 (Pakistan Standard Time)","createGroup",'["Нейтралы"]'],["user","Thu Oct 13 2016 19:12:58 GMT+0500 (Pakistan Standard Time)","createGroup",'["Эльфы"]'],["user","Thu Oct 13 2016 19:13:52 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Нейтралы",[{"type":"enum","name":"profile-Блок","selectedOptions":{"Нейтрал":true}}]]'],["user","Thu Oct 13 2016 19:13:55 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Светлый блок",[{"type":"enum","name":"profile-Блок","selectedOptions":{"Светлый":true}}]]'],["user","Thu Oct 13 2016 19:13:59 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Темный блок",[{"type":"enum","name":"profile-Блок","selectedOptions":{"Тёмный":true}}]]'],["user","Thu Oct 13 2016 19:14:05 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Эльфы",[{"type":"enum","name":"profile-Раса","selectedOptions":{"эльф":true}}]]'],["user","Thu Oct 13 2016 19:16:26 GMT+0500 (Pakistan Standard Time)","addBoardGroup",'["Нейтралы"]'],["user","Thu Oct 13 2016 19:16:29 GMT+0500 (Pakistan Standard Time)","addBoardGroup",'["Светлый блок"]'],["user","Thu Oct 13 2016 19:16:31 GMT+0500 (Pakistan Standard Time)","addBoardGroup",'["Темный блок"]'],["user","Thu Oct 13 2016 19:16:33 GMT+0500 (Pakistan Standard Time)","addBoardGroup",'["Эльфы"]'],["user","Thu Oct 13 2016 19:16:47 GMT+0500 (Pakistan Standard Time)","createResource",'["Кольцо Всевластья"]'],["user","Thu Oct 13 2016 19:17:14 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Темный блок","resource-Кольцо Всевластья","Стремится захватить"]'],["user","Thu Oct 13 2016 19:17:27 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Светлый блок","resource-Кольцо Всевластья","Стремится уничтожить"]'],["user","Thu Oct 13 2016 19:17:50 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Нейтралы","resource-Кольцо Всевластья","Стремятся эффективно использовать"]'],["user","Thu Oct 13 2016 19:18:15 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Светлый блок","group-Темный блок","Хочет уничтожить"]'],["user","Thu Oct 13 2016 19:18:20 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Темный блок","group-Светлый блок","Хочет уничтожить"]'],["user","Thu Oct 13 2016 19:19:40 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Эльфы",[{"type":"enum","name":"profile-Блок","selectedOptions":{"Светлый":true}},{"type":"enum","name":"profile-Раса","selectedOptions":{"эльф":true}}]]'],["user","Thu Oct 13 2016 19:20:25 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Темный блок","group-Нейтралы","Хочет поработить"]'],["user","Thu Oct 13 2016 19:20:54 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Светлый блок","group-Нейтралы","Хочет присоединить"]'],["user","Thu Oct 13 2016 19:21:37 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Эльфы","group-Светлый блок","Направляют"]'],["user","Thu Oct 13 2016 19:22:00 GMT+0500 (Pakistan Standard Time)","createGroup",'["Народ Рохана"]'],["user","Thu Oct 13 2016 19:22:04 GMT+0500 (Pakistan Standard Time)","createGroup",'["Народ Гондора"]'],["user","Thu Oct 13 2016 19:22:11 GMT+0500 (Pakistan Standard Time)","addBoardGroup",'["Народ Гондора"]'],["user","Thu Oct 13 2016 19:22:13 GMT+0500 (Pakistan Standard Time)","addBoardGroup",'["Народ Рохана"]'],["user","Thu Oct 13 2016 19:22:51 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Народ Гондора","group-Народ Рохана","Союзники"]'],["user","Thu Oct 13 2016 19:22:54 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Народ Рохана","group-Народ Гондора","Союзники"]'],["user","Thu Oct 13 2016 19:23:20 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Народ Гондора","group-Светлый блок","Склоняются"]'],["user","Thu Oct 13 2016 19:23:24 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Народ Рохана","group-Светлый блок","Склоняются"]'],["user","Thu Oct 13 2016 19:26:04 GMT+0500 (Pakistan Standard Time)","createResource",'["Шахты Мории"]'],["user","Thu Oct 13 2016 19:26:18 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Темный блок","resource-Шахты Мории","Контролирует"]'],["user","Thu Oct 13 2016 19:26:47 GMT+0500 (Pakistan Standard Time)","addEdge",'["group-Народ Гондора","resource-Шахты Мории","Хочет захватить"]'],["user","Thu Oct 13 2016 19:31:26 GMT+0500 (Pakistan Standard Time)","createCharacter",'["Народ Гондора"]'],["user","Thu Oct 13 2016 19:31:30 GMT+0500 (Pakistan Standard Time)","createCharacter",'["Народ Рохана"]'],["user","Thu Oct 13 2016 19:31:40 GMT+0500 (Pakistan Standard Time)","createProfileItem",'["Народ Гондора","checkbox",false,true,12]'],["user","Thu Oct 13 2016 19:31:46 GMT+0500 (Pakistan Standard Time)","createProfileItem",'["Народ Рохана","checkbox",false,true,13]'],["user","Thu Oct 13 2016 19:32:36 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Народ Гондора",[{"type":"checkbox","name":"profile-Народ Гондора","selectedOptions":{"true":true}}]]'],["user","Thu Oct 13 2016 19:32:53 GMT+0500 (Pakistan Standard Time)","saveFilterToGroup",'["Народ Рохана",[{"type":"checkbox","name":"profile-Народ Рохана","selectedOptions":{"true":true}}]]']],Groups:{"Светлый блок":{name:"Светлый блок",masterDescription:"Стремятся уничтожить Саурона и последствия его деятельности в Арде.",characterDescription:"",filterModel:[{type:"enum",name:"profile-Блок",selectedOptions:{"Светлый":!0}}],doExport:!0},"Темный блок":{name:"Темный блок",masterDescription:"Стремятся захватить власть над Ардой.",characterDescription:"",filterModel:[{type:"enum",name:"profile-Блок",selectedOptions:{"Тёмный":!0}}],doExport:!0},"Нейтралы":{name:"Нейтралы",masterDescription:"Имеющие свободный выбор и не сделавшие его.",characterDescription:"",filterModel:[{type:"enum",name:"profile-Блок",selectedOptions:{"Нейтрал":!0}}],doExport:!0},"Эльфы":{name:"Эльфы",masterDescription:"Валим в Валинор.",characterDescription:"",filterModel:[{type:"enum",name:"profile-Блок",selectedOptions:{"Светлый":!0}},{type:"enum",name:"profile-Раса",selectedOptions:{"эльф":!0}}],doExport:!0},"Народ Рохана":{name:"Народ Рохана",masterDescription:"",characterDescription:"Рохан - государство у северных границ Гондора, его союзник. Также встречается название Риддермарк (англ. Riddermark) или Марка. Жители этого степного края к северу от Гондора и северо-западу от Мордора зовутся рохиррим.\n\nВ XIII веке Третьей Эпохи короли Гондора заключили союз с людьми Рованиона как с народом, родственным дунэдайн Первой Эпохи.\n\nВ XXI веке Третьей Эпохи потомки тех людей, зовущие себя Эотеод, перекочевали от верховьев Андуина к северу Лихолесья, уничтожив по пути остатки воинства королевства Ангмар. Там у них произошла ссора с гномами по поводу сокровищ дракона Скаты, освобождённых одним из князей Эотеода, Фрамом.\n\nПозже, в 2509 году, Кирион, наместник Гондора, призывает Эотеод на помощь в отражении атаки людей северо-востока Средиземья и орков Мордора. Эорл Юный отвечает на призыв и, неожиданно для всех явившись на поле битвы при Келебранте, громит армию орков. В награду Эорл получает поля Каленардона и переселятся туда вместе со всем своим народом. Эта земля изначально была частью Гондора, но после опустошительной чумы 1636 года оставалась практически незаселённой.\n\nПервая линия королей Рохана продолжалась 249 лет, пока в 2758 году Т. Э. страна не подверглась нашествию дунландцев под командованием Вульфа, сына Фреки. Король Хельм Молоторукий укрылся в Хорнбурге до прибытия помощи из Гондора, и находился в осаде около года. Сыновья Хельма погибли раньше него, так что после его гибели племянник Хельма Фреалаф начал вторую линию королей, продлившуюся до конца Третьей Эпохи.",filterModel:[{type:"checkbox",name:"profile-Народ Рохана",selectedOptions:{"true":!0}}],doExport:!0},"Народ Гондора":{name:"Народ Гондора",masterDescription:"",characterDescription:"Гондор - южное государство нуменорцев в Средиземье. Основано Элендилом после гибели Нуменора в 3320 году В. Э. на берегу залива Белфалас к западу от Мордора, со столицей в городе Осгилиат.\n\nХотя первоначально столицей Гондора был Осгилиат, в 1640 году Т. Э. столица была перенесена в Минас-Анор (изначально опорную крепость на правом берегу Андуина). Из крепостей и городов Гондора известны Осгилиат, Минас Анор (Минас Тирит), Минас Итиль (Минас Моргул), Дол Амрот, Пеларгир-на-Андуине, Лебеннин, Изенгард (был отдан во владение Саруману), а также крепость на острове Каир Андрос.\n\nДо создания Последнего Союза и войны с Сауроном Гондором совместно управляли двое сыновей Элендила — Исилдур и Анарион. После того, как Элендил и Анарион погибли во время осады Барад-Дура, правление перешло к сыну Анариона — королю Менельдилу, которого возвёл на трон Южного королевства его дядя Исилдур, недолгое время спустя после этого погибший в Ирисной Низине в пойме Андуина. Таким образом, потомки Анариона были королями Гондора долгое время — вплоть до последнего законного представителя южной династии, Эарнура.\n\nКогда Эарнур погиб в Минас Моргуле в 2050 году Т. Э., правление принял наместник короля Мардил Верный. Поскольку не было уверенности, что Эарнур погиб, Мардил и другие Наместники Гондора клялись управлять страной «до возвращения короля». Данное возвращение состоялось спустя почти тысячу лет, когда в 3019 году Т. Э. права на трон Гондора предъявил Арагорн или Элессар, сын Араторна, прямой потомок Исилдура, старшего брата Анариона, и одновременно — самого Анариона (ибо последний король Арнора, Арведуи, был женат на дочери гондорского короля Ондогера).",filterModel:[{type:"checkbox",name:"profile-Народ Гондора",selectedOptions:{"true":!0}}],doExport:!0}},InvestigationBoard:{groups:{"Нейтралы":{name:"Нейтралы",notes:""},"Светлый блок":{name:"Светлый блок",notes:""},"Темный блок":{name:"Темный блок",notes:""},"Эльфы":{name:"Эльфы",notes:""},"Народ Гондора":{name:"Народ Гондора",notes:""},"Народ Рохана":{name:"Народ Рохана",notes:""}},resources:{"Кольцо Всевластья":{name:"Кольцо Всевластья"},"Шахты Мории":{name:"Шахты Мории"}},relations:{"group-Нейтралы":{"resource-Кольцо Всевластья":"Стремятся эффективно использовать"},"group-Светлый блок":{"resource-Кольцо Всевластья":"Стремится уничтожить","group-Темный блок":"Хочет уничтожить","group-Нейтралы":"Хочет присоединить"},"group-Темный блок":{"resource-Кольцо Всевластья":"Стремится захватить","group-Светлый блок":"Хочет уничтожить","group-Нейтралы":"Хочет поработить","resource-Шахты Мории":"Контролирует"},"group-Эльфы":{"group-Светлый блок":"Направляют"},"group-Народ Гондора":{"group-Народ Рохана":"Союзники","group-Светлый блок":"Склоняются","resource-Шахты Мории":"Хочет захватить"},"group-Народ Рохана":{"group-Народ Гондора":"Союзники","group-Светлый блок":"Склоняются"}}},Relations:{"Арагорн":{"Арвен":"Зайка моя.","Гендальф":"Уважаю старика."},"Арвен":{"Арагорн":"Мой лапушок."},"Гендальф":{},"Саурон":{"Арагорн":"Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём.Не быть тебе королём."}}}}("undefined"==typeof exports?this.BaseExample={}:exports);var defaultLang="ru";