"use strict";!function(t){t.data={Meta:{name:"Разные сказки",date:"1993/06/14 20:00",preGameDate:"1984/06/14 20:00",description:"Пример базы. Разные сказки."},ProfileSettings:[{name:"Игрок",type:"string",value:""},{name:"Пол",type:"enum",value:"М,Ж,не важно"},{name:"Возраст",type:"number",value:0},{name:"Биография",type:"text",value:""},{name:"Участие в тендере",type:"checkbox",value:!1}],Settings:{BriefingPreview:{characterName:"бабка"},Stories:{storyName:"Колобок"},CharacterProfile:{characterName:"бабка"}},Characters:{"дед":{name:"дед","Участие в тендере":!1,"Пол":"М","Возраст":63,"Биография":"Дед МакДедов из клана макДеданов. Беспощаден к врагам и товарищам по работе.","Игрок":""},"бабка":{name:"бабка","Участие в тендере":!0,"Пол":"Ж","Возраст":60,"Биография":"Бабка Хризантема Одуванчик-Тюльпанова. КМС по извлечению репки в супертяжелом весе.","Игрок":"234567"},"внучка":{name:"внучка","Участие в тендере":!1,"Пол":"Ж","Возраст":15,"Биография":"Ваня макТюльпанова. Собирается поступать в семинарию на экзорциста.","Игрок":""},"кошка":{name:"кошка","Участие в тендере":!1,"Пол":"Ж","Возраст":5,"Биография":"кошка Матрешка. Во-первых, мотря, во-вторых, гуляет сама по себе.","Игрок":""},"мышка":{name:"мышка","Участие в тендере":!1,"Пол":"Ж","Возраст":1,"Биография":"мышка Кубышка. У нее норки квадратные, а не круглые.","Игрок":""},"Жучка":{name:"Жучка","Участие в тендере":!1,"Пол":"М","Возраст":2,"Биография":"Жучка. Жучка это собака у которой уши торчком, хвост крючком и нос пятачком.","Игрок":"567890"},"Ряба":{name:"Ряба","Участие в тендере":!1,"Пол":"Ж","Возраст":2,"Биография":"Курочка Ряба.","Игрок":""},"Колобок":{name:"Колобок","Участие в тендере":!1,"Пол":"не важно","Возраст":0,"Биография":"","Игрок":""},"Лиса":{name:"Лиса","Участие в тендере":!0,"Пол":"Ж","Возраст":4,"Биография":"","Игрок":""},"Заяц":{name:"Заяц","Участие в тендере":!1,"Пол":"М","Возраст":2,"Биография":"","Игрок":""},"Медведь":{name:"Медведь","Участие в тендере":!1,"Пол":"М","Возраст":10,"Биография":"","Игрок":""},"Волк":{name:"Волк","Участие в тендере":!1,"Пол":"М","Возраст":10,"Биография":"","Игрок":""},"Лягушка":{name:"Лягушка","Участие в тендере":!1,"Пол":"Ж","Возраст":1,"Биография":"","Игрок":""},"Мышка-норушка":{name:"Мышка-норушка","Участие в тендере":!1,"Пол":"Ж","Возраст":1,"Биография":"","Игрок":""},"Петушок":{name:"Петушок","Участие в тендере":!1,"Пол":"М","Возраст":3,"Биография":"","Игрок":""},"Корова":{name:"Корова","Участие в тендере":!1,"Пол":"Ж","Возраст":4,"Биография":"","Игрок":""},"Кузнец":{name:"Кузнец","Участие в тендере":!1,"Пол":"М","Возраст":40,"Биография":"","Игрок":""}},Stories:{"Репка":{name:"Репка",story:"Посадил дед репку. \n\nВыросла репка большая пребольшая. Стал дед репку тянуть. Тянет потянет, вытянуть не может. \n\nПозвал дед бабку. \n\nПришла бабка. Тянут потянут, вытянуть не могут. \n\nПозвала бабка внучку. \n\nПришла внучка. Тянут потянут, вытянуть не могут. \n\nПозвала внучка жучку. \n\nПришла жучка. Тянут потянут, вытянуть не могут.\n \nПозвала жучка кошку. \n\nПришла кошка. Тянут потянут, вытянуть не могут. \n\nПозвала кошка мышку. \n\nПришла мышка. Потянули, вытянули репку.",characters:{"дед":{name:"дед",inventory:"",activity:{active:!0}},"бабка":{name:"бабка",inventory:"журнал, пестик, бутылка кефира, полбатона",activity:{active:!0,follower:!0}},"внучка":{name:"внучка",inventory:"",activity:{active:!0,follower:!0}},"кошка":{name:"кошка",inventory:"",activity:{active:!0,follower:!0}},"Жучка":{name:"Жучка",inventory:"",activity:{active:!0,follower:!0}},"мышка":{name:"мышка",inventory:"",activity:{active:!0,follower:!0}}},events:[{text:"Посадил дед репку.",time:"1984/04/30 18:00",characters:{"дед":{text:"Встал я спозаранок и пошел репку сажать."}},name:"Посадил дед репку"},{text:"Выросла репка большая пребольшая. Стал дед репку тянуть. Тянет потянет, вытянуть не может.",time:"1984/09/10 11:00",characters:{"дед":{text:"Осень пришла, пора и урожай собирать."}},name:"Созрела репка"},{text:"Позвал дед бабку.",time:"1984/09/10 11:30",characters:{"дед":{text:"Не могу репку вытащить. Большая больно. Сходил за бабкой."},"бабка":{text:""}},name:"Позвал бабку"},{text:"Пришла бабка. Тянут потянут, вытянуть не могут.",time:"1984/09/10 11:45",characters:{"бабка":{text:""},"дед":{text:""}},name:"Не вытянули с бабкой"},{text:"Позвала бабка внучку.",time:"1984/09/10 12:00",characters:{"бабка":{text:""},"внучка":{text:""}},name:"Позвали внучку"},{text:"Пришла внучка. Тянут потянут, вытянуть не могут.",time:"1984/09/10 12:15",characters:{"дед":{text:""},"бабка":{text:""},"внучка":{text:""},"Жучка":{text:""}},name:"Не вытянули с внучкой"},{text:"Позвала внучка жучку.",time:"1984/09/10 12:30",characters:{"внучка":{text:""},"Жучка":{text:""}},name:"Позвали жучку"},{text:"Пришла жучка. Тянут потянут, вытянуть не могут.",time:"1984/09/10 12:45",characters:{"внучка":{text:""},"бабка":{text:""},"дед":{text:""},"Жучка":{text:""}},name:"Не вытянули с жучкой"},{text:"Позвала жучка кошку.",time:"1984/09/10 13:00",characters:{"кошка":{text:""},"Жучка":{text:""}},name:"Позвали кошку"},{text:"Пришла кошка. Тянут потянут, вытянуть не могут.",time:"1984/09/10 13:15",characters:{"кошка":{text:""},"внучка":{text:""},"бабка":{text:""},"дед":{text:""},"Жучка":{text:""}},name:"Не вытянули с кошкой"},{text:"Позвала кошка мышку.",time:"1984/09/10 13:30",characters:{"кошка":{text:""},"мышка":{text:"",ready:!0,name:"мышка"}},name:"Позвали мышку"},{text:"Пришла мышка. Потянули, вытянули репку.",time:"1984/09/10 13:45",characters:{"кошка":{text:""},"внучка":{text:""},"бабка":{text:""},"дед":{text:""},"Жучка":{text:""},"мышка":{text:"",ready:!0,name:"мышка"}},name:"Вытянули все вместе репку"}]},"Ряба":{name:"Ряба",story:"Жили-были дед да баба. И была у них Курочка Ряба.\nСнесла курочка яичко, да не простое - золотое.\n\nДед бил - не разбил.\n\nБаба била - не разбила.\n\nА мышка бежала, хвостиком махнула, яичко упало и разбилось.\n\nПлачет дед, плачет баба и говорит им Курочка Ряба:\n\n- Не плачь, дед, не плачь, баба: снесу вам новое яичко не золотое, а простое!\n",characters:{"Ряба":{name:"Ряба",inventory:"",activity:{active:!0}},"бабка":{name:"бабка",inventory:"метла",activity:{passive:!0}},"дед":{name:"дед",inventory:"",activity:{passive:!0}},"мышка":{name:"мышка",inventory:"",activity:{active:!0}}},events:[{name:"Снесла курочка яичко",text:"Жили-были дед да баба. И была у них Курочка Ряба.\nСнесла курочка яичко, да не простое - золотое.",time:"1989/12/23 12:00",characters:{"бабка":{text:""},"дед":{text:""},"Ряба":{text:""}}},{name:"Били - не разбили",text:"Дед бил - не разбил.\n\nБаба била - не разбила.",time:"1989/12/23 12:00",characters:{"дед":{text:""},"бабка":{text:""}}},{name:"Мышка разбила",text:"А мышка бежала, хвостиком махнула, яичко упало и разбилось.",time:"1989/12/23 12:00",characters:{"мышка":{text:""},"дед":{text:""},"бабка":{text:""}}},{name:"Курочка кудахчет",text:"Плачет дед, плачет баба и говорит им Курочка Ряба:\n\n- Не плачь, дед, не плачь, баба: снесу вам новое яичко не золотое, а простое!",time:"1989/12/23 12:00",characters:{"бабка":{text:""},"дед":{text:""},"Ряба":{text:""}}}]},"Колобок":{name:"Колобок",story:"Жил-был старик со старухой. Просит старик: «Испеки, старуха, колобок». — «Из чего печь-то? Муки нету». — «Э, эх, старуха! По коробу поскреби, по сусекам помети. Авось муки и наберется». Взяла старуха крылышко, по коробу поскребла, по сусекам помела, и набралосьмуки пригоршни с две. Замесила на сметане, изжарила в масле и положила на окошко простудить. Колобок полежал-полежал да вдруг и покатился — с окна на лавку, с лавки на пол, по полу да к дверям, перепрыгнул через порог в сени, из сеней на крыльцо, с крыльца надвор, со двора за ворота, дальше и дальше. Катится колобок по дороге,а навстречу ему заяц: «Колобок, колобок! Я тебя съем». — «Не ешьменя, косой зайчик! Я тебе песеньку спою», — сказал колобок и запел:\n \n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон, .\nДа в масле пряжон,\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nУ тебя, зайца, не хитро уйти!\n \n\n    И покатился себе дальше; только заяц его и видел! Катитсяколобок дальше, а навстречу ему волк. «Колобок, колобок! Я тебя съем». —«Не ешь меня, серой волк! Я тебе песеньку спою:\n \n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон,\nДа в масле пряжон,\n\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nЯ у зайца ушел.\nУ тебя, волка, не хитро уйти!\n\n   И покатился себе дальше, только волк его и видел!.. Катитсяколобок, а навстречу ему медведь: «Колобок, колобок! Я тебя съем». —«Где тебе, косолапому, съесть меня!\n \n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон,\nДа в масле пряжон,\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nЯ у зайца ушел.\nЯ у волка ушел!\nУ тебя, медведь, не хитро уйти!\n\n\n    И опять укатился: только медведь его и видел!.. Катится-катитсяколобок дальше, а навстречу ему лиса. «Здравствуй, колобок! — говорит. — Какой ты хорошенький!» А колобок запел:\n\n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон,\nДа в масле пряжон,\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nЯ у зайца ушел.\nЯ у волка ушел.\nУ медведя ушел\nУ тебя, лиса, и подавно уйду!\n\n\n    «Какая славная песенька! — сказала лиса. — Но ведь я, колобок,стара стала, плохо слышу; сядь-ка на мою мордочку да пропой еще разокпогромче». Колобок вскочил лисе на мордочку и запел ту же песню.«Спасибо, колобок! славная песенька, ещё бы послушала! Сядь-ка на мой язычок да пропой в последний разок». Сказала лиса и высунуласвой язык; колобок сдуру прыг ей на язык, а лиса — ам его! и скушала.",characters:{"бабка":{name:"бабка",inventory:"",activity:{passive:!0}},"дед":{name:"дед",inventory:"",activity:{passive:!0}},"Колобок":{name:"Колобок",inventory:"",activity:{active:!0}},"Волк":{name:"Волк",inventory:"",activity:{active:!0}},"Заяц":{name:"Заяц",inventory:"",activity:{active:!0}},"Лиса":{name:"Лиса",inventory:"",activity:{active:!0}},"Медведь":{name:"Медведь",inventory:"",activity:{active:!0}}},events:[{name:"Испекли колобка",text:"Жил-был старик со старухой. Просит старик: «Испеки, старуха, колобок». — «Из чего печь-то? Муки нету». — «Э, эх, старуха! По коробу поскреби, по сусекам помети. Авось муки и наберется». Взяла старуха крылышко, по коробу поскребла, по сусекам помела, и набралосьмуки пригоршни с две. Замесила на сметане, изжарила в масле и положила на окошко простудить.",time:"1990/09/01 12:00",characters:{"бабка":{text:""},"дед":{text:""},"Колобок":{text:""}}},{name:"Убежал колобок",text:"Колобок полежал-полежал да вдруг и покатился — с окна на лавку, с лавки на пол, по полу да к дверям, перепрыгнул через порог в сени, из сеней на крыльцо, с крыльца надвор, со двора за ворота, дальше и дальше.",time:"1990/09/01 12:00",characters:{"бабка":{text:""},"дед":{text:""},"Колобок":{text:""}}},{name:"Колобок и заяц",text:"Катится колобок по дороге,а навстречу ему заяц: «Колобок, колобок! Я тебя съем». — «Не ешьменя, косой зайчик! Я тебе песеньку спою», — сказал колобок и запел:\n \n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон, .\nДа в масле пряжон,\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nУ тебя, зайца, не хитро уйти!\n \n\n    И покатился себе дальше; только заяц его и видел!",time:"1990/09/08 12:00",characters:{"Колобок":{text:""},"Заяц":{text:""}}},{name:"Колобок и волк",text:"Катитсяколобок дальше, а навстречу ему волк. «Колобок, колобок! Я тебя съем». —«Не ешь меня, серой волк! Я тебе песеньку спою:\n \n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон,\nДа в масле пряжон,\n\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nЯ у зайца ушел.\nУ тебя, волка, не хитро уйти!\n\n   И покатился себе дальше, только волк его и видел!..",time:"1990/09/14 12:00",characters:{"Колобок":{text:""},"Волк":{text:""}}},{name:"Колобок и медведь",text:"Катитсяколобок, а навстречу ему медведь: «Колобок, колобок! Я тебя съем». —«Где тебе, косолапому, съесть меня!\n \n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон,\nДа в масле пряжон,\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nЯ у зайца ушел.\nЯ у волка ушел!\nУ тебя, медведь, не хитро уйти!\n\n\n    И опять укатился: только медведь его и видел!..",time:"1990/09/21 12:00",characters:{"Колобок":{text:""},"Медведь":{text:""}}},{name:"Колобок и лиса",text:"Катится-катитсяколобок дальше, а навстречу ему лиса. «Здравствуй, колобок! — говорит. — Какой ты хорошенький!» А колобок запел:\n\n\nЯ по коробу скребён,\nПо сусеку метён,\nНа сметане мешон,\nДа в масле пряжон,\nНа окошке стужон.\nЯ у дедушки ушёл.\nЯ у бабушки ушёл.\nЯ у зайца ушел.\nЯ у волка ушел.\nУ медведя ушел\nУ тебя, лиса, и подавно уйду!\n\n\n    «Какая славная песенька! — сказала лиса. — Но ведь я, колобок,стара стала, плохо слышу; сядь-ка на мою мордочку да пропой еще разокпогромче». Колобок вскочил лисе на мордочку и запел ту же песню.«Спасибо, колобок! славная песенька, ещё бы послушала! Сядь-ка на мой язычок да пропой в последний разок». Сказала лиса и высунуласвой язык; колобок сдуру прыг ей на язык, а лиса — ам его! и скушала.",time:"1990/09/28 12:00",characters:{"Колобок":{text:""},"Лиса":{text:""}}}]},"Маша и медведь":{name:"Маша и медведь",story:'Жили-были дедушка да бабушка. Была у них внучка Машенька.\n\nСобрались раз подружки в лес - по грибы да по ягоды. Пришли звать с собой и Машеньку.\n\n- Дедушка, бабушка, - говорит Машенька, - отпустите меня в лес с подружками!\n\nДедушка с бабушкой отвечают:\n\n- Иди, только смотри от подружек не отставай - не то заблудишься.\n\nПришли девушки в лес, стали собирать грибы да ягоды. Вот Машенька - деревце за деревце, кустик за кустик - и ушла далеко-далеко от подружек.\n\nСтала она аукаться, стала их звать. А подружки не слышат, не отзываются.\n\nХодила, ходила Машенька по лесу - совсем заблудилась.\n\nПришла она в самую глушь, в самую чащу. Видит-стоит избушка. Постучала Машенька в дверь - не отвечают. Толкнула она дверь, дверь и открылась.\n\nВошла Машенька в избушку, села у окна на лавочку.\n\nСела и думает:\n\n„Кто же здесь живёт? Почему никого не видно?.." А в той избушке жил большущий медведь. Только его тогда дома не было: он по лесу ходил. Вернулся вечером медведь, увидел Машеньку, обрадовался.\n\n- Ага, - говорит, - теперь не отпущу тебя! Будешь у меня жить. Будешь печку топить, будешь кашу варить, меня кашей кормить.\n\nПотужила Маша, погоревала, да ничего не поделаешь. Стала она жить у медведя в избушке.\n\nМедведь на целый день уйдёт в лес, а Машеньке наказывает никуда без него из избушки не выходить.\n\n- А если уйдёшь, - говорит, - всё равно поймаю и тогда уж съем!\n\nСтала Машенька думать, как ей от медведя убежать. Кругом лес, в какую сторону идти - не знает, спросить не у кого...\n\nДумала она, думала и придумала.\n\nПриходит раз медведь из лесу, а Машенька и говорит ему:\n\n- Медведь, медведь, отпусти меня на денёк в деревню: я бабушке да дедушке гостинцев снесу.\n\n- Нет, - говорит медведь, - ты в лесу заблудишься. Давай гостинцы, я их сам отнесу!\n\nА Машеньке того и надо!\n\nНапекла она пирожков, достала большой-пребольшой короб и говорит медведю:\n\n- Вот, смотри: я в короб положу пирожки, а ты отнеси их дедушке да бабушке. Да помни: короб по дороге не открывай, пирожки не вынимай. Я на дубок влезу, за тобой следить буду!\n\n- Ладно, - отвечает медведь, - давай короб! Машенька говорит:\n\n- Выйди на крылечко, посмотри, не идёт ли дождик! Только медведь вышел на крылечко, Машенька сейчас же залезла в короб, а на голову себе блюдо с пирожками поставила.\n\nВернулся медведь, видит - короб готов. Взвалил его на спину и пошёл в деревню.\n\nИдёт медведь между ёлками, бредёт медведь между берёзками, в овражки спускается, на пригорки поднимается. Шёл-шёл, устал и говорит:\n\nСяду на пенёк,\n\nСъем пирожок!\n\nА Машенька из короба:\n\nВижу, вижу!\n\nНе садись на пенёк,\n\nНе ешь пирожок!\n\nНеси бабушке,\n\nНеси дедушке!\n\n- Ишь какая глазастая, - говорит медведь, - всё видит! Поднял он короб и пошёл дальше. Шёл-шёл, шёл-шёл, остановился, сел и говорит:\n\nСяду на пенёк,\n\nСъем пирожок!\n\nА Машенька из короба опять:\n\nВижу, вижу!\n\nНе садись на пенёк,\n\nНе ешь пирожок!\n\nНеси бабушке,\n\nНеси дедушке!\n\nУдивился медведь:\n\n- Вот какая хитрая! Высоко сидит, далеко глядит! Встал и пошёл скорее.\n\nПришёл в деревню, нашёл дом, где дедушка с бабушкой жили, и давай изо всех сил стучать в ворота:\n\n- Тук-тук-тук! Отпирайте, открывайте! Я вам от Машеньки гостинцев принёс.\n\nА собаки почуяли медведя и бросились на него. Со всех дворов бегут, лают.\n\nИспугался медведь, поставил короб у ворот и пустился в лес без оглядки.\n\nВышли тут дедушка да бабушка к воротам. Видят- короб стоит.\n\n- Что это в коробе? - говорит бабушка.\n\nА дедушка поднял крышку, смотрит и глазам своим не верит: в коробе Машенька сидит - живёхонька и здоровёхонька.\n\nОбрадовались дедушка да бабушка. Стали Машеньку обнимать, целовать, умницей называть.\n',characters:{"внучка":{name:"внучка",inventory:"",activity:{active:!0}},"бабка":{name:"бабка",inventory:"",activity:{passive:!0}},"дед":{name:"дед",inventory:"",activity:{passive:!0}},"Медведь":{name:"Медведь",inventory:"",activity:{active:!0}}},events:[{name:"Пошли грибы собирать",text:"Жили-были дедушка да бабушка. Была у них внучка Машенька.\n\nСобрались раз подружки в лес - по грибы да по ягоды. Пришли звать с собой и Машеньку.\n\n- Дедушка, бабушка, - говорит Машенька, - отпустите меня в лес с подружками!\n\nДедушка с бабушкой отвечают:\n\n- Иди, только смотри от подружек не отставай - не то заблудишься.",time:"1989/03/27 12:00",characters:{"внучка":{text:""},"бабка":{text:""},"дед":{text:""}}},{name:"Маша заблудилась",text:"Пришли девушки в лес, стали собирать грибы да ягоды. Вот Машенька - деревце за деревце, кустик за кустик - и ушла далеко-далеко от подружек.\n\nСтала она аукаться, стала их звать. А подружки не слышат, не отзываются.\n\nХодила, ходила Машенька по лесу - совсем заблудилась.",time:"1989/03/27 12:00",characters:{"внучка":{text:""},"бабка":{text:""},"дед":{text:""}}},{name:"Нашла избушку",text:'Пришла она в самую глушь, в самую чащу. Видит-стоит избушка. Постучала Машенька в дверь - не отвечают. Толкнула она дверь, дверь и открылась.\n\nВошла Машенька в избушку, села у окна на лавочку.\n\nСела и думает:\n\n„Кто же здесь живёт? Почему никого не видно?.."',time:"1989/03/28 12:00",characters:{"внучка":{text:""}}},{name:"Маша у медведя",text:"А в той избушке жил большущий медведь. Только его тогда дома не было: он по лесу ходил. Вернулся вечером медведь, увидел Машеньку, обрадовался.\n\n- Ага, - говорит, - теперь не отпущу тебя! Будешь у меня жить. Будешь печку топить, будешь кашу варить, меня кашей кормить.\n\nПотужила Маша, погоревала, да ничего не поделаешь. Стала она жить у медведя в избушке.\n\nМедведь на целый день уйдёт в лес, а Машеньке наказывает никуда без него из избушки не выходить.\n\n- А если уйдёшь, - говорит, - всё равно поймаю и тогда уж съем!\n\nСтала Машенька думать, как ей от медведя убежать. Кругом лес, в какую сторону идти - не знает, спросить не у кого...\n\nДумала она, думала и придумала.",time:"1989/03/28 12:00",characters:{"внучка":{text:""},"Медведь":{text:""}}},{name:"Маша собрала гостинцев",text:"Приходит раз медведь из лесу, а Машенька и говорит ему:\n\n- Медведь, медведь, отпусти меня на денёк в деревню: я бабушке да дедушке гостинцев снесу.\n\n- Нет, - говорит медведь, - ты в лесу заблудишься. Давай гостинцы, я их сам отнесу!\n\nА Машеньке того и надо!\n\nНапекла она пирожков, достала большой-пребольшой короб и говорит медведю:\n\n- Вот, смотри: я в короб положу пирожки, а ты отнеси их дедушке да бабушке. Да помни: короб по дороге не открывай, пирожки не вынимай. Я на дубок влезу, за тобой следить буду!\n\n- Ладно, - отвечает медведь, - давай короб! Машенька говорит:\n\n- Выйди на крылечко, посмотри, не идёт ли дождик! Только медведь вышел на крылечко, Машенька сейчас же залезла в короб, а на голову себе блюдо с пирожками поставила.\n\nВернулся медведь, видит - короб готов. Взвалил его на спину и пошёл в деревню.",time:"1989/04/02 12:00",characters:{"внучка":{text:""},"Медведь":{text:""}}},{name:"Медведь идет с гостинцами",text:"Идёт медведь между ёлками, бредёт медведь между берёзками, в овражки спускается, на пригорки поднимается. Шёл-шёл, устал и говорит:\n\nСяду на пенёк,\n\nСъем пирожок!\n\nА Машенька из короба:\n\nВижу, вижу!\n\nНе садись на пенёк,\n\nНе ешь пирожок!\n\nНеси бабушке,\n\nНеси дедушке!\n\n- Ишь какая глазастая, - говорит медведь, - всё видит! Поднял он короб и пошёл дальше. Шёл-шёл, шёл-шёл, остановился, сел и говорит:\n\nСяду на пенёк,\n\nСъем пирожок!\n\nА Машенька из короба опять:\n\nВижу, вижу!\n\nНе садись на пенёк,\n\nНе ешь пирожок!\n\nНеси бабушке,\n\nНеси дедушке!\n\nУдивился медведь:\n\n- Вот какая хитрая! Высоко сидит, далеко глядит! Встал и пошёл скорее.",time:"1989/04/02 12:00",characters:{"внучка":{text:""},"Медведь":{text:""}}},{name:"Медведь пришел, испугался и убежал",text:"Пришёл в деревню, нашёл дом, где дедушка с бабушкой жили, и давай изо всех сил стучать в ворота:\n\n- Тук-тук-тук! Отпирайте, открывайте! Я вам от Машеньки гостинцев принёс.\n\nА собаки почуяли медведя и бросились на него. Со всех дворов бегут, лают.\n\nИспугался медведь, поставил короб у ворот и пустился в лес без оглядки.",time:"1989/04/02 12:00",characters:{"внучка":{text:""},"Медведь":{text:""}}},{name:"Машенька сидит - живёхонька и здоровёхонька",text:"Вышли тут дедушка да бабушка к воротам. Видят- короб стоит.\n\n- Что это в коробе? - говорит бабушка.\n\nА дедушка поднял крышку, смотрит и глазам своим не верит: в коробе Машенька сидит - живёхонька и здоровёхонька.\n\nОбрадовались дедушка да бабушка. Стали Машеньку обнимать, целовать, умницей называть.",time:"1989/04/02 12:00",characters:{"бабка":{text:""},"дед":{text:""},"внучка":{text:""}}}]},"Теремок":{name:"Теремок",story:"Стоит в поле теремок. Бежит мимо мышка-норушка. Увидела теремок, остановилась и спрашивает:\n\n— Терем-теремок! Кто в тереме живет? Никто не отзывается. Вошла мышка в теремок и стала там жить.\n\nПрискакала к терему лягушка-квакушка и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка! А ты кто?\n\n— А я лягушка-квакушка.\n\n— Иди ко мне жить! Лягушка прыгнула в теремок. Стали они вдвоем жить.\n\nБежит мимо зайчик-побегайчик. Остановился и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка!\n\n— Я, лягушка-квакушка!\n\n— А ты кто?\n\n— А я зайчик-побегайчик.\n\n— Иди к нам жить! Заяц скок в теремок! Стали они втроем жить.\n\nИдет мимо лисичка-сестричка. Постучала в окошко и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка.\n\n— Я, лягушка-квакушка.\n\n— Я, зайчик-побегайчик.\n\n— А ты кто?\n\n— А я лисичка-сестричка.\n\n— Иди к нам жить! Забралась лисичка в теремок. Стали они вчетвером жить.\n\nПрибежал волчок-серый бочок, заглянул в дверь и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка.\n\n— Я, лягушка-квакушка.\n\n— Я, зайчик-побегайчик.\n\n— Я, лисичка-сестричка.\n\n— А ты кто?\n\n— А я волчок-серый бочок.\n\n— Иди к нам жить!\n\nВолк влез в теремок. Стали они впятером жить. Вот они в теремке живут, песни поют.\n\nВдруг идет медведь косолапый. Увидел медведь теремок, услыхал песни, остановился и заревел во всю мочь:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка.\n\n— Я, лягушка-квакушка.\n\n— Я, зайчик-побегайчик.\n\n— Я, лисичка-сестричка.\n\n— Я, волчок-серый бочок.\n\n— А ты кто?\n\n— А я медведь косолапый.\n\n— Иди к нам жить!\n\nМедведь и полез в теремок. Лез-лез, лез-лез — никак не мог влезть и говорит:\n\n— А я лучше у вас на крыше буду жить.\n\n— Да ты нас раздавишь.\n\n— Нет, не раздавлю.\n\n— Ну так полезай! Влез медведь на крышу и только уселся — трах! — развалился теремок.\n\nЗатрещал теремок, упал набок и весь развалился. Еле-еле успели из него выскочить мышка-норушка, лягушка-квакушка, зайчик-побегайчик, лисичка-сестричка, волчок-серый бочок — все целы и невредимы.\n\nПринялись они бревна носить, доски пилить — новый теремок строить.\n\nЛучше прежнего выстроили!\n",characters:{"Медведь":{name:"Медведь",inventory:"",activity:{defensive:!0}},"Лиса":{name:"Лиса",inventory:"",activity:{defensive:!0}},"Заяц":{name:"Заяц",inventory:"",activity:{defensive:!0,active:!0,follower:!0,passive:!0}},"Волк":{name:"Волк",inventory:"",activity:{defensive:!0}},"Лягушка":{name:"Лягушка",inventory:"",activity:{defensive:!0}},"Мышка-норушка":{name:"Мышка-норушка",inventory:"",activity:{defensive:!0}}},events:[{name:"Теремок и мышка",text:"Стоит в поле теремок. Бежит мимо мышка-норушка. Увидела теремок, остановилась и спрашивает:\n\n— Терем-теремок! Кто в тереме живет? Никто не отзывается. Вошла мышка в теремок и стала там жить.",time:"1990/06/01 12:00",characters:{"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Пришла лягушка",text:"Прискакала к терему лягушка-квакушка и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка! А ты кто?\n\n— А я лягушка-квакушка.\n\n— Иди ко мне жить! Лягушка прыгнула в теремок. Стали они вдвоем жить.",time:"1990/06/03 12:00",characters:{"Лягушка":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Пришел заяц",text:"Бежит мимо зайчик-побегайчик. Остановился и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка!\n\n— Я, лягушка-квакушка!\n\n— А ты кто?\n\n— А я зайчик-побегайчик.\n\n— Иди к нам жить! Заяц скок в теремок! Стали они втроем жить.",time:"1990/06/06 12:00",characters:{"Лягушка":{text:""},"Заяц":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Пришла лисичка",text:"Идет мимо лисичка-сестричка. Постучала в окошко и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка.\n\n— Я, лягушка-квакушка.\n\n— Я, зайчик-побегайчик.\n\n— А ты кто?\n\n— А я лисичка-сестричка.\n\n— Иди к нам жить! Забралась лисичка в теремок. Стали они вчетвером жить.",time:"1990/06/10 12:00",characters:{"Лягушка":{text:""},"Заяц":{text:""},"Лиса":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Пришел волк",text:"Прибежал волчок-серый бочок, заглянул в дверь и спрашивает:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка.\n\n— Я, лягушка-квакушка.\n\n— Я, зайчик-побегайчик.\n\n— Я, лисичка-сестричка.\n\n— А ты кто?\n\n— А я волчок-серый бочок.\n\n— Иди к нам жить!\n\nВолк влез в теремок. Стали они впятером жить. Вот они в теремке живут, песни поют.",time:"1990/06/14 12:00",characters:{"Лягушка":{text:""},"Заяц":{text:""},"Лиса":{text:""},"Волк":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Пришел медведь",text:"Вдруг идет медведь косолапый. Увидел медведь теремок, услыхал песни, остановился и заревел во всю мочь:\n\n— Терем-теремок! Кто в тереме живет?\n\n— Я, мышка-норушка.\n\n— Я, лягушка-квакушка.\n\n— Я, зайчик-побегайчик.\n\n— Я, лисичка-сестричка.\n\n— Я, волчок-серый бочок.\n\n— А ты кто?\n\n— А я медведь косолапый.\n\n— Иди к нам жить!\n\nМедведь и полез в теремок. Лез-лез, лез-лез — никак не мог влезть и говорит:\n\n— А я лучше у вас на крыше буду жить.\n\n— Да ты нас раздавишь.\n\n— Нет, не раздавлю.\n\n— Ну так полезай!",time:"1990/06/21 12:00",characters:{"Лягушка":{text:""},"Заяц":{text:""},"Лиса":{text:""},"Волк":{text:""},"Медведь":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Развалился теремок",text:"Влез медведь на крышу и только уселся — трах! — развалился теремок.\n\nЗатрещал теремок, упал набок и весь развалился. Еле-еле успели из него выскочить мышка-норушка, лягушка-квакушка, зайчик-побегайчик, лисичка-сестричка, волчок-серый бочок — все целы и невредимы.",time:"1990/06/21 12:00",characters:{"Лягушка":{text:""},"Заяц":{text:""},"Лиса":{text:""},"Волк":{text:""},"Медведь":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}},{name:"Построили новый теремок",text:"Принялись они бревна носить, доски пилить — новый теремок строить.\n\nЛучше прежнего выстроили!",time:"1990/06/28 12:00",characters:{"Лягушка":{text:""},"Заяц":{text:""},"Лиса":{text:""},"Волк":{text:""},"Медведь":{text:""},"Мышка-норушка":{text:"",name:"Мышка-норушка"}}}]},"Петушок и бобовое зернышко":{name:"Петушок и бобовое зернышко",story:"Жили-были петушок и курочка. Петушок все торопился, да торопился, а курочка знай себе да приговаривает:\n\n- Петя, не торопись. Петя, не торопись.\n\nКлевал как-то петушок бобовые зернышки, да второпях и подавился. Подавился, не дышит, не слышит, лежит не шевелиться. Перепугалась курочка, бросилась к хозяйке, кричит:\n\n- Ох, хозяюшка, дай скорей маслица петушку горлышко смазать: подавился петушок бобовым зернышком.\n\nХозяйка говорит:\n\n- Беги скорей к коровушке, проси у нее молока, а я уж собью маслица.\n\nБросилась курочка к корове:\n\n- Коровушка, голубушка, дай скорее молока, из молока хозяюшка собьет маслица, маслицем смажу петушку горлышко: подавился петушок бобовым зернышком.\n\n- Ступай скорее к хозяину, пусть он принесет мне свежей травы.\n\nБежит курочка к хозяину:\n\n-Хозяин! Хозяин! Дай скорее коровушке свежей травы, коровушка даст молочка, из молочка хозяюшка собьет маслица, маслицем я смажу петушку горлышко: подавился петушок бобовым зернышком.\n\n- Беги скорей к кузнецу за косой, - говорит хозяин.\n\nСо всех ног бросилась курочка к кузнецу:\n\n- Кузнец, кузнец, дай скорее хозяину хорошую косу. Хозяин даст коровушке травы, коровушка даст молока, хозяюшка даст мне маслица, я смажу петушку горлышко: подавился петушок бобовым зернышком.\n\nКузнец дал хозяину новую косу, хозяин дал коровушке свежей травы, коровушка дала молока, хозяюшка сбила масла, дала маслица курочке. Смазала курочка петушку горлышко. Бобовое зернышко и проскочило. Петушок вскочил живехонький и во все горло запел:\n\n- Ку-ка-реку!\n",characters:{"бабка":{name:"бабка",inventory:"",activity:{passive:!0}},"дед":{name:"дед",inventory:"",activity:{passive:!0}},"Ряба":{name:"Ряба",inventory:"",activity:{active:!0}},"Петушок":{name:"Петушок",inventory:"",activity:{passive:!0}},"Корова":{name:"Корова",inventory:"",activity:{passive:!0}},"Кузнец":{name:"Кузнец",inventory:"",activity:{passive:!0}}},events:[{name:"Петушок подавился",text:"Жили-были петушок и курочка. Петушок все торопился, да торопился, а курочка знай себе да приговаривает:\n\n- Петя, не торопись. Петя, не торопись.\n\nКлевал как-то петушок бобовые зернышки, да второпях и подавился. Подавился, не дышит, не слышит, лежит не шевелиться.",time:"1989/05/01 2:00",characters:{"Петушок":{text:""},"Ряба":{text:""}}},{name:"Курочка и хозяйка",text:"Перепугалась курочка, бросилась к хозяйке, кричит:\n\n- Ох, хозяюшка, дай скорей маслица петушку горлышко смазать: подавился петушок бобовым зернышком.\n\nХозяйка говорит:\n\n- Беги скорей к коровушке, проси у нее молока, а я уж собью маслица.",time:"1989/05/01 2:05",characters:{"Ряба":{text:""},"бабка":{text:""}}},{name:"Курочка и корова",text:"Бросилась курочка к корове:\n\n- Коровушка, голубушка, дай скорее молока, из молока хозяюшка собьет маслица, маслицем смажу петушку горлышко: подавился петушок бобовым зернышком.\n\n- Ступай скорее к хозяину, пусть он принесет мне свежей травы.",time:"1989/05/01 2:10",characters:{"Ряба":{text:""},"Корова":{text:""}}},{name:"Курочка и хозяин",text:"Бежит курочка к хозяину:\n\n-Хозяин! Хозяин! Дай скорее коровушке свежей травы, коровушка даст молочка, из молочка хозяюшка собьет маслица, маслицем я смажу петушку горлышко: подавился петушок бобовым зернышком.\n\n- Беги скорей к кузнецу за косой, - говорит хозяин.",time:"1989/05/01 2:15",characters:{"Ряба":{text:""},"дед":{text:""}}},{name:"Курочка и кузнец",text:"Со всех ног бросилась курочка к кузнецу:\n\n- Кузнец, кузнец, дай скорее хозяину хорошую косу. Хозяин даст коровушке травы, коровушка даст молока, хозяюшка даст мне маслица, я смажу петушку горлышко: подавился петушок бобовым зернышком.",time:"1989/05/01 2:20",characters:{"Ряба":{text:""},"Кузнец":{text:""}}},{name:"Сделали маслице",text:"Кузнец дал хозяину новую косу, хозяин дал коровушке свежей травы, коровушка дала молока, хозяюшка сбила масла, дала маслица курочке. Смазала курочка петушку горлышко. Бобовое зернышко и проскочило. Петушок вскочил живехонький и во все горло запел:\n\n- Ку-ка-реку!",
time:"1989/05/01 2:25",characters:{"Ряба":{text:""},"бабка":{text:""},"дед":{text:""},"Корова":{text:""},"Кузнец":{text:""},"Петушок":{text:""}}}]}},Version:"0.4.1"}}("undefined"==typeof exports?this.BaseExample={}:exports),function(t){t.startsWith=function(t,e){return t.substring(0,e.length)===e},t.removeFromArrayByIndex=function(t,e,i){var n=t.slice((i||e)+1||t.length);return t.length=0>e?t.length+e:e,t.push.apply(t,n)},t.charOrdAFactory=function(t){return function(e,i){return e=t(e),i=t(i),e>i?1:i>e?-1:0}},t.charOrdA=t.charOrdAFactory(function(t){return t.toLowerCase()}),t.eventsByTime=t.charOrdAFactory(function(t){return new Date(t.time)}),t.strFormat=function(t,e){return t.replace(/\{\{|\}\}|\{(\d+)\}/g,function(t,i){return"{{"==t?"{":"}}"==t?"}":e[i]})},t.consoleLog=function(t){console.log(t)},t.clone=function(e){if(!e||"object"!=typeof e)return e;var i,n,r="function"==typeof e.pop?[]:{};for(i in e)e.hasOwnProperty(i)&&(n=e[i],n&&"object"==typeof n?r[i]=t.clone(n):r[i]=n);return r}}("undefined"==typeof exports?this.CommonUtils={}:exports),function(t){t.profileFieldTypes={text:{name:"text",value:""},string:{name:"string",value:""},"enum":{name:"enum",value:"_"},number:{name:"number",value:0},checkbox:{name:"checkbox",value:!1}},t.objectSubsets=["allObjects","selectedCharacters","selectedStories"],t.networks=["socialRelations","characterPresenceInStory","characterActivityInStory"],t.noGroup="noGroup",t.characterActivityTypes=["active","follower","defensive","passive"],t.numberFilter=["ignore","greater","equal","lesser"],t.finishedText="finishedText",t.finishedSuffix="finishedSuffix",t.emptySuffix="emptySuffix",t[!0]="yes",t[!1]="no",t.yesNo=[t[!0],t[!1]],t.briefingNumber=[1,5,10,20],t.colorPalette=[{color:{border:"#FA0A10",background:"#FB7E81",highlight:{border:"#FA0A10",background:"#FFAFB1"},hover:{border:"#FA0A10",background:"#FFAFB1"}}},{color:{border:"#41A906",background:"#7BE141",highlight:{border:"#41A906",background:"#A1EC76"},hover:{border:"#41A906",background:"#A1EC76"}}},{color:{border:"#E129F0",background:"#EB7DF4",highlight:{border:"#E129F0",background:"#F0B3F5"},hover:{border:"#E129F0",background:"#F0B3F5"}}},{color:{border:"#7C29F0",background:"#AD85E4",highlight:{border:"#7C29F0",background:"#D3BDF0"},hover:{border:"#7C29F0",background:"#D3BDF0"}}},{color:{border:"#C37F00",background:"#FFA807",highlight:{border:"#C37F00",background:"#FFCA66"},hover:{border:"#C37F00",background:"#FFCA66"}}},{color:{border:"#4220FB",background:"#6E6EFD",highlight:{border:"#4220FB",background:"#9B9BFD"},hover:{border:"#4220FB",background:"#9B9BFD"}}},{color:{border:"#FD5A77",background:"#FFC0CB",highlight:{border:"#FD5A77",background:"#FFD1D9"},hover:{border:"#FD5A77",background:"#FFD1D9"}}},{color:{border:"#4AD63A",background:"#C2FABC",highlight:{border:"#4AD63A",background:"#E6FFE3"},hover:{border:"#4AD63A",background:"#E6FFE3"}}},{color:{border:"#990000",background:"#EE0000",highlight:{border:"#BB0000",background:"#FF3333"},hover:{border:"#BB0000",background:"#FF3333"}}},{color:{border:"#FF6000",background:"#FF6000",highlight:{border:"#FF6000",background:"#FF6000"},hover:{border:"#FF6000",background:"#FF6000"}}},{color:{border:"#97C2FC",background:"#2B7CE9",highlight:{border:"#D2E5FF",background:"#2B7CE9"},hover:{border:"#D2E5FF",background:"#2B7CE9"}}},{color:{border:"#399605",background:"#255C03",highlight:{border:"#399605",background:"#255C03"},hover:{border:"#399605",background:"#255C03"}}},{color:{border:"#B70054",background:"#FF007E",highlight:{border:"#B70054",background:"#FF007E"},hover:{border:"#B70054",background:"#FF007E"}}},{color:{border:"#AD85E4",background:"#7C29F0",highlight:{border:"#D3BDF0",background:"#7C29F0"},hover:{border:"#D3BDF0",background:"#7C29F0"}}},{color:{border:"#4557FA",background:"#000EA1",highlight:{border:"#6E6EFD",background:"#000EA1"},hover:{border:"#6E6EFD",background:"#000EA1"}}},{color:{border:"#FFC0CB",background:"#FD5A77",highlight:{border:"#FFD1D9",background:"#FD5A77"},hover:{border:"#FFD1D9",background:"#FD5A77"}}},{color:{border:"#C2FABC",background:"#74D66A",highlight:{border:"#E6FFE3",background:"#74D66A"},hover:{border:"#E6FFE3",background:"#74D66A"}}},{color:{border:"#EE0000",background:"#990000",highlight:{border:"#FF3333",background:"#BB0000"},hover:{border:"#FF3333",background:"#BB0000"}}}]}("undefined"==typeof exports?this.Constants={}:exports),function(t){var e=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(o,s,a){var l=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(s=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");s=String(l.masks[s]||s||l.masks["default"]),"UTC:"==s.slice(0,4)&&(s=s.slice(4),a=!0);var h=a?"getUTC":"get",d=o[h+"Date"](),u=o[h+"Day"](),c=o[h+"Month"](),f=o[h+"FullYear"](),p=o[h+"Hours"](),A=o[h+"Minutes"](),m=o[h+"Seconds"](),g=o[h+"Milliseconds"](),v=a?0:o.getTimezoneOffset(),y={d:d,dd:r(d),ddd:l.i18n.dayNames[u],dddd:l.i18n.dayNames[u+7],m:c+1,mm:r(c+1),mmm:l.i18n.monthNames[c],mmmm:l.i18n.monthNames[c+12],yy:String(f).slice(2),yyyy:f,h:p%12||12,hh:r(p%12||12),H:p,HH:r(p),M:A,MM:r(A),s:m,ss:r(m),l:r(g,3),L:r(g>99?Math.round(g/10):g),t:12>p?"a":"p",tt:12>p?"am":"pm",T:12>p?"A":"P",TT:12>p?"AM":"PM",Z:a?"UTC":(String(o).match(i)||[""]).pop().replace(n,""),o:(v>0?"-":"+")+r(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return s.replace(t,function(t){return t in y?y[t]:t.slice(1,t.length-1)})}}();e.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},t(e)}(function(t){"undefined"==typeof exports?this.dateFormat=t:module.exports=t}.bind(this)),function(t){t.data={Meta:{name:"",date:"",preGameDate:"",description:""},Characters:{},ProfileSettings:[],Stories:{},Settings:{BriefingPreview:{},Stories:{},CharacterProfile:{}},Version:"0.4.1"}}("undefined"==typeof exports?this.EmptyBase={}:exports),function(t){function e(t,i){Error.call(this,arguments),this.name="ValidationError",this.messageId=t,this.parameters=i,Error.captureStackTrace?Error.captureStackTrace(this,e):this.stack=(new Error).stack}e.prototype=Object.create(Error.prototype),t.ValidationError=e}("undefined"==typeof exports?this.Errors={}:exports),function(t){var e=function(t,e,i){console.log(e+"."+i+": "+(void 0!==t[i]?"OK":"undefined"))};t.migrate=function(t){if(e(t,"base","Stories"),!t.Version){t.Settings={};var i,n;Object.keys(t.Stories).forEach(function(e){i=t.Stories[e],n=Object.keys(i.characters),n.forEach(function(t){i.characters[t].activity={}})}),t.Version="0.0.4"}if("0.0.4"===t.Version&&(t.Version="0.4.1"),"0.4.1"===t.Version&&(delete t.Settings.Events,t.Version="0.4.3"),"0.4.3"===t.Version&&(t.Log=[],t.Version="0.4.4",t.Meta.saveTime=new Date),"0.4.4"===t.Version){var r,i;Object.keys(t.Characters).forEach(function(e){r=t.Characters[e],delete r.displayName}),Object.keys(t.Stories).forEach(function(e){i=t.Stories[e],delete i.displayName}),t.Version="0.4.4u1"}if("0.4.4u1"===t.Version){t.ProfileSettings.forEach(function(t){t.doExport=!0}),t.Meta.saveTime=(new Date).toString();for(var o in t.Stories){var i=t.Stories[o];i.events.forEach(function(t){delete t.index,delete t.storyName})}for(var o in t.Stories){var i=t.Stories[o];i.events.forEach(function(t){for(var e in t.characters)delete t.characters[e].name,t.characters[e].time=""})}t.Version="0.4.4u2"}return e(t,"base","Characters"),e(t,"base","ProfileSettings"),e(t,"base","Meta"),e(t,"base","Log"),e(t.Meta,"base.Meta","name"),e(t.Meta,"base.Meta","date"),e(t.Meta,"base.Meta","preGameDate"),e(t.Meta,"base.Meta","description"),e(t.Meta,"base.Meta","saveTime"),t}}("undefined"==typeof exports?this.Migrator={}:exports),function(t){function e(){return{title:"Meta",description:"Contains meta data for game: name, description, dates and saving time.",type:"object",properties:{name:{type:"string",description:"Game name"},date:{type:"string",description:"Time of starting game in game universe."},preGameDate:{type:"string",description:"Time of starting pregame events in game universe."},description:{type:"string",description:"Description text for game."},saveTime:{type:"string",description:"Stringified date of last database saving."}},required:["name","date","preGameDate","description","saveTime"],additionalProperties:!1}}function i(){return{title:"ProfileSettings",description:"Describes character profile settings.",type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string","enum":["string","number","text","checkbox","enum"]},value:{type:["string","number","boolean"]},doExport:{type:"boolean"}},required:["name","type","value","doExport"],additionalProperties:!1}}}function n(){return{type:"array",items:{type:"array",items:{type:"string"},minItems:4,maxItems:4}}}function r(t){var e,i={name:{type:"string"}};t.forEach(function(t){switch(t.type){case"text":case"string":e={type:"string"};break;case"checkbox":e={type:"boolean"};break;case"number":e={type:"number"};break;case"enum":e={type:"string","enum":t.value.split(",").map(function(t){return t.trim()})}}i[t.name]=e});var n={type:"object",additionalProperties:{type:"object",properties:i,required:Object.keys(i),additionalProperties:!1}};return n}function o(t){var e=Object.keys(t),i={type:"object",properties:{text:{type:"string"},time:{type:"string"},ready:{type:"boolean"}},required:["text","time"],additionalProperties:!1},n={type:"object",properties:{name:{type:"string"},text:{type:"string"},time:{type:"string"},characters:{type:"object",properties:e.reduce(function(t,e){return t[e]=i,t},{}),additionalProperties:!1}},required:["name","text","time","characters"],additionalProperties:!1},r={type:"object",properties:{name:{type:"string","enum":e},inventory:{type:"string"},activity:{type:"object",properties:{active:{type:"boolean"},follower:{type:"boolean"},defensive:{type:"boolean"},passive:{type:"boolean"}},additionalProperties:!1}},required:["name","inventory","activity"],additionalProperties:!1},o={type:"object",properties:{name:{type:"string"},story:{type:"string"},characters:{type:"object",properties:e.reduce(function(t,e){return t[e]=r,t},{}),additionalProperties:!1},events:{type:"array",items:n}},required:["name","story","characters","events"],additionalProperties:!1},s={type:"object",additionalProperties:o};return s}function s(t,e,i){var n=Object.keys(e),r=Object.keys(i),o=Object.keys(t.UsersInfo),s={type:"object",properties:{name:{type:"string"},stories:{type:"array",items:{type:"string","enum":r.concat("123")},minItems:0},characters:{type:"array",items:{type:"string","enum":n.concat("123")}},salt:{type:"string"},hashedPassword:{type:"string"}},required:["name","stories","characters","salt","hashedPassword"],additionalProperties:!1},a={type:"object",properties:{UsersInfo:{type:"object",additionalProperties:s},admin:{type:"string","enum":o},editor:{type:["string","null"],"enum":o.concat(null)},adaptationRights:{type:"string","enum":["ByStory","ByCharacter"]}},required:["UsersInfo","admin","editor","adaptationRights"],additionalProperties:!1};return a}t.getSchema=function(t){var a={$schema:"http://json-schema.org/draft-04/schema#",title:"SMTK NIMS base",description:"SMTK NIMS base schema.",type:"object"},l=e(),h=i(),d=n(),u=r(t.ProfileSettings),c=o(t.Characters),f={};return t.ManagementInfo&&(f=s(t.ManagementInfo,t.Characters,t.Stories)),a.properties={Meta:l,ProfileSettings:h,Characters:u,Stories:c,Version:{type:"string"},Log:d,Settings:{},ManagementInfo:f},a.required=["Meta","ProfileSettings","Version","Characters","Stories","Log"],a.additionalProperties=!1,a}}("undefined"==typeof exports?this.Schema={}:exports),function(t){function e(t,e){t.prototype.getUsersInfo=function(t){var i=this.database.ManagementInfo;t(null,{usersInfo:e.clone(i.UsersInfo),admin:i.admin,editor:i.editor,adaptationRights:i.adaptationRights})},t.prototype.assignAdmin=function(t,e){this.database.ManagementInfo.admin=t,this.publishPermissionsUpdate(),e()},t.prototype.assignEditor=function(t,e){this.database.ManagementInfo.editor=t,this.publishPermissionsUpdate(),e()},t.prototype.removeEditor=function(t){this.database.ManagementInfo.editor=null,this.publishPermissionsUpdate(),t()},t.prototype.changeAdaptationRightsMode=function(t,e){this.database.ManagementInfo.adaptationRights=t,this.publishPermissionsUpdate(),e()},t.prototype.isUserNameUsed=function(t,e){e(null,void 0!==this.database.ManagementInfo.UsersInfo[t])},t.prototype.createUser=function(t,e,i){this.database.ManagementInfo.UsersInfo[t]={name:t,stories:[],characters:[]},i()},t.prototype.changePassword=function(t,e,i){Utils.alert(strFormat(getL10n("function-must-be-overriden-on-server"),["changePassword"])),i()},t.prototype.removeUser=function(t,e){delete this.database.ManagementInfo.UsersInfo[t],this.publishPermissionsUpdate(),e()},t.prototype.removePermission=function(t,e,i,n){var r=this.database.ManagementInfo;0!=i.length&&(r.UsersInfo[t].characters=r.UsersInfo[t].characters.filter(function(t){return-1===i.indexOf(t)})),0!=e.length&&(r.UsersInfo[t].stories=r.UsersInfo[t].stories.filter(function(t){return-1===e.indexOf(t)})),this.publishPermissionsUpdate(),n()},t.prototype.assignPermission=function(t,e,i,n){var r=this.database.ManagementInfo;0!=i.length&&(i.forEach(function(e){-1===r.UsersInfo[t].characters.indexOf(e)&&r.UsersInfo[t].characters.push(e)}),Object.keys(r.UsersInfo).forEach(function(e){e!==t&&(r.UsersInfo[e].characters=r.UsersInfo[e].characters.filter(function(t){return-1===i.indexOf(t)}))})),0!=e.length&&(e.forEach(function(e){-1===r.UsersInfo[t].stories.indexOf(e)&&r.UsersInfo[t].stories.push(e)}),Object.keys(r.UsersInfo).forEach(function(i){i!==t&&(r.UsersInfo[i].stories=r.UsersInfo[i].stories.filter(function(t){return-1===e.indexOf(t)}))})),this.publishPermissionsUpdate(),n()},t.prototype.publishPermissionsUpdate=function(){Utils.alert(strFormat(getL10n("function-must-be-overriden-on-server"),["publishPermissionsUpdate"]))}}t(e)}(function(t){"undefined"==typeof exports?this.accessManagerAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.getBriefingData=function(t,n){var l={},h=[];for(var d in this.database.Characters)if(!t||t[d]){var u=[];for(var c in this.database.Stories){var f=this.database.Stories[c];f.characters[d]&&f.characters[d].inventory&&""!==f.characters[d].inventory&&(u=u.concat(f.characters[d].inventory))}u=u.join(", ");var p=r(this.database,d),A=o(this.database,d),m=s(this.database,d),g=a(this.database,d),v={gameName:this.database.Meta.name,name:d,inventory:u,storiesInfo:m,eventsInfo:g,profileInfoArray:A};for(var y in p)v["profileInfo-"+y]=p[y];h.push(v)}h.sort(e.charOrdAFactory(i.prop("name"))),l.briefings=h,l.gameName=this.database.Meta.name,n(null,l)};var r=function(t,e){var i=t.Characters[e],n={};return t.ProfileSettings.forEach(function(t){switch(t.type){case"text":case"string":case"enum":case"number":n[t.name]=i[t.name];break;case"checkbox":n[t.name]=i[t.name]}}),n},o=function(t,e){var n,r,o=t.Characters[e],s=i.compose(i.equals(!0),i.prop("doExport")),a=t.ProfileSettings.filter(s).map(function(t){switch(t.type){case"text":n=o[t.name],r=d(n);break;case"enum":case"string":case"number":r=n=o[t.name];break;case"checkbox":r=n=o[t.name]}return{name:t.name,value:n,splittedText:r}});return a},s=function(t,n){return i.values(t.Stories).filter(function(t){return t.characters[n]}).map(function(t){return{name:t.name,eventsInfo:l(t,n)}}).sort(e.charOrdAFactory(function(t){return t.name.toLowerCase()}))},a=function(t,n){var r=i.values(t.Stories).filter(function(t){return t.characters[n]}).map(function(t){return l(t,n)});return r=r.reduce(function(t,e){return t.concat(e)},[]),r.sort(e.eventsByTime),r},l=function(t,e){return t.events.filter(function(t){return t.characters[e]}).map(h(e,t.name))},h=i.curry(function(t,e,i){var n={};return""!==i.characters[t].text?n.text=i.characters[t].text:n.text=i.text,n.splittedText=d(n.text),""!==i.characters[t].time?n.time=i.characters[t].time:n.time=i.time,n.name=i.name,n.storyName=e,n}),d=function(t){return t.split("\n").map(function(t){return{string:t}})}}t(e)}(function(t){"undefined"==typeof exports?this.briefingExportAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e){t.prototype.isCharacterNameUsed=function(t,e){e(null,void 0!==this.database.Characters[t])},t.prototype.createCharacter=function(t,i){if(""===t)return void i(new e.ValidationError("characters-character-name-is-not-specified"));if(this.database.Characters[t])return void i(new e.ValidationError("characters-character-name-already-used",[t]));var n={name:t};this.database.ProfileSettings.forEach(function(t){"enum"===t.type?n[t.name]=t.value.split(",")[0]:n[t.name]=t.value}),this.database.Characters[t]=n,i&&i()},t.prototype.renameCharacter=function(t,i,n){if(""===i)return void n(new e.ValidationError("characters-new-character-name-is-not-specified"));if(t===i)return void n(new e.ValidationError("characters-names-are-the-same"));if(this.database.Characters[i])return void n(new e.ValidationError("characters-character-name-already-used",[i]));var r=this.database.Characters[t];r.name=i,this.database.Characters[i]=r,delete this.database.Characters[t];var o,s,a=function(e){e.characters[t]&&(r=e.characters[t],e.characters[i]=r,delete e.characters[t])};for(o in this.database.Stories)s=this.database.Stories[o],s.characters[t]&&(r=s.characters[t],r.name=i,s.characters[i]=r,delete s.characters[t],s.events.forEach(a));n&&n()},t.prototype.removeCharacter=function(t,e){delete this.database.Characters[t];var i,n,r=function(e){e.characters[t]&&delete e.characters[t]};for(i in this.database.Stories)n=this.database.Stories[i],n.characters[t]&&(delete n.characters[t],n.events.forEach(r));e&&e()},t.prototype.updateProfileField=function(t,i,n,r,o){var s=this.database.Characters[t];switch(n){case"text":case"string":case"enum":s[i]=r;break;case"number":if(isNaN(r))return void o(new e.ValidationError("characters-not-a-number"));s[i]=Number(r);break;case"checkbox":s[i]=r}o&&o()}}t(e)}(function(t){"undefined"==typeof exports?this.charactersAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i){t.prototype.getDatabase=function(t){this.database.Meta.saveTime=(new Date).toString(),t(null,i.clone(this.database))},t.prototype.setDatabase=function(t,i){this.database=e.migrate(t),i&&i()},t.prototype.getMetaInfo=function(t){t(null,i.clone(this.database.Meta))},t.prototype.setMetaInfo=function(t,e,i){this.database.Meta[t]=e,i&&i()},t.prototype.getCharacterNamesArray=function(t){t(null,Object.keys(this.database.Characters).sort(i.charOrdA))},t.prototype.getStoryNamesArray=function(t){t(null,Object.keys(this.database.Stories).sort(i.charOrdA))},t.prototype.getAllProfileSettings=function(t){t(null,i.clone(this.database.ProfileSettings))}}t(e)}(function(t){"undefined"==typeof exports?this.commonAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n,r){t.prototype.getConsistencyCheckResult=function(t){var e=[],i=function(t){e.push(t)};d(this.database,i),h(this.database,i),l(this.database,i),a(this.database,i),this.database.ManagementInfo&&s(this.database,i);var o=r.getSchema(this.database),u=n({allErrors:!0}),c=u.compile(o),f=c(this.database);f||(e=e.concat(c.errors)),t(null,e)};var o=function(t){return e.curry(e.compose(t,i.strFormat))},s=function(t,i){var n=e.values(t.Stories).map(e.prop("name")),r=e.values(t.Characters).map(e.prop("name")),s=o(i);e.values(t.ManagementInfo.UsersInfo).forEach(function(t){var i=e.difference(t.characters,r);0!=i.length&&s("Object rights inconsistent, user character is not exist: user {0}, character {1}",[t.name,i]),i=e.difference(t.stories,n),0!=i.length&&s("Object rights inconsistent, user story is not exist: user {0}, story {1}",[t.name,i])})},a=function(t,i){var n=o(i);e.values(t.Stories).forEach(function(t){var i=e.values(t.characters).map(e.prop("name"));t.events.forEach(function(r,o){var s=e.keys(r.characters),a=e.difference(s,i);0!=a.length&&n("Event characters inconsistent, some character is not exist: story {0}, character {1}",[t.name+":"+o,a])})})},l=function(t,i){var n=e.values(t.Characters).map(e.prop("name")),r=o(i);e.values(t.Stories).forEach(function(t){var i=e.values(t.characters).map(e.prop("name")),o=e.difference(i,n);0!=o.length&&r("Story characters inconsistent, some character is not exist: story {0}, character {1}",[t.name,o]);var s=e.keys(t.characters),a=e.symmetricDifference(i,s);0!=a.length&&r("Story characters inconsistent, inner and outer character name are inconsistent: story {0}, character {1}",[t.name,a])})},h=function(t,i){var n=t.ProfileSettings,r=o(i)("Profile value inconsistency, item type is inconsistent: char {0}, item {1}, value {2}"),s=function(t,i,n){switch(i){case"text":case"string":return!e.is(String,t);case"enum":if(e.is(String,t)){var r=n.split(",").map(e.trim);return!e.contains(t.trim(),r)}return!0;case"number":return!e.is(Number,t);case"checkbox":return!e.is(Boolean,t)}};e.values(t.Characters).forEach(function(t){n.forEach(function(e){s(t[e.name],e.type,e.value)&&r([t.name,e.name,t[e.name]])})})},d=function(t,i){var n=t.ProfileSettings.map(e.prop("name")),r=o(i);e.values(t.Characters).forEach(function(t){var i=e.keys(t).filter(e.compose(e.not,e.equals("name"))),o=e.symmetricDifference(i,n);if(0!=o.length){var s=r(e.__,[t.name,o]);if(i.length!==n.length)return s("Character profile inconsistent, lengths are different: char {0}, difference [{1}]");if(!e.all(e.contains(e.__,n))(i))return s("Character profile inconsistent, item name inconsistency: char {0}, difference [{1}]")}})}}t(e)}(function(t){"undefined"==typeof exports?this.consistencyCheckAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e){t.prototype.getFilteredStoryNames=function(t,r){var o=Object.keys(this.database.Stories).sort(e.charOrdA),s=this;o=o.map(function(t){return{storyName:t,isFinished:n(s.database,t),isEmpty:i(s.database,t)}}),t&&(o=o.filter(function(t){return!t.isFinished||t.isEmpty})),r(null,o)};var i=function(t,e){return 0==t.Stories[e].events.length},n=function(t,e){return t.Stories[e].events.every(function(t){var e=!0;for(var i in t.characters)if(t.characters[i]&&!t.characters[i].ready){e=!1;break}return e})};t.prototype.getFilteredCharacterNames=function(t,i,n){var r;r=this.database.Stories[t].characters,r=Object.keys(r).sort(e.charOrdA);var a=this;r=r.map(function(e){return{characterName:e,isFinished:s(a.database,t,e),isEmpty:o(a.database,t,e)}}),i&&(r=r.filter(function(t){return!t.isFinished||t.isEmpty})),n(null,r)},t.prototype.getFilteredEventNames=function(t,e,i){var n=this.database.Stories[t].events.map(function(t,e){return{name:t.name,index:e,isFinished:r(t),isEmpty:0===Object.keys(t.characters).length}});e&&(n=n.filter(function(t){return!t.isFinished||t.isEmpty})),i(null,n)};var r=function(t){for(var e in t.characters)if(!t.characters[e].ready)return!1;return!0},o=function(t,e,i){return t.Stories[e].events.every(function(t){return!t.characters[i]})},s=function(t,e,i){return t.Stories[e].events.every(function(t){return t.characters[i]?t.characters[i].ready:!0})};t.prototype.getEvents=function(t,i,n){var r,o=e.clone(this.database.Stories[t].events).map(function(t,e){return t.index=e,t}).filter(function(t){for(r=0;r<i.length;r++)if(t.characters[i[r]])return!0;return!1});n(null,o)},t.prototype.setEventAdaptationTime=function(t,e,i,n,r){var o=this.database.Stories[t].events[e];o.characters[i].time=n,r()},t.prototype.setEventText=function(t,e,i,n,r){var o=this.database.Stories[t].events[e];null!=i?o.characters[i].text=n:o.text=n,r()},t.prototype.changeAdaptationReadyStatus=function(t,e,i,n,r){var o=this.database.Stories[t].events[e];o.characters[i].ready=n,r()}}t(e)}(function(t){"undefined"==typeof exports?this.eventsAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.getAllInventoryLists=function(t,e){var i=[];for(var n in this.database.Stories){var r=this.database.Stories[n];r.characters[t]&&r.characters[t].inventory&&""!==r.characters[t].inventory&&i.push({storyName:n,inventory:r.characters[t].inventory})}e(null,i)},t.prototype.getCharacterEventGroupsByStory=function(t,n){var r,o=[],s=this;Object.keys(this.database.Stories).filter(function(e){return s.database.Stories[e].characters[t]}).forEach(function(e){r=[];var n=i.clone(s.database.Stories[e].events);n.map(function(t,i){return t.index=i,t.storyName=e,t.isTimeEmpty=""===t.time,t.time=t.isTimeEmpty?s.database.Meta.date:t.time,t}).filter(function(e){return e.characters[t]}).forEach(function(t){r.push(t)}),o.push({storyName:e,events:r})}),o.sort(i.charOrdAFactory(e.prop("storyName"))),n(null,o)},t.prototype.getCharacterEventsByTime=function(t,e){var n=[],r=this;Object.keys(this.database.Stories).filter(function(e){return r.database.Stories[e].characters[t]}).forEach(function(e){var o=i.clone(r.database.Stories[e].events);n=n.concat(o.map(function(t,i){return t.index=i,t.storyName=e,t.isTimeEmpty=""===t.time,t.time=t.isTimeEmpty?r.database.Meta.date:t.time,t}).filter(function(e){return e.characters[t]}))}),n.sort(i.eventsByTime),e(null,n)},t.prototype.getProfile=function(t,e){e(null,i.clone(this.database.Characters[t]))},t.prototype.getAllProfiles=function(t){t(null,i.clone(this.database.Characters))},t.prototype.getAllStories=function(t){t(null,i.clone(this.database.Stories))},t.prototype.getEventGroupsForStories=function(t,e){var n,r=[],o=this;Object.keys(this.database.Stories).filter(function(e){return-1!==t.indexOf(e)}).forEach(function(t){n=[];var e=i.clone(o.database.Stories[t].events);e.map(function(e,i){return e.index=i,e.storyName=t,e}).forEach(function(t){n.push(t)}),r.push({storyName:t,events:n})}),e(null,r)},t.prototype.setEventTime=function(t,e,i,r){var o=this.database.Stories[t].events[e];o.time=n(i,"yyyy/mm/dd h:MM"),r()}}t(e)}(function(t){"undefined"==typeof exports?this.extrasAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n,r,o){var s={getDatabase:{rewrite:!0},setDatabase:{ignoreParams:!0},setMetaInfo:{filter:function(t){return"description"!==t[0]}},createCharacter:{},renameCharacter:{},removeCharacter:{},createProfileItem:{},renameProfileItem:{},moveProfileItem:{},removeProfileItem:{},updateDefaultValue:{},changeProfileItemType:{},createStory:{},renameStory:{},removeStory:{},addStoryCharacter:{},switchStoryCharacters:{},removeStoryCharacter:{},updateCharacterInventory:{},onChangeCharacterActivity:{},addCharacterToEvent:{},removeCharacterFromEvent:{},createEvent:{},moveEvent:{},cloneEvent:{},mergeEvents:{},removeEvent:{},updateEventProperty:{filter:function(t){return"text"!==t[2]}},changeAdaptationReadyStatus:{},getBriefingData:{}};o&&(s=e.merge(s,o)),Object.keys(t.prototype).filter(e.prop(e.__,s)).forEach(function(e){var i=t.prototype[e];t.prototype[e]=function(){for(var t=[],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var o=!0;if(s[e].filter&&(o=s[e].filter(t)),o){var a="user";n&&(a=arguments[arguments.length-1].name),this.log(a,e,s[e].ignoreParams?[]:t)}return i.apply(this,arguments)}}),"Standalone"===r&&(t.prototype.log=function(t,e,n){var r=[t,(new Date).toString(),e,JSON.stringify(n)];this.database&&(s[e].rewrite&&void 0!=this.database.Log[this.database.Log.length-1]?this.database.Log[this.database.Log.length-1][2]===e&&(this.database.Log[this.database.Log.length-1]=r):(this.database.Log.push(r),this.database.Log.length>2e3&&this.database.Log.splice(0,1e3))),console.log(i.strFormat("{0},{1},{2},{3}",r))}),t.prototype.getLog=function(t,e){for(var i=[],n=100*t;100*(t+1)>n;n++)this.database.Log[n]&&i.push([n+1].concat(this.database.Log[n]));e(null,{requestedLog:i,logSize:Math.ceil(this.database.Log.length/100)})}}t(e)}(function(t){"undefined"==typeof exports?this.logAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.createProfileItem=function(t,e,i,r,o,s){var a=this;this.isProfileItemNameUsed(t,function(l,h){if(l)return void s(l);if(h)return void s(new n.ValidationError("characters-such-name-already-used"));var d={name:t,type:e,value:i,doExport:!0};Object.keys(a.database.Characters).forEach(function(e){a.database.Characters[e][t]=i}),r?a.database.ProfileSettings.push(d):a.database.ProfileSettings.splice(o,0,d),s()})},t.prototype.moveProfileItem=function(t,e,i){e>t&&e--;var n=this.database.ProfileSettings,r=n[t];n.splice(t,1),n.splice(e,0,r),i()},t.prototype.removeProfileItem=function(t,e,n){var r=this;Object.keys(this.database.Characters).forEach(function(t){delete r.database.Characters[t][e]}),i.removeFromArrayByIndex(this.database.ProfileSettings,t),n()},t.prototype.changeProfileItemType=function(t,i,n){var r=this.database.ProfileSettings.filter(function(e){return e.name===t})[0];r.type=i,r.value=e.profileFieldTypes[i].value;var o=this;Object.keys(this.database.Characters).forEach(function(n){o.database.Characters[n][t]=e.profileFieldTypes[i].value}),n()},t.prototype.isProfileItemNameUsed=function(t,e){if(""===t)return void e(new n.ValidationError("characters-profile-item-name-is-not-specified"));if("name"===t)return void e(new n.ValidationError("characters-profile-item-name-cant-be-name"));var i=function(e){return t===e.name};e(null,this.database.ProfileSettings.some(i))},t.prototype.renameProfileItem=function(t,e,i){var r=this;this.isProfileItemNameUsed(t,function(o,s){return o?void i(o):s?void i(new n.ValidationError("characters-such-name-already-used")):(Object.keys(r.database.Characters).forEach(function(i){var n=r.database.Characters[i][e];delete r.database.Characters[i][e],r.database.Characters[i][t]=n}),r.database.ProfileSettings.filter(function(t){return t.name===e})[0].name=t,void i())})},t.prototype.doExportProfileItemChange=function(t,e,i){var n=this.database.ProfileSettings.filter(function(e){return e.name===t})[0];n.doExport=e,i()},t.prototype.updateDefaultValue=function(t,e,i){var r,o,s,a,l=this.database.ProfileSettings.filter(function(e){return e.name===t})[0];switch(l.type){case"text":case"string":case"checkbox":l.value=e;break;case"number":if(isNaN(e))return void i(new n.ValidationError("characters-not-a-number"));l.value=Number(e);break;case"enum":if(""===e)return void i(new n.ValidationError("characters-enum-item-cant-be-empty"));if(r=l.value.split(","),o=e.split(","),o=o.map(function(t){return t.trim()}),s=[{}].concat(o).reduce(function(t,e){return t[e]=!0,t}),a=r.filter(function(t){return!s[t]}),0!==a.length){l.value=o.join(",");var h=this;return void Object.keys(this.database.Characters).forEach(function(e){var i=h.database.Characters[e][t];s[i]||(h.database.Characters[e][t]=o[0])})}l.value=o.join(",")}i()}}t(e)}(function(t){"undefined"==typeof exports?this.profileConfigurerAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i){t.prototype.getStatistics=function(t){var i={};i.storyNumber=Object.keys(this.database.Stories).length,i.characterNumber=Object.keys(this.database.Characters).length,i.eventsNumber=e.sum(e.values(this.database.Stories).map(e.compose(e.length,e.prop("events")))),i.userNumber=1,this.database.ManagementInfo&&this.database.ManagementInfo.UsersInfo&&(i.userNumber=Object.keys(this.database.ManagementInfo.UsersInfo).length),i.textCharacterNumber=u(this.database);var r=c(this.database);i.firstEvent=r[0]?r[0]:"",
i.lastEvent=r[1]?r[1]:"",i.storyEventsHist=f(this.database,function(t){return t.events.length}),i.storyCharactersHist=f(this.database,function(t){return Object.keys(t.characters).length}),i.eventCompletenessHist=s(this.database),i.generalCompleteness=d(this.database),i.storyCompleteness=h(this.database),i.characterChartData=o(this.database,"characters","Characters"),i.storyChartData=o(this.database,"stories","Stories"),i.profileCharts=n(this.database),t(null,i)};var n=function(t){var i=t.ProfileSettings.filter(function(t){return"string"!==t.type&&"text"!==t.type}).map(e.pick(["name","type"])),n=e.groupBy(e.__,e.values(t.Characters)),r=function(t){return e.fromPairs(e.toPairs(t).map(function(t){return t[1]=t[1].length,t}))},o=i.map(function(i){if("enum"===i.type||"checkbox"===i.type)return r(n(e.prop(i.name)));var o=e.ap([e.prop(i.name)],e.values(t.Characters)),s=o.reduce(function(t,e){return e>t?e:t},o[0]),a=o.reduce(function(t,e){return t>e?e:t},o[0]),l=Math.ceil((s-a)/20);l=0===l?1:l;for(var h=1;l>10*h;)h=10*h;for(var d=[1,2,5,10,12],u=0;u<d.length-1;u++)if(h*d[u]<l&&l<h*d[u+1]){l=h*d[u];break}return{groups:r(n(function(t){return Math.floor(t[i.name]/l)})),step:l}});return e.transpose([i,o]).map(function(t){return e.assoc("data",t[1],t[0])})},r=function(t,e,i){return[t,": ",(e/i*100).toFixed(0),"% (",e,"/",i,")"].join("")},o=function(t,e,i){var n=[],o=Object.keys(t[i]).length,s=0;if(t.ManagementInfo&&t.ManagementInfo.UsersInfo){var a,l;for(var h in t.ManagementInfo.UsersInfo)a=t.ManagementInfo.UsersInfo[h],l=a[e].length,n.push({value:l,label:r(h,l,o)}),s+=l;s!==o&&n.push({value:o-s,label:r("unknown",o-s,o)})}else n.push({value:o,label:r("user",o,o)});return n},s=function(t){var e,i,n=[];for(var r in t.Stories){e=t.Stories[r],i=l(e);var o=Math.floor(10*i);n[o]?(n[o].value++,n[o].tip=n[o].tip+", "+e.name+" ("+(100*i).toFixed(0)+"%)"):n[o]={value:1,label:o,tip:e.name+" ("+(100*i).toFixed(0)+"%)"}}for(var s=0;11>s;s++)n[s]||(n[s]=null);return n},a=function(t){var e=0,i=0;return t.events.forEach(function(t){i+=Object.keys(t.characters).length;for(var n in t.characters)t.characters[n].ready&&e++}),{finishedAdaptations:e,allAdaptations:i}},l=function(t){var e=a(t);return 0!==e.allAdaptations?e.finishedAdaptations/e.allAdaptations:0},h=function(t){var i=0,n=Object.keys(t.Stories).length;return e.values(t.Stories).map(a).forEach(function(t){t.allAdaptations===t.finishedAdaptations&&0!=t.allAdaptations&&i++}),[(i/(0===n?1:n)*100).toFixed(1),i,n]},d=function(t){var i=0,n=0;return e.values(t.Stories).map(a).forEach(function(t){i+=t.finishedAdaptations,n+=t.allAdaptations}),[(i/(0===n?1:n)*100).toFixed(1),i,n]},u=function(t){var e,i,n,r=function(t){return t.replace(/\s/g,"").length},o=0;for(n in t.Stories)e=t.Stories[n],o+=r(e.story),e.events.forEach(function(t){o+=r(t.text);for(i in t.characters)o+=r(t.characters[i].text)});return o},c=function(t){var e,i,n=null,r=null;for(var o in t.Stories)e=t.Stories[o],e.events.forEach(function(t){""!=t.time&&(i=new Date(t.time),(null===n||i>n)&&(n=i),(null===r||r>i)&&(r=i))});return[r,n]},f=function(t,e){var i,n=[];for(var r in t.Stories){i=t.Stories[r];var o=e(i);n[o]?(n[o].value++,n[o].tip=n[o].tip+", "+i.name):n[o]={value:1,label:o,tip:o+": "+i.name}}for(var s=0;s<n.length;s++)n[s]||(n[s]=null);return n}}t(e)}(function(t){"undefined"==typeof exports?this.statisticsAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i){t.prototype.getMasterStory=function(t,e){e(null,this.database.Stories[t].story)},t.prototype.updateMasterStory=function(t,e,i){this.database.Stories[t].story=e,i()},t.prototype.isStoryExist=function(t,e){e(null,void 0!==this.database.Stories[t])},t.prototype.createStory=function(t,e){return""===t?void e(new i.ValidationError("stories-story-name-is-not-specified")):this.database.Stories[t]?void e(new i.ValidationError("stories-story-name-already-used",[t])):(this.database.Stories[t]={name:t,story:"",characters:{},events:[]},void e())},t.prototype.renameStory=function(t,e,n){if(""===e)return void n(new i.ValidationError("stories-story-name-is-not-specified"));if(t===e)return void n(new i.ValidationError("stories-names-are-the-same"));if(this.database.Stories[e])return void n(new i.ValidationError("stories-story-name-already-used",[e]));var r=this.database.Stories[t];r.name=e,this.database.Stories[e]=r,delete this.database.Stories[t],n()},t.prototype.removeStory=function(t,e){delete this.database.Stories[t],e()},t.prototype.addCharacterToEvent=function(t,e,i,n){this.database.Stories[t].events[e].characters[i]={text:"",time:""},n()},t.prototype.removeCharacterFromEvent=function(t,e,i,n){delete this.database.Stories[t].events[e].characters[i],n()},t.prototype.getStoryCharacterNamesArray=function(t,i){var n;n=this.database.Stories[t].characters,i(null,Object.keys(n).sort(e.charOrdA))},t.prototype.getStoryEvents=function(t,i){i(null,e.clone(this.database.Stories[t].events))},t.prototype.getStoryCharacters=function(t,i){i(null,e.clone(this.database.Stories[t].characters))},t.prototype.addStoryCharacter=function(t,e,n){return""===e?void n(new i.ValidationError("stories-character-name-is-not-specified")):(this.database.Stories[t].characters[e]={name:e,inventory:"",activity:{}},void n())},t.prototype.switchStoryCharacters=function(t,e,n,r){if(""===e||""===n)return void r(new i.ValidationError("stories-one-of-switch-characters-is-not-specified"));var o=this.database.Stories[t];o.characters[n]=o.characters[e],o.characters[n].name=n,delete o.characters[e],o.events.forEach(function(t){t.characters[e]&&(t.characters[e].name=n,t.characters[n]=t.characters[e],delete t.characters[e])}),r()},t.prototype.removeStoryCharacter=function(t,e,n){if(""===e)return void n(new i.ValidationError("stories-character-name-is-not-specified"));var r=this.database.Stories[t];delete r.characters[e],r.events.forEach(function(t){delete t.characters[e]}),n()},t.prototype.updateCharacterInventory=function(t,e,i,n){this.database.Stories[t].characters[e].inventory=i,n()},t.prototype.onChangeCharacterActivity=function(t,e,i,n,r){var o=this.database.Stories[t].characters[e];n?o.activity[i]=!0:delete o.activity[i],r()},t.prototype.createEvent=function(t,e,n,r,o,s){if(""===e)return void s(new i.ValidationError("stories-event-name-is-not-specified"));if(""===n)return void s(new i.ValidationError("stories-event-text-is-empty"));var a={name:e,text:n,time:"",characters:{}};r?this.database.Stories[t].events.push(a):this.database.Stories[t].events.splice(o,0,a),s()},t.prototype.moveEvent=function(t,e,i,n){i>e&&i--;var r=this.database.Stories[t].events,o=r[e];r.splice(e,1),r.splice(i,0,o),n()},t.prototype.cloneEvent=function(t,i,n){var r=this.database.Stories[t],o=r.events[i],s=e.clone(o);r.events.splice(i,0,s),n()},t.prototype.mergeEvents=function(t,n,r){var o=this.database.Stories[t];if(o.events.length===n+1)return void r(new i.ValidationError("stories-cant-merge-last-event"));var s=o.events[n],a=o.events[n+1];s.name+=a.name,s.text+=a.text;for(var l in a.characters)s.characters[l]?(s.characters[l].text+=a.characters[l].text,s.characters[l].time+=a.characters[l].time,s.characters[l].ready=!1):s.characters[l]=a.characters[l];e.removeFromArrayByIndex(o.events,n+1),r()},t.prototype.removeEvent=function(t,i,n){var r=this.database.Stories[t];e.removeFromArrayByIndex(r.events,i),n()},t.prototype.updateEventProperty=function(t,e,n,r,o){if("name"===n&&""===r.trim())return void o(new i.ValidationError("stories-event-name-is-not-specified"));if("text"===n&&""===r.trim())return void o(new i.ValidationError("stories-event-text-is-empty"));this.database.Stories[t].events[e][n]=r;o()}}t(e)}(function(t){"undefined"==typeof exports?this.storiesAPI=t:module.exports=t}.bind(this));