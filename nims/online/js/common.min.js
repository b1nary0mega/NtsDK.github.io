"use strict";!function(t){t.data={Meta:{name:"Властелин колец",date:"3019/02/27 00:00",preGameDate:"3018/01/01 00:00",description:"События фильма, как основа для ролевой игры. В этой базе изложен первый фильм из трилогии Властелин колец. Хронология событий взята из книги.",saveTime:"Tue Jul 19 2016 02:27:38 GMT+0500 (Pakistan Standard Time)"},Characters:{"Фродо":{name:"Фродо","Пол":"М","Раса":"хоббит","Биография":"Хоббит, волею судеб ставший хранителем Единого Кольца, принадлежащего Тёмному Властелину. ","Оружие":"каштаны","Вес, кг.":64,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Сэм":{name:"Сэм","Пол":"М","Раса":"хоббит","Биография":"Садовник, слуга и верный товарищ Фродо.","Оружие":"каштаны","Вес, кг.":57,"Умеет петь":!0,"Снаряжение":"Кастрюли","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Мерри":{name:"Мерри","Пол":"М","Раса":"хоббит","Биография":"Друг Фродо, взятый в поход за компанию.","Оружие":"каштаны","Вес, кг.":57,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Гендальф":{name:"Гендальф","Пол":"М","Раса":"майар","Биография":"Могущественный волшебник.","Оружие":"посох, магия","Вес, кг.":82,"Умеет петь":!1,"Снаряжение":"кольцо Нарья","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Арагорн":{name:"Арагорн","Пол":"М","Раса":"человек","Биография":"Последний вождь следопытов и первый король Воссоединённого Королевства, прямой потомок северной ветви королевского рода Элендила (по линии Исилдура, её старшей ветви — династии Эмлайта Артэдайнского).\nАрагорн стал величайшим из Людей своей эпохи, возглавлял Людей Запада в войне против сил Саурона, помог уничтожить Кольцо Всевластия (был одним из Девяти его Хранителей), воссоединил королевства Арнора и Гондора. ","Оружие":"меч, лук, нож","Вес, кг.":80,"Умеет петь":!0,"Снаряжение":"","Игрок":"Василий","Статус":"Занята","Картинка ВК":"photo-17502880_426145599","Картинка сайт":"Арагорн"},"Леголас":{name:"Леголас","Пол":"М","Раса":"эльф","Биография":"Сын Трандуила, короля эльфов Северного Лихолесья.","Оружие":"лук, эльфийские ножи","Вес, кг.":57,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Гимли":{name:"Гимли","Пол":"М","Раса":"гном","Биография":"Представитель одного из свободных народов Средиземья (гномов), объединившихся для борьбы со Злом. ","Оружие":"топор","Вес, кг.":80,"Умеет петь":!1,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Саурон":{name:"Саурон","Пол":"М","Раса":"другое","Биография":"Низший дух из свиты Вала Аулэ. Саурон был одним из первых Майар, которые приняли сторону Мелькора, став одним из самых лояльных и самых ужасных его сподвижников, но после Войны Гнева и поражения своего господина Саурон возвысился до величайшего врага Свободных народов Средиземья на протяжении Второй и Третьей эпох.","Оружие":"","Вес, кг.":1,"Умеет петь":!1,"Снаряжение":"палантир","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Саруман":{name:"Саруман","Пол":"М","Раса":"майар","Биография":"Могущественнейший маг Ордена Истари, глава Белого совета. ","Оружие":"посох, магия","Вес, кг.":68,"Умеет петь":!1,"Снаряжение":"палантир","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Боромир":{name:"Боромир","Пол":"М","Раса":"человек","Биография":"Старший сын и наследник наместника Гондора Дэнетора II и его жены Финдуилас, брат Фарамира.","Оружие":"меч, лук","Вес, кг.":90,"Умеет петь":!1,"Снаряжение":"Рог Гондора","Игрок":"Петр","Статус":"Занята","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Элронд":{name:"Элронд","Пол":"М","Раса":"эльф","Биография":"Сын полуэльфа Эарендила (в свою очередь, сына эльфийки Идриль и человека Туора) и полуэльфийки Эльвинг (дочери Диора, полуэльфа, и эльфийки Нимлот), брат Элроса, муж Келебриан — дочери Галадриэли и Келеборна, отец Арвен, Элладана и Элрохира. ","Оружие":"","Вес, кг.":72,"Умеет петь":!1,"Снаряжение":"кольцо Вилью","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Арвен":{name:"Арвен","Пол":"Ж","Раса":"эльф","Биография":"Дочь Элронда, внучка Галадриэль.","Оружие":"","Вес, кг.":55,"Умеет петь":!0,"Снаряжение":"","Игрок":"Ирина","Статус":"Занята","Картинка ВК":"photo-17502880_426145598","Картинка сайт":"Арвен"},"Галадриэль":{name:"Галадриэль","Пол":"Ж","Раса":"эльф","Биография":"Могущественнейшая из эльфийских владык, оставшихся в Средиземье после Войны Гнева. Владычица Лориэна.","Оружие":"","Вес, кг.":53,"Умеет петь":!1,"Снаряжение":"кольцо Нэнью","Игрок":"Анна","Статус":"Занята","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Голлум":{name:"Голлум","Пол":"М","Раса":"другое","Биография":"Существо небольшого роста, крайне тощее и с большими светящимися глазами. Упоминается, что в прошлом он жил на поверхности. Голлум ранее был хоббитом, но он не любил солнце и стремился в самую глубь.","Оружие":"","Вес, кг.":34,"Умеет петь":!1,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Бильбо":{name:"Бильбо","Пол":"М","Раса":"хоббит","Биография":"Дядя Фродо Бэггинса.","Оружие":"меч, каштаны","Вес, кг.":73,"Умеет петь":!1,"Снаряжение":"","Игрок":"Михаил","Статус":"На обсуждении","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Назгул":{name:"Назгул","Пол":"М","Раса":"другое","Биография":"Девять владык из расы людей, порабощённых Кольцом Всевластия и ставших слугами Саурона.","Оружие":"","Вес, кг.":0,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"},"Пиппин":{name:"Пиппин","Пол":"М","Раса":"хоббит","Биография":"Друг Фродо, взятый в поход за компанию.","Оружие":"каштаны","Вес, кг.":53,"Умеет петь":!0,"Снаряжение":"","Игрок":"","Статус":"Свободна","Картинка ВК":"photo-17502880_426145597","Картинка сайт":"Вопрос"}},ProfileSettings:[{name:"Игрок",type:"string",value:"",doExport:!0},{name:"Статус",type:"enum",value:"Свободна,Занята,На обсуждении",doExport:!0},{name:"Раса",type:"enum",value:"человек,эльф,гном,орк,хоббит,майар,другое",doExport:!0},{name:"Пол",type:"enum",value:"не важно,М,Ж",doExport:!0},{name:"Оружие",type:"string",value:"",doExport:!0},{name:"Снаряжение",type:"string",value:"",doExport:!0},{name:"Вес, кг.",type:"number",value:0,doExport:!0},{name:"Умеет петь",type:"checkbox",value:!1,doExport:!1},{name:"Биография",type:"text",value:"",doExport:!0},{name:"Картинка ВК",type:"string",value:"photo-17502880_426145597",doExport:!0},{name:"Картинка сайт",type:"string",value:"",doExport:!0}],Stories:{"Начало пути":{name:"Начало пути",story:"Гендальф активно узнает информацию о кольце.\nГендальф отправляет Фродо в Бри. Фродо бежит от черных всадников (защита).\nВ спутники к Фродо набиваются Сэм, Мерри и Пиппин.\nСаруман активно пленяет Гендальфа. Гендальф активно сбегает.\nАрагорн пассивно ждет хоббитов в Гарцующем пони. Потом он их защищает от назгулов.\nНазгулы активно преследуют Фродо и компанию.\nСаурон пассивно ждет когда Фродо оденет кольцо и таким образом укажет на себя.\nАрвен активно спасает Фродо от назгулов. Элронд пассивно ждет Фродо, чтобы его вылечить.\n\nВ свой очередной день рождения Бильбо устраивает праздник, и таинственно исчезает, оставляя все свои вещи племяннику Фродо. В том числе неизвестное кольцо.\n\nГендальф чувствует черную магию в кольце и отправляется в Минас-Тирит, для получения большей информации.\n\nСаурон узнает от Голлума у кого сейчас находится кольцо и отправляет за ним назгулов.\n\nГендальф возвращается в Шир, чтобы предупредить Фродо об опасности, древние зло пробудилось и за Фродо отправлены черные всадники. Гендальф проверяет кольцо и оно оказывается тем самым кольцом. Гендальф отправляет Фродо в Бри в таверну Гарцующий пони. Этот разговор услышал Сэм и за это его добавили к пати.\n\nГендальф отправляется к Саруману, чтобы выработать план действий, но Саруман уже на темной стороне.\n\nПо пути из Шира Фродо и Сэм встречают Мерри и Пипина, ворующих овощи. Внезапно появляются назгулы, и Мерри с Пиппином присоединяются к пати.\n\nПартия приходит в Бри, и останавливается в Гарцующем пони. Гендальфа там нет. Фродо случайно одевает кольцо, под действием кольца. Это видит Бродяжник. Бродяжник объясняет, что он друг и отводит хоббитов в другой ночлег.\n\nНочью назгулы приходят в гарцующий пони и разносят комнату хоббитов, которых там нет.\n\nНазгулы настигают хоббитов в развалинах Амон Сул. Один из них ранит Фродо. Бродяжник прогоняет назгулов. Появляется Арвен, везет Фродо в Ривенделл, спасаясь от назгулов.\n\nАрвен привозит Фродо в Ривенделл. Назгулы не могут перейти реку на границе Ривенделла.\n\nФродо исцеляют, он встречается с Бильбо, получает у него еще часть наследства - меч и кольчугу и собирается идти домой, считая свою миссию выполненной.",characters:{"Арагорн":{name:"Арагорн",inventory:"",activity:{passive:!0,follower:!0}},"Арвен":{name:"Арвен",inventory:"",activity:{active:!0}},"Бильбо":{name:"Бильбо",inventory:"",activity:{passive:!0}},"Гендальф":{name:"Гендальф",inventory:"",activity:{active:!0}},"Мерри":{name:"Мерри",inventory:"",activity:{follower:!0}},"Фродо":{name:"Фродо",inventory:"кольцо, жало, мифриловая кольчуга",activity:{defensive:!0}},"Сэм":{name:"Сэм",inventory:"",activity:{follower:!0}},"Назгул":{name:"Назгул",inventory:"",activity:{active:!0}},"Саурон":{name:"Саурон",inventory:"",activity:{passive:!0}},"Саруман":{name:"Саруман",inventory:"",activity:{active:!0}},"Элронд":{name:"Элронд",inventory:"",activity:{passive:!0}},"Пиппин":{name:"Пиппин",inventory:"",activity:{follower:!0}}},events:[{name:"День рождения Бильбо",text:"В свой очередной день рождения Бильбо устраивает праздник, и таинственно исчезает, оставляя все свои вещи племяннику Фродо. В том числе неизвестное кольцо.",time:"3001/09/22 21:00",characters:{"Гендальф":{text:"Я всегда знал, что Бильбо не обычный хоббит. Хотя конечно его последняя выходка с исчезновением во время праздника мне не понраву, все же у него хватило духа и сил перебраться к эльфам.",time:"22 сентября 3001",ready:!0},"Мерри":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире, а Торба-на-Круче досталась Фродо.",time:"22 сентября 3001",ready:!0},"Сэм":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире, а Торба-на-Круче досталась Фродо.",time:"22 сентября 3001",ready:!0},"Фродо":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире. Он оставил все свое имущество мне, включая странное кольцо с которым он никогда не расставался.",time:"22 сентября 3001",ready:!0},"Бильбо":{text:"Что ж, я прожил долгую жизнь и мне кажется, что мой век подходит к концу. Поэтому я отправляюсь к эльфам после своего очередного дня рождения. Правда, с изчезновением в конце праздничной речи как-то неловко получилось, кольцо прямо само прыгнула на палец. ",time:"22 сентября 3001",ready:!0},"Пиппин":{text:"Старик Бильбо закатил отличный праздник поводу своего 111 летия. А потом просто исчез на глазах у всех прямо со сцены. Никто ничего не понял, но больше никто не видел Бильбо в Шире, а Торба-на-Круче досталась Фродо.",time:"22 сентября 3001",ready:!0}}},{name:"Подозрения Гендальфа",text:"Гендальф чувствует черную магию в кольце и отправляется в Минас-Тирит, для получения большей информации.",time:"3001/09/23 12:00",characters:{"Гендальф":{text:"Меня очень беспокоит кольцо Билььо. Вещь содержащая сильную магию, к тому же он так к нему привязался. С трудом я уговорил его оставить кольцо Фродо. Надо попытаться узнать что же это за кольцо.",time:"23 сентября 3001",ready:!0},"Фродо":{text:"Обычно я носил кольцо, доставшееся мне от Бильбо при себе, но надеквал его крайне редко . Вообще жизни пошла обычным чередом, Гэндальф куда-то исчез.",time:"23 сентября 3001",ready:!0},"Бильбо":{text:"Сколько раз я себе говорил - не слушай Гендальфа, старику в очередной раз удалось меня уговорить, поэтому я оставил свое прелестное кольцо Фродо. Эх, как оно без меня?",time:"23 сентября 3001",ready:!0}}},{name:"Назгулы",text:"Саурон узнает от Голлума у кого сейчас находится кольцо и отправляет за ним назгулов.",time:"3018/03/02 15:00",characters:{"Саурон":{text:"От этой твари я узнал нынешнего владельца кольца, это какой-то хоббит из Шира и отправил за ним назгулов. Кстати, кто такие эти хоббиты?",time:"2 марта 3018",ready:!0},"Назгул":{text:"Повелитель отправил нас в Шир. Мы должны разыскать владельца кольца и забрать его.",time:"2 марта 3018",ready:!0}}},{name:"Начало пути Фродо",text:"Гендальф возвращается в Шир, чтобы предупредить Фродо об опасности, древние зло пробудилось и за Фродо отправлены черные всадники. Гендальф проверяет кольцо и оно оказывается тем самым кольцом. Гендальф отправляет Фродо в Бри в таверну Гарцующий пони. Этот разговор услышал Сэм и за это его добавили к пати.",time:"3018/04/13 20:00",characters:{"Фродо":{text:"Вернувшись домой я встретил взволнованного Гендальфа. Он попросил меня достать кольцо Бильбо и бросить его в огонь. К моему удивлению, вынутое из огня кольцо оказалось холодным и на его поверхности проступили странные письмена. Гендальф сказал, что только одно кольцо реагирует так на огонь - кольцо Саурона. Как оказалось Саурон не умер, вновь набирает силу и ищет это кольцо. За мной отправлены черные всадники и мне надо бежать. Наш разговор подслушал Сэм и Гендальф отправил его со мной. Мы идём в Бри, он должен нас встретить там.",time:"4 апреля 3018",ready:!0},"Сэм":{text:"Поздним вечером я подстригал кусты у открытого окна и вдруг услышал разговор хозяина и Гендальфа. Голос Гендальфа был очень напряжен и я не удержался и решить узнать о чем они говорят. Я понял, что кольцо Бильбо действительно существует и что это очень необычное кольцо и что его ищет сам Саурон, который оказывается не умер. Я так заслушался, что забыл о стрижке, а Гендальф заметил, что ножницы не звенят. Он поймал меня, я сознался, что все слышал и он отправил меня вместе с Фродо в Бри.",time:"4 апреля 3018",ready:!0},"Гендальф":{text:"В Минас-Тирит я узнал, что это может быть то самое кольцо Саурона. Обеспокоенный я вернулся в Шир, как бы мне хотелось, чтобы это не было правдой, но Фродо при мне проверил кольцо, бросив его в огонь и на нем проступили письмена. Я слышал о черных всадниках, движущихся в сторону Шира. Я отправил Фродо в Бри, надеюсь я успею вернуться к тому моменту, когда он будет там. Мне срочно надо посоветоваться с Саруманом. Наш разговор подслушал Сэм, а мне ни в коем случае не хотелось отпускать Фродо одного. Что-то должно напоминать Фродо о доме и потмогать  противостоять власти кольца, так что Сэм попал под раздачу. Уверен, он справится.",time:"4 апреля 3018",ready:!0}}},{name:"Гендальфа пленит Саруман",text:"Гендальф отправляется к Саруману, чтобы выработать план действий, но Саруман уже на темной стороне.",time:"3018/07/10 16:00",characters:{"Гендальф":{text:"Я прибыл к Саруману, чтобы обсудить что мы можем предпринять. Но как оказалось, Саруман перешёл на сторону Саурона. Он пленил меня и запер на крыше Ортханка. Чудом меня спас орёл. В назначенное время в Бри я уже не попаду.",time:"10 июля 3018",ready:!0},"Саруман":{text:"Я узрел вечную тьму в палантире и понял, что это мой путь. Визит Гендальфа не был неожиданностью. Повелитель тьмы велел заставить Гендальфа прикмнуть к нам, но он смог сбежать. Тем хуже для него.",time:"10 июля 3018",ready:!0}}},{name:"Мерри и Пипин",text:"По пути из Шира Фродо и Сэм встречают Мерри и Пипина, ворующих овощи. Внезапно появляются назгулы, и Мерри с Пиппином присоединяются к пати.",time:"3018/04/17 13:00",characters:{"Сэм":{text:"Пиппин и Мерри как всегда убегали от разозленного фермера по полю, когда случайно наткнулись на нас. Нам пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Фродо рассказал, что всадников несколько и они преследуют его и что ему позарез нужно в Бри. Мерри и Пиппин присоединились к нам.",time:"17 апреля 3018",ready:!0},"Фродо":{text:"Пиппин и Мерри убегали от разозленного фермера по полю, когда случайно наткнулись на нас. Нам пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Я рассказал, что всадников несколько и они преследуют меня и что мы идем в Бри. Мерри и Пиппин присоединились к нам.",time:"17 апреля 3018",ready:!0},"Мерри":{text:"Я и Пиппин убегали от разозленного фермера по полю, когда случайно наткнулись на Сэма и Фродо. Им пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера, мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Фродо рассказал, что всадников несколько и они преследуют его и что ему позарез нужно в Бри. Мы пошли с Фродо и Сэмом.",time:"17 апреля 3018",ready:!0},"Пиппин":{text:"Я и Мерри убегали от разозленного фермера по полю, когда случайно наткнулись на Сэма и Фродо. Им пришлось бежать вместе с нами, не думаю что фермер стал бы разбираться кто был не виноват. Убежав от фермера мы вышли на дорогу и вдруг почуствовали холод. Мы спрятались и в этот момент на дороге показался черный всадник. Фродо рассказал, что всадников несколько и они преследуют его и что ему позарез нужно в Бри. Мы пошли с Фродо и Сэмом.",time:"17 апреля 3018",ready:!0}}},{name:"Гарцующий пони",text:"Партия приходит в Бри, и останавливается в Гарцующем пони. Гендальфа там нет. Фродо случайно надевает кольцо, под действием кольца. Это видит Бродяжник. Бродяжник объясняет, что он друг и отводит хоббитов в другой ночлег.",time:"3018/09/30 20:00",characters:{"Арагорн":{text:"В Бри пришла стайка хоббитов. Какие же они все таки нелепые. Я знал, что они должны прийти, но решил выждать. Жаль что я не подошел сразу - Фродо одел кольцо прямо посреди зала. Теперь Саурон, а значит и назгулы точно знают где их искать. \nТак или иначе я представился и увел их на другой ночлег. Можно не сомневаться назгулы придут сегодня ночью.",time:"30 сентября 3018",ready:!0},"Мерри":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг Фродо стало плохо и он исчез точно так же как Бильбо на своем дне рождения. Мы не поняли что произошло, мы искали Фродо и не могли найти. Вдруг мы увидели как человек утаскивает Фродо. Мы пошли за ним, собирались драться. Оказалось, что это Бродяжник, друг Гендальфа, который будет охранять нас. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел нас на другой ночлег.",time:"30 сентября 3018",ready:!0},"Сэм":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг Фродо стало плохо и он исчез точно так же как Бильбо на своем дне рождения. Мы не поняли что произошло, мы искали Фродо и не могли найти. Вдруг мы увидели как человек утаскивает Фродо. Мы пошли за ним, собирались драться. Оказалось, что это Бродяжник, друг Гендальфа, который будет охранять нас. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел нас на другой ночлег.",time:"30 сентября 3018",ready:!0},"Фродо":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг я почуствовал непреодолимое желание одеть кольцо и сделал это. Мир потерял краски, вместо людей были только силуэты и среди всего на меня смотрело огромное огненное око. В ужасе я снял кольцо. Никто на меня не смотрел, поэтому я подумал, что все хорошо, но неожиданное меня схватил человек и утащил в одну из внтуренних комнат. Это оказался Бродяжник, друг Гендальфа, встретивший нас. Он был очень зол на меня, за то что я одел кольцо - у Саурона везде глаза и уши. Мои друзья попытались спасти меня от Бродяжника, но я объяснил им, что он друг. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел на другой ночлег.",time:"30 сентября 3018",ready:!0},"Пиппин":{text:"Мы пришли в Бри в Гарцующий пони. Гендальфа не было. Мы не знали что делать и решили остаться на ночлег. Вдруг Фродо стало плохо и он исчез точно так же как Бильбо на своем дне рождения. Мы не поняли что произошло, мы искали Фродо и не могли найти. Вдруг мы увидели как человек утаскивает Фродо. Мы пошли за ним, собирались драться. Оказалось, что это Бродяжник, друг Гендальфа, который будет охранять нас. Бродяжник сказал, что в Гарцующем пони останавливаться опасно и отвел нас на другой ночлег.",time:"30 сентября 3018",ready:!0}}},{name:"Ночное нападение",text:"Ночью назгулы приходят в гарцующий пони и разносят комнату хоббитов, которых там нет.",time:"3018/09/31 04:00",characters:{"Арагорн":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Что ж, в этот раз назгулы ошиблись. Нужно уходить из Бри.",time:"1 октября 3018",ready:!0},"Мерри":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но я должен идти с Фродо, ему угрожает большая опасность.",time:"1 октября 3018",ready:!0},"Сэм":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но я должен идти с Фродо, ему угрожает большая опасность.",time:"1 октября 3018",ready:!0},"Фродо":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но мы должны идти, кольцо - моя ноша, никто другой с этим не справится.",time:"1 октября 3018",ready:!0},"Назгул":{text:"Ночью мы пришли в таверну где были те, кто нам нужен. Их не было в комнате. Мы бы с радостью вырезали весь город, но где-то здесь скрывается Бродяжник и только он может нам помешать. Время есть, мы подождем, когда хоббит снова оденет кольцо и выдаст себя.",time:"1 октября 3018",ready:!0},"Пиппин":{text:"Ночью из Гарцующего пони доносились странные звуки и вопли, как в последствии оказалось комната хоббитов была вверхдном, а кровати проткнуты мечами. Мне страшно, но я должен идти с Фродо, ему угрожает большая опасность.",time:"1 октября 3018",ready:!0}}},{name:"Амон Сул",text:"Назгулы настигают хоббитов в развалинах Амон Сул. Один из них ранит Фродо. Бродяжник прогоняет назгулов. Появляется Арвен, везет Фродо в Ривенделл, спасаясь от назгулов.",time:"3018/10/04 03:30",characters:{"Арагорн":{text:"Я отправился в дозор и очень зря. Назгулы прокрались мимо меня. С трудом я успел их прогнать, но они ранили Фродо. Я смогу его спасти. Неожиданно появилась Арвен. Она забрала у меня Фродо. Надеюсь черные всадники не смогут догнать их на пути в Ривендел.",time:"4 октября 3018",ready:!0},"Арвен":{text:"Я почуствовала холод и боль в далеке и примчалась в это место. Бродяжник только отбил нападение назгулов, а хранитель кольца был ранен. Вся надежда на моего коня. Успеть бы доскакать",time:"4 октября 3018",ready:!0},"Мерри":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили Фродо и наконец вернулся Бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать рану Фродо, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала Фродо с собой. Надеюсь, что с Фродо все будет хорошо.",time:"4 октября 3018",ready:!0},"Сэм":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили Фродо и наконец вернулся бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать рану Фродо, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала Фродо с собой. Надеюсь, что с Фродо все будет хорошо.",time:"4 октября 3018",ready:!0},"Фродо":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили меня и наконец вернулся бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать мою рану, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала меня с собой. ",time:"4 октября 3018",ready:!0},"Назгул":{text:"Мы окружили хоббитов, мы чувствовали силу кольца, и тут пришел Бродяжник. Он отбил наше нападение. Мы успели ранить хранителя, он долго не продержится. И тут появилась эта эльфийка...",time:"4 октября 3018",ready:!0},"Пиппин":{text:"Бродяжник ушёл в дозор. Неожиданно нас окружили назгулы. Мы пытались драться, но они просто раскидали нас. Они ранили Фродо и наконец вернулся бродяжник. Бродяжник отбил нападение. Он попытался как-то обработать рану Фродо, как вдруг появилась эльфийка. Значит недалеко Ривендел. Она забрала Фродо с собой. Надеюсь, что с Фродо все будет хорошо.",time:"4 октября 3018",ready:!0}}},{name:"Ривенделл",text:"Арвен привозит Фродо в Ривенделл. Назгулы не могут перейти реку на границе Ривенделла.",time:"3018/10/20 15:00",characters:{"Арагорн":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится и мы сможем собрать совет кольца.",time:"20 октября 3018",ready:!0},"Бильбо":{text:"Я узнал, что мой племенник и несколько его друзей пришли в Ривендел. Смелые. Надеюсь он навестит меня. Возможно, что ему предстоит дальняя дорога, и пара предметов, которые я взял с собой... Больше мне не пригодяться, я уже дошел до Ривендела. Как же здесь все-таки красиво.",time:"20 октября 3018",ready:!0},"Мерри":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится.",time:"20 октября 3018",ready:!0},"Сэм":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится.",time:"20 октября 3018",ready:!0},"Фродо":{text:"Я не помню как мы оказались в Ривенделе. Но в себя я пришел уже там. Все мои спутники уже были здесь.",time:"20 октября 3018",ready:!0},"Элронд":{text:"Арвен успела спасти Фродо, я залечу его рану, но на это уйдет время. Черные всадники не могут пройти в Ривендел и мы в этом убедились. Что ж, скоро мы соберем совет и решим что делать с этим кольцом.",time:"20 октября 3018",ready:!0},"Арвен":{text:"Я забрала Фродо с собой и мы с большим трудом успели перейти реку на границе Ривендела. Черные всадники осмелились вступить в воду и река смела их. В ближайшее время они не побеспокоят Фродо. Отец вылечил Фродо, но раны нанесенные призрачным клинком не могут быть вылечены полностью никогда.",time:"20 октября 3018",ready:!0},"Гендальф":{text:"Арвен успела спасти Фродо, Элронд залечит его рану, но на это уйдет время. Черные всадники не могут пройти в Ривендел и мы в этом убедились. Жаль, что Саруман выступил против нас. Теперь Ортханк оплот орков и кто знает, на что способен Саруман в черной магии. Что ж, скоро мы соберем совет и решим что делать с этим кольцом.",time:"20 октября 3018",ready:!0},"Пиппин":{text:"Мы отправились вслед за Фродо и Арвен в Ривендел так быстро как могли. К счастью они успели, а тела лошадей черных всадников были найдены ниже по течению. Какое-то время они нас не побеспокоят. Нам дали кров. Здесь же был Гендальф. Элронд вылечит Фродо, а пока будем ждать когда Фродо поправится.",time:"20 октября 3018",ready:!0},"Назгул":{text:"Эльфийка везла Фродо в Ривендел и преуспела. Мы не смогли пересечь его границу, древняя магия все ещё сильна. Тёмный властелин велел возвращаться в Мордор. Там мы узнаем, что нам делать дальше.",time:"20 октября 3018",ready:!0}}},{name:"Кольцо в Ривенделле",text:"Фродо исцеляют, он встречается с Бильбо, получает у него еще часть наследства - меч и кольчугу.",time:"3018/12/24 16:00",characters:{"Фродо":{text:"Я посетил Бильбо в Ривенделе. Он как-то постарел за это небольшое время. Бильбо передал мне свой меч и кольчугу - волшебные вещи. Не хотелось бы, чтобы они пригодились, но лучше с ними чем без них. Бильбо очень хотел посмотреть на своё кольцо и внезапно сильно разозлился, когда я отказал. Он был просто сам не свой и так же быстро он остыл. Теперь я знаю как выглядит печать кольца на хранителе, слишком долго хранившем его.",time:"24 декабря 3018",ready:!0},"Бильбо":{text:"Фродо посетил меня и я отдал последнюю часть моего наследства - меч и кольчугу. Они сослужили мне хорошую службу, пусть теперь помогут ему. Когда я увидел краешек кольца я попросил Фродо дать мне его подержать, но он спрятал его. Я впал в ярость, и очень быстро остыл. Не знаю что меня нашло.",time:"24 декабря 3018",ready:!0}}}]},"Арвен и Арагорн":{name:"Арвен и Арагорн",story:"Любовная линия Арвен и Арагорна. Оба активно вздыхают друг об дружке.",characters:{"Арагорн":{name:"Арагорн",inventory:"брошь Арвен",activity:{active:!0}},"Арвен":{name:"Арвен",inventory:"",activity:{active:!0}}},events:[{name:"Брошь",text:"Арвен и Арагорн. Арвен дает Арагорну свою брошь.",time:"3018/10/25 02:00",characters:{"Арагорн":{text:"",time:""},"Арвен":{text:"",time:""}}}]},"История Сарумана":{name:"История Сарумана",story:"Саурон и Саруман активно работают над своими темными планами. Саруман собирает армию орков и создает урук-хаев.",characters:{"Саруман":{name:"Саруман",inventory:"",activity:{active:!0}},"Саурон":{name:"Саурон",inventory:"",activity:{active:!0}}},events:[{name:"Уничтожение рощи",text:"Саруман начинает культивировать орков и дает приказ уничтожить рощу вокруг Ортханка. Так же он выводит Урук-Хаев.",time:"3018/07/13 18:00",characters:{"Саруман":{text:"",time:""},"Саурон":{text:"",time:""}}}]},"Братство кольца":{name:"Братство кольца",story:"В этой истории активно идет вперед Фродо. Все остальные его сопровождают, за исключением Боромира, который активно думает как получить кольцо в Гондор. Братству активно противостоит Саруман. Элронд знает о том, что братство выдвинулось в сторону роковой горы. Галандриэль же ждет когда братство дойдет до Лориена. ",characters:{"Арагорн":{name:"Арагорн",inventory:"ножны, плащ с брошью",activity:{follower:!0}},"Боромир":{name:"Боромир",inventory:"золотой пояс, плащ с брошью",activity:{follower:!0,active:!0}},"Галадриэль":{name:"Галадриэль",inventory:"",activity:{passive:!0}},"Гендальф":{name:"Гендальф",inventory:"",activity:{follower:!0}},"Гимли":{name:"Гимли",inventory:"прядь волос Галадриэли, плащ с брошью",activity:{follower:!0}},"Леголас":{name:"Леголас",inventory:"лук и колчан стрел, плащ с брошью",activity:{follower:!0}},"Мерри":{name:"Мерри",inventory:"серебряные пояс, плащ с брошью",activity:{follower:!0}},"Пиппин":{name:"Пиппин",inventory:"серебряные пояс, плащ с брошью",activity:{follower:!0}},"Сэм":{name:"Сэм",inventory:"шкатулка благословленной земли, плащ с брошью",
activity:{follower:!0}},"Фродо":{name:"Фродо",inventory:"фиал, плащ с брошью",activity:{active:!0}},"Элронд":{name:"Элронд",inventory:"",activity:{passive:!0}},"Саруман":{name:"Саруман",inventory:"",activity:{active:!0}}},events:[{name:"Совет",text:"На совете обозначена проблема уничтожения кольца. Кольцо необходимо бросить в Ородруин, но никто не в силе взять на себя эту ношу. Фродо вызывается сделать это. Проводить его берутся Арагорн, Леголас, Гимли, Боромир, Гендальф и его друзья из Шира. Так появляется братство кольца.",time:"3018/10/25 17:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Элронд":{text:"",time:""}}},{name:"Путь по земле",text:"Первая дорога перекрыта патрулями Саурона.",time:"3019/01/08 13:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Саруман":{text:"",time:""}}},{name:"Путь в горы",text:"Магия Сарумана не дает братству пройти через снежные перевалы в горах.",time:"3019/01/12 16:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Саруман":{text:"",time:""}}},{name:"Путь в Морию",text:"Братство спускается в Морию. При входе они пробуждают кракена, который рушит врата Мории, как только они в нее заходят. Тут же они находят тела гномов и понимают, что Мория захвачена орками.",time:"3019/01/13 18:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Мория",text:"Гендальф показывает Фродо Голлума и говорит, что он давно идет за ними.\nПипин роняет ведро в колодец у могилы Балина, тем самым выдавая себя оркам. Принимают бой. Приходит Балрог.",time:"3019/01/14 21:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Выход из Мории",text:"Гендальф остается защищать мост от Балрога и падает в пропасть вместе с ним. Все остальные выходят из Мории и попадают в Лотлориен к Галадриэли.",time:"3019/01/15 16:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гендальф":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Зеркало Галадриэли",text:"Галадриэль показывает Фродо будущее в своем зеркале.",time:"3019/02/14 21:30",characters:{"Галадриэль":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Покидая Лотлориен",text:"Братству кольца помогают припасами и пропускают через Лотлориен. Нимбос, фиал, накидки.",time:"3019/02/16 12:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""},"Галадриэль":{text:"",time:""}}},{name:"Урук-Хаи",text:"Саруман отправляет отряд Урук-Хаев в погоню за хранителем кольца.",time:"3019/01/10 00:00",characters:{"Саруман":{text:"",time:""}}},{name:"Водопад",text:"Братство останавливается перед водопадом.",time:"3019/02/25 16:00",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}},{name:"Развилка",text:"Боромир пытается отнять у Фродо кольцо. В этот момент на них нападают Урук-Хаи, убивают Боромира, хватают Мерри и Пипина и убегают к Саруману. Фродо решает идти дальше в одиночку, но Сэм не отстает. Остальные хоронят Боромира и отправляются в погоню за отрядом Урук-Хаев.",time:"3019/02/26 17:20",characters:{"Арагорн":{text:"",time:""},"Боромир":{text:"",time:""},"Гимли":{text:"",time:""},"Леголас":{text:"",time:""},"Мерри":{text:"",time:""},"Пиппин":{text:"",time:""},"Сэм":{text:"",time:""},"Фродо":{text:"",time:""}}}]}},Settings:{BriefingPreview:{characterName:"Арагорн"},Stories:{storyName:"Братство кольца"},CharacterProfile:{characterName:"Арагорн"},Events:{storyName:"Начало пути",characterNames:["Арагорн"],eventIndexes:[],selectedFilter:"adaptationFilterByCharacter"}},Version:"0.4.4u2",Log:[]}}("undefined"==typeof exports?this.BaseExample={}:exports),function(t){t.startsWith=function(t,e){return t.substring(0,e.length)===e},t.removeFromArrayByIndex=function(t,e,i){var n=t.slice((i||e)+1||t.length);return t.length=0>e?t.length+e:e,t.push.apply(t,n)},t.charOrdAFactory=function(t){return function(e,i){return e=t(e),i=t(i),e>i?1:i>e?-1:0}},t.charOrdA=t.charOrdAFactory(function(t){return t.toLowerCase()}),t.eventsByTime=t.charOrdAFactory(function(t){return new Date(t.time)}),t.strFormat=function(t,e){return t.replace(/\{\{|\}\}|\{(\d+)\}/g,function(t,i){return"{{"==t?"{":"}}"==t?"}":e[i]})},t.consoleLog=function(t){console.log(t)},t.clone=function(e){if(!e||"object"!=typeof e)return e;var i,n,r="function"==typeof e.pop?[]:{};for(i in e)e.hasOwnProperty(i)&&(n=e[i],n&&"object"==typeof n?r[i]=t.clone(n):r[i]=n);return r}}("undefined"==typeof exports?this.CommonUtils={}:exports),function(t){t.profileFieldTypes={text:{name:"text",value:""},string:{name:"string",value:""},"enum":{name:"enum",value:"_"},number:{name:"number",value:0},checkbox:{name:"checkbox",value:!1}},t.objectSubsets=["allObjects","selectedCharacters","selectedStories"],t.networks=["socialRelations","characterPresenceInStory","characterActivityInStory"],t.noGroup="noGroup",t.characterActivityTypes=["active","follower","defensive","passive"],t.numberFilter=["ignore","greater","equal","lesser"],t.finishedText="finishedText",t.finishedSuffix="finishedSuffix",t.emptySuffix="emptySuffix",t[!0]="yes",t[!1]="no",t.yesNo=[t[!0],t[!1]],t.briefingNumber=[1,5,10,20],t.colorPalette=[{color:{border:"#FA0A10",background:"#FB7E81",highlight:{border:"#FA0A10",background:"#FFAFB1"},hover:{border:"#FA0A10",background:"#FFAFB1"}}},{color:{border:"#41A906",background:"#7BE141",highlight:{border:"#41A906",background:"#A1EC76"},hover:{border:"#41A906",background:"#A1EC76"}}},{color:{border:"#E129F0",background:"#EB7DF4",highlight:{border:"#E129F0",background:"#F0B3F5"},hover:{border:"#E129F0",background:"#F0B3F5"}}},{color:{border:"#7C29F0",background:"#AD85E4",highlight:{border:"#7C29F0",background:"#D3BDF0"},hover:{border:"#7C29F0",background:"#D3BDF0"}}},{color:{border:"#C37F00",background:"#FFA807",highlight:{border:"#C37F00",background:"#FFCA66"},hover:{border:"#C37F00",background:"#FFCA66"}}},{color:{border:"#4220FB",background:"#6E6EFD",highlight:{border:"#4220FB",background:"#9B9BFD"},hover:{border:"#4220FB",background:"#9B9BFD"}}},{color:{border:"#FD5A77",background:"#FFC0CB",highlight:{border:"#FD5A77",background:"#FFD1D9"},hover:{border:"#FD5A77",background:"#FFD1D9"}}},{color:{border:"#4AD63A",background:"#C2FABC",highlight:{border:"#4AD63A",background:"#E6FFE3"},hover:{border:"#4AD63A",background:"#E6FFE3"}}},{color:{border:"#990000",background:"#EE0000",highlight:{border:"#BB0000",background:"#FF3333"},hover:{border:"#BB0000",background:"#FF3333"}}},{color:{border:"#FF6000",background:"#FF6000",highlight:{border:"#FF6000",background:"#FF6000"},hover:{border:"#FF6000",background:"#FF6000"}}},{color:{border:"#97C2FC",background:"#2B7CE9",highlight:{border:"#D2E5FF",background:"#2B7CE9"},hover:{border:"#D2E5FF",background:"#2B7CE9"}}},{color:{border:"#399605",background:"#255C03",highlight:{border:"#399605",background:"#255C03"},hover:{border:"#399605",background:"#255C03"}}},{color:{border:"#B70054",background:"#FF007E",highlight:{border:"#B70054",background:"#FF007E"},hover:{border:"#B70054",background:"#FF007E"}}},{color:{border:"#AD85E4",background:"#7C29F0",highlight:{border:"#D3BDF0",background:"#7C29F0"},hover:{border:"#D3BDF0",background:"#7C29F0"}}},{color:{border:"#4557FA",background:"#000EA1",highlight:{border:"#6E6EFD",background:"#000EA1"},hover:{border:"#6E6EFD",background:"#000EA1"}}},{color:{border:"#FFC0CB",background:"#FD5A77",highlight:{border:"#FFD1D9",background:"#FD5A77"},hover:{border:"#FFD1D9",background:"#FD5A77"}}},{color:{border:"#C2FABC",background:"#74D66A",highlight:{border:"#E6FFE3",background:"#74D66A"},hover:{border:"#E6FFE3",background:"#74D66A"}}},{color:{border:"#EE0000",background:"#990000",highlight:{border:"#FF3333",background:"#BB0000"},hover:{border:"#FF3333",background:"#BB0000"}}}]}("undefined"==typeof exports?this.Constants={}:exports),function(t){var e=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(o,s,a){var l=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(s=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");s=String(l.masks[s]||s||l.masks["default"]),"UTC:"==s.slice(0,4)&&(s=s.slice(4),a=!0);var h=a?"getUTC":"get",d=o[h+"Date"](),u=o[h+"Day"](),c=o[h+"Month"](),f=o[h+"FullYear"](),p=o[h+"Hours"](),A=o[h+"Minutes"](),m=o[h+"Seconds"](),g=o[h+"Milliseconds"](),v=a?0:o.getTimezoneOffset(),y={d:d,dd:r(d),ddd:l.i18n.dayNames[u],dddd:l.i18n.dayNames[u+7],m:c+1,mm:r(c+1),mmm:l.i18n.monthNames[c],mmmm:l.i18n.monthNames[c+12],yy:String(f).slice(2),yyyy:f,h:p%12||12,hh:r(p%12||12),H:p,HH:r(p),M:A,MM:r(A),s:m,ss:r(m),l:r(g,3),L:r(g>99?Math.round(g/10):g),t:12>p?"a":"p",tt:12>p?"am":"pm",T:12>p?"A":"P",TT:12>p?"AM":"PM",Z:a?"UTC":(String(o).match(i)||[""]).pop().replace(n,""),o:(v>0?"-":"+")+r(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return s.replace(t,function(t){return t in y?y[t]:t.slice(1,t.length-1)})}}();e.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},t(e)}(function(t){"undefined"==typeof exports?this.dateFormat=t:module.exports=t}.bind(this)),function(t){t.data={Meta:{name:"",date:"",preGameDate:"",description:""},Characters:{},ProfileSettings:[],Stories:{},Settings:{BriefingPreview:{},Stories:{},CharacterProfile:{}},Version:"0.4.1"}}("undefined"==typeof exports?this.EmptyBase={}:exports),function(t){function e(t,i){Error.call(this,arguments),this.name="ValidationError",this.messageId=t,this.parameters=i,Error.captureStackTrace?Error.captureStackTrace(this,e):this.stack=(new Error).stack}e.prototype=Object.create(Error.prototype),t.ValidationError=e}("undefined"==typeof exports?this.Errors={}:exports),function(t){var e=function(t,e,i){console.log(e+"."+i+": "+(void 0!==t[i]?"OK":"undefined"))};t.migrate=function(t){if(e(t,"base","Stories"),!t.Version){t.Settings={};var i,n;Object.keys(t.Stories).forEach(function(e){i=t.Stories[e],n=Object.keys(i.characters),n.forEach(function(t){i.characters[t].activity={}})}),t.Version="0.0.4"}if("0.0.4"===t.Version&&(t.Version="0.4.1"),"0.4.1"===t.Version&&(delete t.Settings.Events,t.Version="0.4.3"),"0.4.3"===t.Version&&(t.Log=[],t.Version="0.4.4",t.Meta.saveTime=new Date),"0.4.4"===t.Version){var r,i;Object.keys(t.Characters).forEach(function(e){r=t.Characters[e],delete r.displayName}),Object.keys(t.Stories).forEach(function(e){i=t.Stories[e],delete i.displayName}),t.Version="0.4.4u1"}if("0.4.4u1"===t.Version){t.ProfileSettings.forEach(function(t){t.doExport=!0}),t.Meta.saveTime=(new Date).toString();for(var o in t.Stories){var i=t.Stories[o];i.events.forEach(function(t){delete t.index,delete t.storyName})}for(var o in t.Stories){var i=t.Stories[o];i.events.forEach(function(t){for(var e in t.characters)delete t.characters[e].name,t.characters[e].time=""})}t.Version="0.4.4u2"}if("0.4.4u2"===t.Version){for(var o in t.Stories){var i=t.Stories[o];i.events.forEach(function(t){for(var e in t.characters)delete t.characters[e].name})}t.Version="0.4.4u3"}return e(t,"base","Characters"),e(t,"base","ProfileSettings"),e(t,"base","Meta"),e(t,"base","Log"),e(t.Meta,"base.Meta","name"),e(t.Meta,"base.Meta","date"),e(t.Meta,"base.Meta","preGameDate"),e(t.Meta,"base.Meta","description"),e(t.Meta,"base.Meta","saveTime"),t}}("undefined"==typeof exports?this.Migrator={}:exports),function(t){function e(){return{title:"Meta",description:"Contains meta data for game: name, description, dates and saving time.",type:"object",properties:{name:{type:"string",description:"Game name"},date:{type:"string",description:"Time of starting game in game universe."},preGameDate:{type:"string",description:"Time of starting pregame events in game universe."},description:{type:"string",description:"Description text for game."},saveTime:{type:"string",description:"Stringified date of last database saving."}},required:["name","date","preGameDate","description","saveTime"],additionalProperties:!1}}function i(){return{title:"ProfileSettings",description:"Describes character profile settings.",type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string","enum":["string","number","text","checkbox","enum"]},value:{type:["string","number","boolean"]},doExport:{type:"boolean"}},required:["name","type","value","doExport"],additionalProperties:!1}}}function n(){return{type:"array",items:{type:"array",items:{type:"string"},minItems:4,maxItems:4}}}function r(t){var e,i={name:{type:"string"}};t.forEach(function(t){switch(t.type){case"text":case"string":e={type:"string"};break;case"checkbox":e={type:"boolean"};break;case"number":e={type:"number"};break;case"enum":e={type:"string","enum":t.value.split(",").map(function(t){return t.trim()})}}i[t.name]=e});var n={type:"object",additionalProperties:{type:"object",properties:i,required:Object.keys(i),additionalProperties:!1}};return n}function o(t){var e=Object.keys(t),i={type:"object",properties:{text:{type:"string"},time:{type:"string"},ready:{type:"boolean"}},required:["text","time"],additionalProperties:!1},n={type:"object",properties:{name:{type:"string"},text:{type:"string"},time:{type:"string"},characters:{type:"object",properties:e.reduce(function(t,e){return t[e]=i,t},{}),additionalProperties:!1}},required:["name","text","time","characters"],additionalProperties:!1},r={type:"object",properties:{name:{type:"string","enum":e},inventory:{type:"string"},activity:{type:"object",properties:{active:{type:"boolean"},follower:{type:"boolean"},defensive:{type:"boolean"},passive:{type:"boolean"}},additionalProperties:!1}},required:["name","inventory","activity"],additionalProperties:!1},o={type:"object",properties:{name:{type:"string"},story:{type:"string"},characters:{type:"object",properties:e.reduce(function(t,e){return t[e]=r,t},{}),additionalProperties:!1},events:{type:"array",items:n}},required:["name","story","characters","events"],additionalProperties:!1},s={type:"object",additionalProperties:o};return s}function s(t,e,i){var n=Object.keys(e),r=Object.keys(i),o=Object.keys(t.UsersInfo);0==r.length&&(r=["123"]),0==n.length&&(n=["123"]);var s={type:"object",properties:{name:{type:"string"},stories:{type:"array",items:{type:"string","enum":r},minItems:0},characters:{type:"array",items:{type:"string","enum":n}},salt:{type:"string"},hashedPassword:{type:"string"}},required:["name","stories","characters","salt","hashedPassword"],additionalProperties:!1},a={type:"object",properties:{UsersInfo:{type:"object",additionalProperties:s},admin:{type:"string","enum":o},editor:{type:["string","null"],"enum":o.concat(null)},adaptationRights:{type:"string","enum":["ByStory","ByCharacter"]}},required:["UsersInfo","admin","editor","adaptationRights"],additionalProperties:!1};return a}t.getSchema=function(t){var a={$schema:"http://json-schema.org/draft-04/schema#",title:"SMTK NIMS base",description:"SMTK NIMS base schema.",type:"object"},l=e(),h=i(),d=n(),u=r(t.ProfileSettings),c=o(t.Characters),f={};return t.ManagementInfo&&(f=s(t.ManagementInfo,t.Characters,t.Stories)),a.properties={Meta:l,ProfileSettings:h,Characters:u,Stories:c,Version:{type:"string"},Log:d,Settings:{},ManagementInfo:f},a.required=["Meta","ProfileSettings","Version","Characters","Stories","Log"],a.additionalProperties=!1,a}}("undefined"==typeof exports?this.Schema={}:exports),function(t){function e(t,e){t.prototype.getUsersInfo=function(t){var i=this.database.ManagementInfo;t(null,{usersInfo:e.clone(i.UsersInfo),admin:i.admin,editor:i.editor,adaptationRights:i.adaptationRights})},t.prototype.assignAdmin=function(t,e){this.database.ManagementInfo.admin=t,this.publishPermissionsUpdate(),e()},t.prototype.assignEditor=function(t,e){this.database.ManagementInfo.editor=t,this.publishPermissionsUpdate(),e()},t.prototype.removeEditor=function(t){this.database.ManagementInfo.editor=null,this.publishPermissionsUpdate(),t()},t.prototype.changeAdaptationRightsMode=function(t,e){this.database.ManagementInfo.adaptationRights=t,this.publishPermissionsUpdate(),e()},t.prototype.isUserNameUsed=function(t,e){e(null,void 0!==this.database.ManagementInfo.UsersInfo[t])},t.prototype.createUser=function(t,e,i){this.database.ManagementInfo.UsersInfo[t]={name:t,stories:[],characters:[]},i()},t.prototype.changePassword=function(t,e,i){Utils.alert(strFormat(getL10n("function-must-be-overriden-on-server"),["changePassword"])),i()},t.prototype.removeUser=function(t,e){delete this.database.ManagementInfo.UsersInfo[t],this.publishPermissionsUpdate(),e()},t.prototype.removePermission=function(t,e,i,n){var r=this.database.ManagementInfo;0!=i.length&&(r.UsersInfo[t].characters=r.UsersInfo[t].characters.filter(function(t){return-1===i.indexOf(t)})),0!=e.length&&(r.UsersInfo[t].stories=r.UsersInfo[t].stories.filter(function(t){return-1===e.indexOf(t)})),this.publishPermissionsUpdate(),n()},t.prototype.assignPermission=function(t,e,i,n){var r=this.database.ManagementInfo;0!=i.length&&(i.forEach(function(e){-1===r.UsersInfo[t].characters.indexOf(e)&&r.UsersInfo[t].characters.push(e)}),Object.keys(r.UsersInfo).forEach(function(e){e!==t&&(r.UsersInfo[e].characters=r.UsersInfo[e].characters.filter(function(t){return-1===i.indexOf(t)}))})),0!=e.length&&(e.forEach(function(e){-1===r.UsersInfo[t].stories.indexOf(e)&&r.UsersInfo[t].stories.push(e)}),Object.keys(r.UsersInfo).forEach(function(i){i!==t&&(r.UsersInfo[i].stories=r.UsersInfo[i].stories.filter(function(t){return-1===e.indexOf(t)}))})),this.publishPermissionsUpdate(),n()},t.prototype.publishPermissionsUpdate=function(){Utils.alert(strFormat(getL10n("function-must-be-overriden-on-server"),["publishPermissionsUpdate"]))}}t(e)}(function(t){"undefined"==typeof exports?this.accessManagerAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.getBriefingData=function(t,n){var l={},h=[];for(var d in this.database.Characters)if(!t||t[d]){var u=[];for(var c in this.database.Stories){var f=this.database.Stories[c];f.characters[d]&&f.characters[d].inventory&&""!==f.characters[d].inventory&&(u=u.concat(f.characters[d].inventory))}u=u.join(", ");var p=r(this.database,d,!1),A=r(this.database,d,!0),m=o(this.database,d),g=s(this.database,d),v=a(this.database,d),y={gameName:this.database.Meta.name,name:d,inventory:u,storiesInfo:g,eventsInfo:v,profileInfoArray:m};for(var b in p)y["profileInfo-"+b]=p[b];for(var b in A)y["profileInfo-splitted-"+b]=A[b];h.push(y)}h.sort(e.charOrdAFactory(i.prop("name"))),l.briefings=h,l.gameName=this.database.Meta.name,n(null,l)};var r=function(t,e,i){var n=t.Characters[e],r={};return t.ProfileSettings.forEach(function(t){r[t.name]=i?d(String(n[t.name])):n[t.name]}),r},o=function(t,e){var n,r,o=t.Characters[e],s=i.compose(i.equals(!0),i.prop("doExport")),a=t.ProfileSettings.filter(s).map(function(t){return n=o[t.name],r=d(String(n)),{name:t.name,value:n,splittedText:r}});return a},s=function(t,n){return i.values(t.Stories).filter(function(t){return t.characters[n]}).map(function(e){return{name:e.name,eventsInfo:l(e,n,t.Meta.date)}}).sort(e.charOrdAFactory(function(t){return t.name.toLowerCase()}))},a=function(t,n){var r=i.values(t.Stories).filter(function(t){return t.characters[n]}).map(function(e){return l(e,n,t.Meta.date)});return r=r.reduce(function(t,e){return t.concat(e)},[]),r.sort(e.eventsByTime),r},l=function(t,e,i){return t.events.filter(function(t){return t.characters[e]}).map(h(e,t.name,i))},h=i.curry(function(t,e,i,n){var r={};return""!==n.characters[t].text?r.text=n.characters[t].text:r.text=n.text,r.splittedText=d(r.text),r.time=""===n.time?i:n.time,""!==n.characters[t].time?r.displayTime=n.characters[t].time:r.displayTime=r.time,r.name=n.name,r.storyName=e,r}),d=function(t){return t.split("\n").map(function(t){return{string:t}})}}t(e)}(function(t){"undefined"==typeof exports?this.briefingExportAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e){t.prototype.isCharacterNameUsed=function(t,e){e(null,void 0!==this.database.Characters[t])},t.prototype.createCharacter=function(t,i){if(""===t)return void i(new e.ValidationError("characters-character-name-is-not-specified"));if(this.database.Characters[t])return void i(new e.ValidationError("characters-character-name-already-used",[t]));var n={name:t};this.database.ProfileSettings.forEach(function(t){"enum"===t.type?n[t.name]=t.value.split(",")[0]:n[t.name]=t.value}),this.database.Characters[t]=n,i&&i()},t.prototype.renameCharacter=function(t,i,n){if(""===i)return void n(new e.ValidationError("characters-new-character-name-is-not-specified"));if(t===i)return void n(new e.ValidationError("characters-names-are-the-same"));if(this.database.Characters[i])return void n(new e.ValidationError("characters-character-name-already-used",[i]));var r=this.database.Characters[t];r.name=i,this.database.Characters[i]=r,delete this.database.Characters[t];var o,s,a=function(e){e.characters[t]&&(r=e.characters[t],e.characters[i]=r,delete e.characters[t])};for(o in this.database.Stories)s=this.database.Stories[o],s.characters[t]&&(r=s.characters[t],r.name=i,s.characters[i]=r,delete s.characters[t],s.events.forEach(a));n&&n()},t.prototype.removeCharacter=function(t,e){delete this.database.Characters[t];var i,n,r=function(e){e.characters[t]&&delete e.characters[t]};for(i in this.database.Stories)n=this.database.Stories[i],n.characters[t]&&(delete n.characters[t],n.events.forEach(r));e&&e()},t.prototype.updateProfileField=function(t,i,n,r,o){var s=this.database.Characters[t];switch(n){case"text":case"string":case"enum":s[i]=r;break;case"number":if(isNaN(r))return void o(new e.ValidationError("characters-not-a-number"));s[i]=Number(r);break;case"checkbox":s[i]=r}o&&o()}}t(e)}(function(t){"undefined"==typeof exports?this.charactersAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i){t.prototype.getDatabase=function(t){this.database.Meta.saveTime=(new Date).toString(),t(null,i.clone(this.database))},t.prototype.setDatabase=function(t,i){this.database=e.migrate(t),i&&i()},t.prototype.getMetaInfo=function(t){t(null,i.clone(this.database.Meta))},t.prototype.setMetaInfo=function(t,e,i){this.database.Meta[t]=e,i&&i()},t.prototype.getCharacterNamesArray=function(t){t(null,Object.keys(this.database.Characters).sort(i.charOrdA))},t.prototype.getStoryNamesArray=function(t){t(null,Object.keys(this.database.Stories).sort(i.charOrdA))},t.prototype.getAllProfileSettings=function(t){t(null,i.clone(this.database.ProfileSettings))}}t(e)}(function(t){"undefined"==typeof exports?this.commonAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n,r){t.prototype.getConsistencyCheckResult=function(t){var e=[],i=function(t){e.push(t)};d(this.database,i),h(this.database,i),l(this.database,i),a(this.database,i),this.database.ManagementInfo&&s(this.database,i);var o=r.getSchema(this.database),u=n({allErrors:!0}),c=u.compile(o),f=c(this.database);f||(e=e.concat(c.errors)),t(null,e)};var o=function(t){return e.curry(e.compose(t,i.strFormat))},s=function(t,i){var n=e.values(t.Stories).map(e.prop("name")),r=e.values(t.Characters).map(e.prop("name")),s=o(i);e.values(t.ManagementInfo.UsersInfo).forEach(function(t){var i=e.difference(t.characters,r);0!=i.length&&s("Object rights inconsistent, user character is not exist: user {0}, character {1}",[t.name,i]),i=e.difference(t.stories,n),0!=i.length&&s("Object rights inconsistent, user story is not exist: user {0}, story {1}",[t.name,i])})},a=function(t,i){var n=o(i);e.values(t.Stories).forEach(function(t){var i=e.values(t.characters).map(e.prop("name"));t.events.forEach(function(r,o){var s=e.keys(r.characters),a=e.difference(s,i);0!=a.length&&n("Event characters inconsistent, some character is not exist: story {0}, character {1}",[t.name+":"+o,a])})})},l=function(t,i){var n=e.values(t.Characters).map(e.prop("name")),r=o(i);e.values(t.Stories).forEach(function(t){var i=e.values(t.characters).map(e.prop("name")),o=e.difference(i,n);0!=o.length&&r("Story characters inconsistent, some character is not exist: story {0}, character {1}",[t.name,o]);var s=e.keys(t.characters),a=e.symmetricDifference(i,s);0!=a.length&&r("Story characters inconsistent, inner and outer character name are inconsistent: story {0}, character {1}",[t.name,a])})},h=function(t,i){var n=t.ProfileSettings,r=o(i)("Profile value inconsistency, item type is inconsistent: char {0}, item {1}, value {2}"),s=function(t,i,n){switch(i){case"text":case"string":return!e.is(String,t);case"enum":if(e.is(String,t)){var r=n.split(",").map(e.trim);return!e.contains(t.trim(),r)}return!0;case"number":return!e.is(Number,t);case"checkbox":return!e.is(Boolean,t)}};e.values(t.Characters).forEach(function(t){n.forEach(function(e){s(t[e.name],e.type,e.value)&&r([t.name,e.name,t[e.name]])})})},d=function(t,i){var n=t.ProfileSettings.map(e.prop("name")),r=o(i);e.values(t.Characters).forEach(function(t){var i=e.keys(t).filter(e.compose(e.not,e.equals("name"))),o=e.symmetricDifference(i,n);if(0!=o.length){var s=r(e.__,[t.name,o]);if(i.length!==n.length)return s("Character profile inconsistent, lengths are different: char {0}, difference [{1}]");if(!e.all(e.contains(e.__,n))(i))return s("Character profile inconsistent, item name inconsistency: char {0}, difference [{1}]")}})}}t(e)}(function(t){"undefined"==typeof exports?this.consistencyCheckAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e){t.prototype.getFilteredStoryNames=function(t,r){var o=Object.keys(this.database.Stories).sort(e.charOrdA),s=this;o=o.map(function(t){return{storyName:t,isFinished:n(s.database,t),isEmpty:i(s.database,t)}}),t&&(o=o.filter(function(t){return!t.isFinished||t.isEmpty})),r(null,o)};var i=function(t,e){return 0==t.Stories[e].events.length},n=function(t,e){return t.Stories[e].events.every(function(t){var e=!0;for(var i in t.characters)if(t.characters[i]&&!t.characters[i].ready){e=!1;break}return e})};t.prototype.getFilteredCharacterNames=function(t,i,n){var r;r=this.database.Stories[t].characters,r=Object.keys(r).sort(e.charOrdA);var a=this;r=r.map(function(e){return{characterName:e,isFinished:s(a.database,t,e),isEmpty:o(a.database,t,e)}}),i&&(r=r.filter(function(t){return!t.isFinished||t.isEmpty})),n(null,r)},t.prototype.getFilteredEventNames=function(t,e,i){var n=this.database.Stories[t].events.map(function(t,e){return{name:t.name,index:e,isFinished:r(t),isEmpty:0===Object.keys(t.characters).length}});e&&(n=n.filter(function(t){return!t.isFinished||t.isEmpty})),i(null,n)};var r=function(t){for(var e in t.characters)if(!t.characters[e].ready)return!1;return!0},o=function(t,e,i){return t.Stories[e].events.every(function(t){return!t.characters[i]})},s=function(t,e,i){return t.Stories[e].events.every(function(t){return t.characters[i]?t.characters[i].ready:!0})};t.prototype.getEvents=function(t,i,n){var r,o=e.clone(this.database.Stories[t].events).map(function(t,e){return t.index=e,t}).filter(function(t){for(r=0;r<i.length;r++)if(t.characters[i[r]])return!0;return!1});n(null,o)},t.prototype.setEventAdaptationTime=function(t,e,i,n,r){var o=this.database.Stories[t].events[e];o.characters[i].time=n,r()},t.prototype.setEventText=function(t,e,i,n,r){var o=this.database.Stories[t].events[e];null!=i?o.characters[i].text=n:o.text=n,r()},t.prototype.changeAdaptationReadyStatus=function(t,e,i,n,r){var o=this.database.Stories[t].events[e];o.characters[i].ready=n,r()}}t(e)}(function(t){"undefined"==typeof exports?this.eventsAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.getAllInventoryLists=function(t,e){var i=[];for(var n in this.database.Stories){var r=this.database.Stories[n];r.characters[t]&&r.characters[t].inventory&&""!==r.characters[t].inventory&&i.push({storyName:n,inventory:r.characters[t].inventory})}e(null,i)},t.prototype.getCharacterEventGroupsByStory=function(t,n){var r,o=[],s=this;Object.keys(this.database.Stories).filter(function(e){return s.database.Stories[e].characters[t]}).forEach(function(e){r=[];var n=i.clone(s.database.Stories[e].events);n.map(function(t,i){return t.index=i,t.storyName=e,t.isTimeEmpty=""===t.time,t.time=t.isTimeEmpty?s.database.Meta.date:t.time,t}).filter(function(e){return e.characters[t]}).forEach(function(t){r.push(t)}),o.push({storyName:e,events:r})}),o.sort(i.charOrdAFactory(e.prop("storyName"))),n(null,o)},t.prototype.getCharacterEventsByTime=function(t,e){var n=[],r=this;Object.keys(this.database.Stories).filter(function(e){return r.database.Stories[e].characters[t]}).forEach(function(e){var o=i.clone(r.database.Stories[e].events);n=n.concat(o.map(function(t,i){return t.index=i,t.storyName=e,t.isTimeEmpty=""===t.time,t.time=t.isTimeEmpty?r.database.Meta.date:t.time,t}).filter(function(e){return e.characters[t]}))}),n.sort(i.eventsByTime),e(null,n)},t.prototype.getProfile=function(t,e){e(null,i.clone(this.database.Characters[t]))},t.prototype.getAllProfiles=function(t){t(null,i.clone(this.database.Characters))},t.prototype.getAllStories=function(t){t(null,i.clone(this.database.Stories))},t.prototype.getEventGroupsForStories=function(t,e){var n,r=[],o=this;Object.keys(this.database.Stories).filter(function(e){return-1!==t.indexOf(e)}).forEach(function(t){n=[];var e=i.clone(o.database.Stories[t].events);e.map(function(e,i){return e.index=i,e.storyName=t,e}).forEach(function(t){n.push(t)}),r.push({storyName:t,events:n})}),e(null,r)},t.prototype.setEventTime=function(t,e,i,r){var o=this.database.Stories[t].events[e];o.time=n(i,"yyyy/mm/dd h:MM"),r()}}t(e)}(function(t){"undefined"==typeof exports?this.extrasAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n,r,o){var s={getDatabase:{rewrite:!0},setDatabase:{ignoreParams:!0},setMetaInfo:{filter:function(t){return"description"!==t[0]}},createCharacter:{},renameCharacter:{},removeCharacter:{},createProfileItem:{},renameProfileItem:{},moveProfileItem:{},removeProfileItem:{},updateDefaultValue:{},changeProfileItemType:{},createStory:{},
renameStory:{},removeStory:{},addStoryCharacter:{},switchStoryCharacters:{},removeStoryCharacter:{},updateCharacterInventory:{},onChangeCharacterActivity:{},addCharacterToEvent:{},removeCharacterFromEvent:{},createEvent:{},moveEvent:{},cloneEvent:{},mergeEvents:{},removeEvent:{},updateEventProperty:{filter:function(t){return"text"!==t[2]}},changeAdaptationReadyStatus:{},getBriefingData:{}};o&&(s=e.merge(s,o)),Object.keys(t.prototype).filter(e.prop(e.__,s)).forEach(function(e){var i=t.prototype[e];t.prototype[e]=function(){for(var t=[],r=0;r<arguments.length-1;r++)t.push(arguments[r]);var o=!0;if(s[e].filter&&(o=s[e].filter(t)),o){var a="user";n&&(a=arguments[arguments.length-1].name),this.log(a,e,s[e].ignoreParams?[]:t)}return i.apply(this,arguments)}}),"Standalone"===r&&(t.prototype.log=function(t,e,n){var r=[t,(new Date).toString(),e,JSON.stringify(n)];this.database&&(s[e].rewrite&&void 0!=this.database.Log[this.database.Log.length-1]?this.database.Log[this.database.Log.length-1][2]===e&&(this.database.Log[this.database.Log.length-1]=r):(this.database.Log.push(r),this.database.Log.length>2e3&&this.database.Log.splice(0,1e3))),console.log(i.strFormat("{0},{1},{2},{3}",r))}),t.prototype.getLog=function(t,e){for(var i=[],n=100*t;100*(t+1)>n;n++)this.database.Log[n]&&i.push([n+1].concat(this.database.Log[n]));e(null,{requestedLog:i,logSize:Math.ceil(this.database.Log.length/100)})}}t(e)}(function(t){"undefined"==typeof exports?this.logAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.createProfileItem=function(t,e,i,r,o,s){var a=this;this.isProfileItemNameUsed(t,function(l,h){if(l)return void s(l);if(h)return void s(new n.ValidationError("characters-such-name-already-used"));var d={name:t,type:e,value:i,doExport:!0};Object.keys(a.database.Characters).forEach(function(e){a.database.Characters[e][t]=i}),r?a.database.ProfileSettings.push(d):a.database.ProfileSettings.splice(o,0,d),s()})},t.prototype.moveProfileItem=function(t,e,i){e>t&&e--;var n=this.database.ProfileSettings,r=n[t];n.splice(t,1),n.splice(e,0,r),i()},t.prototype.removeProfileItem=function(t,e,n){var r=this;Object.keys(this.database.Characters).forEach(function(t){delete r.database.Characters[t][e]}),i.removeFromArrayByIndex(this.database.ProfileSettings,t),n()},t.prototype.changeProfileItemType=function(t,i,n){var r=this.database.ProfileSettings.filter(function(e){return e.name===t})[0];r.type=i,r.value=e.profileFieldTypes[i].value;var o=this;Object.keys(this.database.Characters).forEach(function(n){o.database.Characters[n][t]=e.profileFieldTypes[i].value}),n()},t.prototype.isProfileItemNameUsed=function(t,e){if(""===t)return void e(new n.ValidationError("characters-profile-item-name-is-not-specified"));if("name"===t)return void e(new n.ValidationError("characters-profile-item-name-cant-be-name"));var i=function(e){return t===e.name};e(null,this.database.ProfileSettings.some(i))},t.prototype.renameProfileItem=function(t,e,i){var r=this;this.isProfileItemNameUsed(t,function(o,s){return o?void i(o):s?void i(new n.ValidationError("characters-such-name-already-used")):(Object.keys(r.database.Characters).forEach(function(i){var n=r.database.Characters[i][e];delete r.database.Characters[i][e],r.database.Characters[i][t]=n}),r.database.ProfileSettings.filter(function(t){return t.name===e})[0].name=t,void i())})},t.prototype.doExportProfileItemChange=function(t,e,i){var n=this.database.ProfileSettings.filter(function(e){return e.name===t})[0];n.doExport=e,i()},t.prototype.updateDefaultValue=function(t,e,i){var r,o,s,a,l=this.database.ProfileSettings.filter(function(e){return e.name===t})[0];switch(l.type){case"text":case"string":case"checkbox":l.value=e;break;case"number":if(isNaN(e))return void i(new n.ValidationError("characters-not-a-number"));l.value=Number(e);break;case"enum":if(""===e)return void i(new n.ValidationError("characters-enum-item-cant-be-empty"));if(r=l.value.split(","),o=e.split(","),o=o.map(function(t){return t.trim()}),s=[{}].concat(o).reduce(function(t,e){return t[e]=!0,t}),a=r.filter(function(t){return!s[t]}),0!==a.length){l.value=o.join(",");var h=this;return void Object.keys(this.database.Characters).forEach(function(e){var i=h.database.Characters[e][t];s[i]||(h.database.Characters[e][t]=o[0])})}l.value=o.join(",")}i()}}t(e)}(function(t){"undefined"==typeof exports?this.profileConfigurerAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i){t.prototype.getStatistics=function(t){var i={};i.storyNumber=Object.keys(this.database.Stories).length,i.characterNumber=Object.keys(this.database.Characters).length,i.eventsNumber=e.sum(e.values(this.database.Stories).map(e.compose(e.length,e.prop("events")))),i.userNumber=1,this.database.ManagementInfo&&this.database.ManagementInfo.UsersInfo&&(i.userNumber=Object.keys(this.database.ManagementInfo.UsersInfo).length),i.textCharacterNumber=u(this.database);var r=c(this.database);i.firstEvent=r[0]?r[0]:"",i.lastEvent=r[1]?r[1]:"",i.storyEventsHist=f(this.database,function(t){return t.events.length}),i.storyCharactersHist=f(this.database,function(t){return Object.keys(t.characters).length}),i.eventCompletenessHist=s(this.database),i.generalCompleteness=d(this.database),i.storyCompleteness=h(this.database),i.characterChartData=o(this.database,"characters","Characters"),i.storyChartData=o(this.database,"stories","Stories"),i.profileCharts=n(this.database),t(null,i)};var n=function(t){var i=t.ProfileSettings.filter(function(t){return"string"!==t.type&&"text"!==t.type}).map(e.pick(["name","type"])),n=e.groupBy(e.__,e.values(t.Characters)),r=function(t){return e.fromPairs(e.toPairs(t).map(function(t){return t[1]=t[1].length,t}))},o=i.map(function(i){if("enum"===i.type||"checkbox"===i.type)return r(n(e.prop(i.name)));var o=e.ap([e.prop(i.name)],e.values(t.Characters)),s=o.reduce(function(t,e){return e>t?e:t},o[0]),a=o.reduce(function(t,e){return t>e?e:t},o[0]),l=Math.ceil((s-a)/20);l=0===l?1:l;for(var h=1;l>10*h;)h=10*h;for(var d=[1,2,5,10,12],u=0;u<d.length-1;u++)if(h*d[u]<l&&l<h*d[u+1]){l=h*d[u];break}return{groups:r(n(function(t){return Math.floor(t[i.name]/l)})),step:l}});return e.transpose([i,o]).map(function(t){return e.assoc("data",t[1],t[0])})},r=function(t,e,i){return[t,": ",(e/i*100).toFixed(0),"% (",e,"/",i,")"].join("")},o=function(t,e,i){var n=[],o=Object.keys(t[i]).length,s=0;if(t.ManagementInfo&&t.ManagementInfo.UsersInfo){var a,l;for(var h in t.ManagementInfo.UsersInfo)a=t.ManagementInfo.UsersInfo[h],l=a[e].length,n.push({value:l,label:r(h,l,o)}),s+=l;s!==o&&n.push({value:o-s,label:r("unknown",o-s,o)})}else n.push({value:o,label:r("user",o,o)});return n},s=function(t){var e,i,n=[];for(var r in t.Stories){e=t.Stories[r],i=l(e);var o=Math.floor(10*i);n[o]?(n[o].value++,n[o].tip=n[o].tip+", "+e.name+" ("+(100*i).toFixed(0)+"%)"):n[o]={value:1,label:o,tip:e.name+" ("+(100*i).toFixed(0)+"%)"}}for(var s=0;11>s;s++)n[s]||(n[s]=null);return n},a=function(t){var e=0,i=0;return t.events.forEach(function(t){i+=Object.keys(t.characters).length;for(var n in t.characters)t.characters[n].ready&&e++}),{finishedAdaptations:e,allAdaptations:i}},l=function(t){var e=a(t);return 0!==e.allAdaptations?e.finishedAdaptations/e.allAdaptations:0},h=function(t){var i=0,n=Object.keys(t.Stories).length;return e.values(t.Stories).map(a).forEach(function(t){t.allAdaptations===t.finishedAdaptations&&0!=t.allAdaptations&&i++}),[(i/(0===n?1:n)*100).toFixed(1),i,n]},d=function(t){var i=0,n=0;return e.values(t.Stories).map(a).forEach(function(t){i+=t.finishedAdaptations,n+=t.allAdaptations}),[(i/(0===n?1:n)*100).toFixed(1),i,n]},u=function(t){var e,i,n,r=function(t){return t.replace(/\s/g,"").length},o=0;for(n in t.Stories)e=t.Stories[n],o+=r(e.story),e.events.forEach(function(t){o+=r(t.text);for(i in t.characters)o+=r(t.characters[i].text)});return o},c=function(t){var e,i,n=null,r=null;for(var o in t.Stories)e=t.Stories[o],e.events.forEach(function(t){""!=t.time&&(i=new Date(t.time),(null===n||i>n)&&(n=i),(null===r||r>i)&&(r=i))});return[r,n]},f=function(t,e){var i,n=[];for(var r in t.Stories){i=t.Stories[r];var o=e(i);n[o]?(n[o].value++,n[o].tip=n[o].tip+", "+i.name):n[o]={value:1,label:o,tip:o+": "+i.name}}for(var s=0;s<n.length;s++)n[s]||(n[s]=null);return n}}t(e)}(function(t){"undefined"==typeof exports?this.statisticsAPI=t:module.exports=t}.bind(this)),function(t){function e(t,e,i,n){t.prototype.getMasterStory=function(t,e){e(null,this.database.Stories[t].story)},t.prototype.updateMasterStory=function(t,e,i){this.database.Stories[t].story=e,i()},t.prototype.isStoryExist=function(t,e){e(null,void 0!==this.database.Stories[t])},t.prototype.createStory=function(t,e){return""===t?void e(new n.ValidationError("stories-story-name-is-not-specified")):this.database.Stories[t]?void e(new n.ValidationError("stories-story-name-already-used",[t])):(this.database.Stories[t]={name:t,story:"",characters:{},events:[]},void e())},t.prototype.renameStory=function(t,e,i){if(""===e)return void i(new n.ValidationError("stories-story-name-is-not-specified"));if(t===e)return void i(new n.ValidationError("stories-names-are-the-same"));if(this.database.Stories[e])return void i(new n.ValidationError("stories-story-name-already-used",[e]));var r=this.database.Stories[t];r.name=e,this.database.Stories[e]=r,delete this.database.Stories[t],i()},t.prototype.removeStory=function(t,e){delete this.database.Stories[t],e()},t.prototype.addCharacterToEvent=function(t,e,i,n){this.database.Stories[t].events[e].characters[i]={text:"",time:""},n()},t.prototype.removeCharacterFromEvent=function(t,e,i,n){delete this.database.Stories[t].events[e].characters[i],n()},t.prototype.getStoryCharacterNamesArray=function(t,e){var n;n=this.database.Stories[t].characters,e(null,Object.keys(n).sort(i.charOrdA))},t.prototype.getStoryEvents=function(t,e){e(null,i.clone(this.database.Stories[t].events))},t.prototype.getStoryCharacters=function(t,e){e(null,i.clone(this.database.Stories[t].characters))},t.prototype.addStoryCharacter=function(t,e,i){return""===e?void i(new n.ValidationError("stories-character-name-is-not-specified")):(this.database.Stories[t].characters[e]={name:e,inventory:"",activity:{}},void i())},t.prototype.switchStoryCharacters=function(t,e,i,r){if(""===e||""===i)return void r(new n.ValidationError("stories-one-of-switch-characters-is-not-specified"));var o=this.database.Stories[t];o.characters[i]=o.characters[e],o.characters[i].name=i,delete o.characters[e],o.events.forEach(function(t){t.characters[e]&&(t.characters[i]=t.characters[e],delete t.characters[e])}),r()},t.prototype.removeStoryCharacter=function(t,e,i){if(""===e)return void i(new n.ValidationError("stories-character-name-is-not-specified"));var r=this.database.Stories[t];delete r.characters[e],r.events.forEach(function(t){delete t.characters[e]}),i()},t.prototype.updateCharacterInventory=function(t,e,i,n){this.database.Stories[t].characters[e].inventory=i,n()},t.prototype.onChangeCharacterActivity=function(t,e,i,n,r){var o=this.database.Stories[t].characters[e];n?o.activity[i]=!0:delete o.activity[i],r()},t.prototype.createEvent=function(t,e,i,r,o,s){if(""===e)return void s(new n.ValidationError("stories-event-name-is-not-specified"));if(""===i)return void s(new n.ValidationError("stories-event-text-is-empty"));var a={name:e,text:i,time:"",characters:{}};r?this.database.Stories[t].events.push(a):this.database.Stories[t].events.splice(o,0,a),s()},t.prototype.moveEvent=function(t,e,i,n){i>e&&i--;var r=this.database.Stories[t].events,o=r[e];r.splice(e,1),r.splice(i,0,o),n()},t.prototype.cloneEvent=function(t,e,n){var r=this.database.Stories[t],o=r.events[e],s=i.clone(o);r.events.splice(e,0,s),n()},t.prototype.mergeEvents=function(t,e,r){var o=this.database.Stories[t];if(o.events.length===e+1)return void r(new n.ValidationError("stories-cant-merge-last-event"));var s=o.events[e],a=o.events[e+1];s.name+=a.name,s.text+=a.text;for(var l in a.characters)s.characters[l]?(s.characters[l].text+=a.characters[l].text,s.characters[l].time+=a.characters[l].time,s.characters[l].ready=!1):s.characters[l]=a.characters[l];i.removeFromArrayByIndex(o.events,e+1),r()},t.prototype.removeEvent=function(t,e,n){var r=this.database.Stories[t];i.removeFromArrayByIndex(r.events,e),n()},t.prototype.updateEventProperty=function(t,e,i,r,o){if("name"===i&&""===r.trim())return void o(new n.ValidationError("stories-event-name-is-not-specified"));if("text"===i&&""===r.trim())return void o(new n.ValidationError("stories-event-text-is-empty"));this.database.Stories[t].events[e][i]=r;o()},t.prototype.getCharactersSummary=function(t){var i=e.keys(this.database.Characters),n={};i.forEach(function(t){n[t]={active:0,follower:0,defensive:0,passive:0,totalAdaptations:0,finishedAdaptations:0,totalStories:0}}),e.values(this.database.Stories).forEach(function(t){e.values(t.characters).forEach(function(t){var i=n[t.name];i.totalStories++,e.toPairs(t.activity).forEach(function(t){t[1]===!0&&i[t[0]]++})}),t.events.forEach(function(t){e.toPairs(t.characters).forEach(function(t){var e=n[t[0]];e.totalAdaptations++,t[1].ready&&e.finishedAdaptations++})})}),e.values(n).forEach(function(t){t.completeness=Math.round(100*t.finishedAdaptations/(0!=t.totalAdaptations?t.totalAdaptations:1))}),t(null,n)}}t(e)}(function(t){"undefined"==typeof exports?this.storiesAPI=t:module.exports=t}.bind(this));